<!DOCTYPE html>
<html   lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Attar Store - Experience the Essence of Purity</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com" rel="preconnect"/>
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&amp;family=Cairo:wght@400;600;700&amp;display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
<style type="text/tailwindcss">
      .material-symbols-outlined { font-variation-settings: 'FILL' 0, 'wght' 300, 'GRAD' 0, 'opsz' 24 }
      .material-symbols-outlined.filled { font-variation-settings: 'FILL' 1 }
      html { scroll-behavior: smooth; }
      ::-webkit-scrollbar { width: 6px; }
      ::-webkit-scrollbar-track { background: #050B14; }
      ::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
      ::-webkit-scrollbar-thumb:hover { background: #C89B3F; }
      .glass-panel {
          background: linear-gradient(145deg, rgba(255,255,255,0.03) 0%, rgba(255,255,255,0.01) 100%);
          backdrop-filter: blur(20px);
          border: 1px solid rgba(255,255,255,0.05);
      }
  </style>
    <script id="tailwind-config">
        tailwind.config = {
          darkMode: "class",
          theme: {
            extend: {
              colors: {
                "primary": "#C89B3F", // Royal Gold
                "secondary": "#0A192F", // Deep Navy
                "accent": "#F5F1E9", // Soft Beige
                "bronze": "#A97142", // Bronze
                "light-text": "#3D3D3D",
                "dark-text": "#E0E0E0",
              },
              fontFamily: {
                "display": ["Playfair Display", "serif"],
                "body": ["Cairo", "sans-serif"],
              },
              borderRadius: {
                "DEFAULT": "0.75rem", // 12px
                "lg": "1rem", // 16px
                "xl": "1.5rem", // 24px
                "full": "9999px"
              },
              boxShadow: {
                'glow-gold': '0 0 20px 0px rgba(200, 155, 63, 0.4)',
                'glow-gold-lg': '0 0 30px 5px rgba(200, 155, 63, 0.5)',
              },
              animation: {
                'glow': 'glow 3s ease-in-out infinite',
                'pulse-border': 'pulse-border 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                'bounce-slow': 'bounce 2s infinite',
              },
              keyframes: {
                glow: {
                  '0%, 100%': {
                    textShadow: '0 0 5px rgba(200, 155, 63, 0.2), 0 0 10px rgba(200, 155, 63, 0.2)'
                  },
                  '50%': {
                    textShadow: '0 0 20px rgba(200, 155, 63, 0.6), 0 0 30px rgba(200, 155, 63, 0.4)'
                  },
                },
                'pulse-border': {
                  '0%, 100%': {
                    boxShadow: '0 0 0 0 rgba(200, 155, 63, 0.7)'
                  },
                  '50%': {
                    boxShadow: '0 0 0 4px rgba(200, 155, 63, 0)'
                  },
                },
              }
            },
          },
        }
      </script>
    <style>
        .material-symbols-outlined {
          font-variation-settings:
            'FILL' 0,
            'wght' 300,
            'GRAD' 0,
            'opsz' 24
        }
        .perspective-1000 {
          perspective: 1000px;
        }
        .transform-style-3d {
          transform-style: preserve-3d;
        }
        .backface-hidden {
          backface-visibility: hidden;
        }
        .rotate-y-180 {
          transform: rotateY(180deg);
        }.group:hover .group-hover\:rotate-y-180 {
          transform: rotateY(180deg);
        }
      </style>
      <script src="/assets/js/font.js"></script>
    </head>
  
    <body
    x-data="productPage()"
    x-init="init()"
    class="bg-accent dark:bg-secondary text-light-text dark:text-dark-text font-body antialiased overflow-x-hidden"
  >
  
  <header class="sticky top-0 z-50 w-full transition-all duration-300 ease-in-out bg-accent/80 dark:bg-secondary/80 backdrop-blur-lg shadow-sm">
    <div class="container mx-auto flex items-center justify-between px-4 md:px-8 py-4">
    <a class="flex items-center gap-3" href="index.html">
    <div class="h-8 w-8 text-bronze dark:text-primary">
      <img
      src="assets/images/logo.png"
      alt="Attar Store Logo"
      class="h-8 w-8 object-cover rounded-full"
      />
    </div>
    <span class="text-xl font-bold font-display text-light-text dark:text-accent">Attar Store</span>
    </a>
    
    <nav class="hidden md:flex items-center gap-8">
    <a class="font-semibold tracking-wide text-light-text/80 dark:text-accent/80 hover:text-bronze dark:hover:text-primary transition-colors" href="index.html">Home</a>
    <a class="font-semibold tracking-wide text-light-text/80 dark:text-accent/80 hover:text-bronze dark:hover:text-primary transition-colors" href="ProductListed.html">Product</a>
    <a class="font-semibold tracking-wide text-light-text/80 dark:text-accent/80 hover:text-bronze dark:hover:text-primary transition-colors" href="Blogs.html">Blogs</a>
    <a class="font-semibold tracking-wide text-light-text/80 dark:text-accent/80 hover:text-bronze dark:hover:text-primary transition-colors" href="AboutUS.html">About</a>
    <a class="font-semibold tracking-wide text-light-text/80 dark:text-accent/80 hover:text-bronze dark:hover:text-primary transition-colors" href="contactUS.html">Contact</a>
    </nav>
    <div class="flex items-center gap-2 sm:gap-4">
      <button @click="toggleTheme()"  class="flex h-10 w-10 cursor-pointer items-center justify-center rounded-full bg-transparent text-bronze dark:text-primary transition-transform duration-500 ease-in-out hover:rotate-[360deg] hover:bg-bronze/10 dark:hover:bg-primary/10">
        <span class="material-symbols-outlined hidden dark:inline">light_mode</span>
        <span class="material-symbols-outlined dark:hidden">dark_mode</span>
        </button>
    <button
      onclick="window.location.href='cart.html'"
      class="relative"
    >
      <span class="material-symbols-outlined text-2xl">
        shopping_cart
      </span>
    
      <span
        id="cart-count"
        class="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full px-1"
      >
        0
      </span>
    </button>
    <script>
      function updateCartBadge() {
      const badge = document.getElementById("cart-count");
      if (!badge) return;
    
      const cart = JSON.parse(localStorage.getItem("cart")) || [];
      const count = cart.reduce((sum, i) => sum + i.qty, 0);
    
      badge.textContent = count;
      badge.style.display = count > 0 ? "flex" : "none";
    }
    
    window.addEventListener("cart-updated", updateCartBadge);
    document.addEventListener("DOMContentLoaded", updateCartBadge);
    
    </script>
    <div id="profile-area">
      <!-- NOT logged in -->
      <button id="guest-profile-btn"
              onclick="openAuthModal()"
              class="flex h-10 w-10 items-center justify-center rounded-full ">
        <span class="material-symbols-outlined">person</span>
      </button>
    
      <!-- logged in -->
      <img id="user-profile-img"
           data-user-avatar
           onclick="goToProfile()"
           class="hidden h-10 w-10 rounded-full cursor-pointer border-2 border-bronze object-cover">
    </div>
    <script>
      function updateAuthUI() {
        const user = getUser();
    
        const guestBtn = document.getElementById("guest-profile-btn");
        const userImg = document.getElementById("user-profile-img");
    
        if (!guestBtn || !userImg) return;
    
        if (user) {
          // logged in
          guestBtn.classList.add("hidden");
          userImg.classList.remove("hidden");
        } else {
          // guest
          guestBtn.classList.remove("hidden");
          userImg.classList.add("hidden");
        }
      }
    </script>
    
    <script>
      function getUser() {
        const raw = localStorage.getItem("user");
        if (!raw) return null;
      
        const user = JSON.parse(raw);
      
        // DEFAULT NAME FROM EMAIL
        if (!user.name && user.email) {
          user.name = user.email.split("@")[0];
        }
      
        // DEFAULT AVATAR
        if (!user.avatar) {
          const initials = user.name
            .split(" ")
            .map(w => w[0])
            .join("")
            .substring(0, 2)
            .toUpperCase();
      
          user.avatar = `https://ui-avatars.com/api/?name=${initials}&background=8B5A2B&color=fff`;
        }
      
        return user;
      }
      
      function syncUserUI() {
        const user = getUser();
        if (!user) return;
      
        // PROFILE IMAGES
        document.querySelectorAll("[data-user-avatar]").forEach(el => {
          el.src = user.avatar;
        });
      
        // NAME TEXT
        document.querySelectorAll("[data-user-name]").forEach(el => {
          el.textContent = user.name;
        });
      
        // EMAIL TEXT
        document.querySelectorAll("[data-user-email]").forEach(el => {
          el.textContent = user.email;
        });
      }
      </script>
      
      
      <script>
        function goToProfile() {
          const user = localStorage.getItem("user");
        
          if (!user) {
            openAuthModal();
            return;
          }
        
          const parsedUser = JSON.parse(user);
        
          if (parsedUser.role === "admin") {
            window.location.href = "admin.html";
          } else {
            window.location.href = "profile.html";
          }
        }
        
          </script>
      
      
        
      
    
        
    
    <button class="md:hidden flex h-10 w-10 items-center justify-center rounded-full bg-transparent text-bronze dark:text-primary" id="hamburger-button">
    <span class="material-symbols-outlined" id="menu-icon">menu</span>
    </button>
    </div>
    </div>
    </header>
    <div class="fixed inset-0 bg-black/50 z-[59] md:hidden opacity-0 pointer-events-none transition-opacity duration-500 ease-in-out"
    id="mobile-menu-overlay"></div>

<!-- MOBILE MENU -->
<div class="fixed top-0 right-0 h-full w-full max-w-xs bg-accent dark:bg-secondary shadow-lg z-[60]
           transform translate-x-full md:hidden transition-transform duration-500 ease-in-out"
    id="mobile-menu">

 <!-- HEADER (LOGO + CLOSE) -->
 <div class="flex items-center justify-between p-5 border-b border-bronze/20 dark:border-primary/20">

   <!-- LOGO + NAME -->
   <a href="index.html" class="flex items-center gap-3">
     <div class="h-8 w-8 text-bronze dark:text-primary">
      <img
          src="assets/images/logo.png"
          alt="Attar Store Logo"
          class="h-8 w-8 object-cover rounded-full"
          />
     </div>
     <span class="text-lg font-bold font-display text-light-text dark:text-accent">
       Hirah Attar
     </span>
   </a>

   <!-- CLOSE BUTTON -->
   <button class="flex h-10 w-10 items-center justify-center rounded-full
                  bg-transparent text-bronze dark:text-primary"
           id="close-menu-button">
     <span class="material-symbols-outlined text-3xl">close</span>
   </button>
 </div>

 <!-- NAV LINKS -->
 <div class="p-8 pt-10">
   <nav class="flex flex-col items-center gap-6">

     <a class="text-xl font-semibold tracking-wide text-light-text/80 dark:text-accent/80
               hover:text-bronze dark:hover:text-primary transition-colors"
        href="index.html">Home</a>

     <a class="text-xl font-semibold tracking-wide text-light-text/80 dark:text-accent/80
               hover:text-bronze dark:hover:text-primary transition-colors"
        href="ProductListed.html">Product</a>

     <a class="text-xl font-semibold tracking-wide text-light-text/80 dark:text-accent/80
               hover:text-bronze dark:hover:text-primary transition-colors"
        href="Blogs.html">Blogs</a>

     <a class="text-xl font-semibold tracking-wide text-light-text/80 dark:text-accent/80
               hover:text-bronze dark:hover:text-primary transition-colors"
        href="AboutUS.html">About</a>

     <a class="text-xl font-semibold tracking-wide text-light-text/80 dark:text-accent/80
               hover:text-bronze dark:hover:text-primary transition-colors"
        href="contactUS.html">Contact</a>

   </nav>
 </div>
</div>

<script>
 document.addEventListener("DOMContentLoaded", () => {
   const hamburgerBtn = document.getElementById("hamburger-button");
   const closeBtn = document.getElementById("close-menu-button");
   const mobileMenu = document.getElementById("mobile-menu");
   const overlay = document.getElementById("mobile-menu-overlay");

   if (!hamburgerBtn || !mobileMenu || !overlay) return;

   // force closed state
   mobileMenu.classList.add("translate-x-full");
   overlay.classList.add("hidden");

   function openMenu() {
     mobileMenu.classList.remove("translate-x-full");

     overlay.classList.remove("hidden");
     overlay.classList.add("opacity-100");

     document.body.classList.add("overflow-hidden");
   }

   function closeMenu() {
     mobileMenu.classList.add("translate-x-full");

     overlay.classList.remove("opacity-100");
     overlay.classList.add("hidden");

     document.body.classList.remove("overflow-hidden");
   }

   hamburgerBtn.addEventListener("click", openMenu);
   if (closeBtn) closeBtn.addEventListener("click", closeMenu);
   overlay.addEventListener("click", closeMenu);

   mobileMenu.querySelectorAll("a").forEach(link => {
     link.addEventListener("click", closeMenu);
   });
 });
</script>
  
    <main class="relative z-10 pt-4 pb-16 px-4 sm:px-6 lg:px-8 min-h-screen">
      <div class="max-w-7xl mx-auto w-full">

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 lg:gap-24 items-start">
          <div class="relative group animate-fade-in overflow-hidden self-start">
                <div class="absolute inset-0 pointer-events-none bg-gradient-to-tr from-gold-600/20 to-transparent rounded-full blur-3xl opacity-60 group-hover:opacity-80 transition-opacity duration-700"></div>
  <div class="relative glass-panel rounded-[40px] p-8 md:p-12 shadow-glow hover:shadow-[0_0_80px_-20px_rgba(200,155,63,0.3)] transition-all duration-500 border border-bronze/30 dark:border-white/20">
  <div class="absolute top-6 left-6 z-20">
<!-- IN STOCK -->
<template x-if="selectedStockStatus === 'in'">
  <span class="px-3 py-1 text-xs font-bold rounded-full bg-green-500/20 text-green-400 border border-green-500/30">
    In Stock
  </span>
</template>

<!-- LOW STOCK -->
<template x-if="selectedStockStatus === 'low'">
  <span class="px-3 py-1 text-xs font-bold rounded-full bg-yellow-500/20 text-yellow-400 border border-yellow-500/30">
    Low Stock
  </span>
</template>

<!-- OUT OF STOCK -->
<template x-if="selectedStockStatus === 'out'">
  <span class="px-3 py-1 text-xs font-bold rounded-full bg-red-500/20 text-red-400 border border-red-500/30">
    Out of Stock
  </span>
</template>


  </div>
  
<div class="absolute top-6 right-6 z-20">

</div>
<div class="relative aspect-[4/5] w-full flex items-center justify-center animate-float">
  <img
  class="object-cover h-full w-full rounded-2xl opacity-90 drop-shadow-2xl mix-blend-overlay"
  :src="product.images?.[0] || '/placeholder.png'"
  alt="Product image"
  style="mask-image: linear-gradient(black 80%, transparent 100%);"
/>

<img
  class="absolute inset-0 object-cover h-full w-full rounded-2xl shadow-2xl"
  :src="product.images?.[0] || '/placeholder.png'"
  alt="Product image"
  style="mask-image: radial-gradient(circle, black 40%, transparent 100%); opacity: 0.8;"
/>
</div>
</div>
<div x-show="loading" class="text-center py-20 text-light-text/60">
  Loading product...
</div>

<div x-show="error" class="text-center py-20 text-red-500">
  <span x-text="error"></span>
</div>
<!-- REVIEW REMINDER NUDGE -->
<div
  class="glass-nudge review-shimmer rounded-lg p-3 flex items-center justify-between mt-4"
  x-show="nudgeVisible"
  x-transition:enter="transition ease-out duration-300"
  x-transition:enter-start="opacity-0 transform -translate-y-2"
  x-transition:enter-end="opacity-100 transform translate-y-0"
>
  <div class="flex items-center space-x-3 px-1">
    <span class="material-symbols-outlined filled text-royal-gold text-lg">star</span>
    <span class="text-sm text-dark-text/90 font-sans tracking-tight">
      You purchased this product. Leave a review?
    </span>
  </div>

  <div class="flex items-center space-x-3">
    <button
      @click="openReviewFromNudge()"
      class="bg-gradient-to-r from-primary to-bronze
      text-secondary text-[11px] font-bold uppercase tracking-wider
      px-4 py-1.5 rounded-lg
      hover:from-bronze hover:to-primary
      active:scale-95 transition-all shadow-md"    >
      Review now
    </button>

    <button
      @click="nudgeVisible = false"
      class="text-dark-text/40 hover:text-dark-text transition-colors"
    >
      <span class="material-symbols-outlined text-sm">close</span>
    </button>
  </div>
</div>








<script>
  async function loadProductReviews(productId) {
    try {
      const res = await fetch(
        `https://perfume-store-production.up.railway.app/api/products/${productId}/reviews`
      );
  
      const data = await res.json();
      if (!data.success) return;
  
      const reviews = data.reviews || [];
  
      renderReviewHeader(reviews);
      renderReviewList(reviews);
  
    } catch (err) {
      console.error("Load reviews failed:", err);
    }
  }
  
  function renderReviewHeader(reviews) {
  const starsEl = document.getElementById("reviewStars");
  const avgEl = document.getElementById("reviewAverage");
  const countEl = document.getElementById("reviewCount");

  if (!starsEl || !avgEl || !countEl) return;

  starsEl.innerHTML = "";

  if (!reviews.length) {
    avgEl.textContent = "0.0/5";
    countEl.textContent = "0 Reviews";
    return;
  }

  const total = reviews.reduce((s, r) => s + Number(r.rating || 0), 0);
  const avg = (total / reviews.length).toFixed(1);

  avgEl.textContent = `${avg}/5`;
  countEl.textContent = `${reviews.length} Reviews`;

  const full = Math.floor(avg);
  const half = avg - full >= 0.5;

  for (let i = 1; i <= 5; i++) {
    const star = document.createElement("span");
    star.className = "material-symbols-outlined text-xl";

    if (i <= full) {
      star.textContent = "star";
      star.classList.add("filled", "text-primary");
    } else if (i === full + 1 && half) {
      star.textContent = "star_half";
      star.classList.add("filled", "text-primary");
    } else {
      star.textContent = "star";
      star.classList.add("text-bronze/40");
    }

    starsEl.appendChild(star);
  }
}

  function renderReviewList(reviews) {
    const listEl = document.getElementById("reviewList");
    listEl.innerHTML = "";
  
    if (!reviews.length) {
      listEl.innerHTML = `
        <p class="text-white/40 italic text-sm">
          No reviews yet.
        </p>
      `;
      return;
    }
  
    // show only first 3 for now
    const visible = reviews.slice(0, 3);
  
    visible.forEach(r => {
      const div = document.createElement("div");
      div.className =
  "glass-panel rounded-2xl p-6 border border-bronze/30 dark:border-white/20 bg-white/30 dark:bg-transparent";


      div.innerHTML = `
        <div class="flex justify-between items-start mb-3">
<span class="font-serif text-lg text-light-text dark:text-accent">
            ${escapeHtml(r.user || "User")}
          </span>
  
          <div class="flex text-gold-500 scale-75 origin-right">
            ${renderStarRow(r.rating)}
          </div>
        </div>
  
<p class="text-light-text/70 dark:text-accent/70 text-sm leading-relaxed mb-4 italic">
          "${escapeHtml(r.comment || "")}"
        </p>
  
        ${
          r.adminReply
            ? `
<div class="bg-primary/5 border-l-2 border-primary rounded-lg p-4 mt-4 ml-2">
                <div class="flex items-center gap-2 mb-1">
                  <span class="text-[10px] uppercase tracking-widest font-bold text-gold-400">
                    Admin Reply
                  </span>
                </div>
                <p class="text-white/60 text-xs">
                  ${escapeHtml(r.adminReply)}
                </p>
              </div>
            `
            : ""
        }
      `;
  
      listEl.appendChild(div);
    });
  
    const viewAllBtn = document.getElementById("viewAllReviewsBtn");
    if (reviews.length > 3) {
      viewAllBtn.classList.remove("hidden");
    } else {
      viewAllBtn.classList.add("hidden");
    }
  }
  
  function renderStarRow(rating) {
  let html = "";
  for (let i = 1; i <= 5; i++) {
    html += `
      <span class="material-symbols-outlined text-sm
        ${i <= rating ? "filled text-primary" : "text-bronze/40"}">
        star
      </span>
    `;
  }
  return html;
}

  
  function escapeHtml(str) {
    return str.replace(/[&<>"']/g, function (m) {
      return (
        {
          "&": "&amp;",
          "<": "&lt;",
          ">": "&gt;",
          '"': "&quot;",
          "'": "&#39;"
        }[m] || m
      );
    });
  }
  </script>
  
  
</div>
<div class="space-y-8 animate-slide-up" style="animation-delay: 0.2s;">
<div>
  
<h1
  class="text-5xl md:text-6xl font-serif font-bold text-light-text dark:text-accent mb-3 tracking-tight"
  x-text="product?.name"
></h1>

<p
  class="text-xl text-light-text dark:text-accent/60 font-serif italic"
  x-text="product?.description"
></p>
</div>

<div class="flex items-baseline space-x-3 pb-6 border-b border-bronze/30 dark:border-white/20">
  <template x-if="priceData">
    <div>
      <span class="text-3xl font-bold text-gold-300">
          LKR <span x-text="totalPrice"></span>
        </span>
              

      <template x-if="priceData.discounted">
        <span
          class="text-lg text-light-text dark:text-accent/30 line-through ml-2"
          x-text="'LKR ' + priceData.original"
        ></span>
      </template>
    </div>
  </template>
</div>


<div class="space-y-4">
<div class="flex justify-between items-center">
<label class="text-xs uppercase tracking-widest text-light-text dark:text-accent/50 font-bold">Fragrance Variant</label>
<span class="text-gold-400 text-sm font-serif italic" x-text="selectedVariant"></span>
</div>
<div class="flex flex-wrap gap-3">
<template x-for="variant in variants">
<button :class="selectedVariant === variant.name ? 'border-gold-500 bg-primary/10' : 'border-bronze/30 dark:border-white/20 bg-white/5 hover:border-gold-500/50'" @click="selectedVariant = variant.name" class="group relative px-4 py-2 rounded-lg border transition-all duration-300 flex items-center space-x-2 overflow-hidden">
<span :class="variant.color" class="w-3 h-3 rounded-full shadow-inner"></span>
<span :class="selectedVariant === variant.name ? 'text-gold-300' : 'text-light-text dark:text-accent/70 group-hover:text-light-text dark:text-accent'" class="text-sm font-medium">
<span x-text="variant.name"></span>
</span>
<div class="absolute inset-0 -translate-x-full group-hover:animate-[shimmer_1.5s_infinite] bg-gradient-to-r from-transparent via-white/5 to-transparent z-10" x-show="selectedVariant === variant.name"></div>
</button>
</template>
</div>
</div>


<div class="space-y-4">
<label class="text-xs uppercase tracking-widest text-light-text dark:text-accent/50 font-bold">Bottle Size</label>
<div class="grid grid-cols-3 gap-4">

  <!-- 3ml -->
  <button
    :class="[
      selectedSize === '3ml'
        ? 'border-gold-500 bg-primary/10 shadow-[0_0_15px_-5px_rgba(200,155,63,0.3)]'
        : 'border-bronze/30 dark:border-white/20 bg-white/5 hover:border-white/30',
      (() => {
        const s = product?.bottleSizes?.find(x => x.sizeMl === 3);
        return !s || s.enabled === false || s.stock === 0;
      })()
        ? 'opacity-50 cursor-not-allowed'
        : ''
    ]"
    @click="
      (() => {
        const s = product?.bottleSizes?.find(x => x.sizeMl === 3);
        if (s && s.enabled === true && s.stock > 0) {
          selectedSize = '3ml';
        } else {
          autoSelectAvailableSize();
        }
      })()
    "
    :disabled="
      (() => {
        const s = product?.bottleSizes?.find(x => x.sizeMl === 3);
        return !s || s.enabled === false || s.stock === 0;
      })()
    "
    class="relative h-14 rounded-xl border flex flex-col items-center justify-center transition-all duration-300"
  >
    <span :class="selectedSize === '3ml' ? 'text-light-text dark:text-accent' : 'text-light-text dark:text-accent/60'" class="text-sm font-bold">3ml</span>
    <span class="text-[10px] text-light-text dark:text-accent/40">Trial</span>

    <template x-if="
      (() => {
        const s = product?.bottleSizes?.find(x => x.sizeMl === 3);
        return !s || s.enabled === false || s.stock === 0;
      })()
    ">
      <span class="absolute -bottom-3 text-[9px] text-red-400 font-bold">
        Out of stock
      </span>
    </template>
  </button>

  <!-- 6ml -->
  <button
    :class="[
      selectedSize === '6ml'
        ? 'border-gold-500 bg-primary/10 shadow-[0_0_15px_-5px_rgba(200,155,63,0.3)]'
        : 'border-bronze/30 dark:border-white/20 bg-white/5 hover:border-white/30',
      (() => {
        const s = product?.bottleSizes?.find(x => x.sizeMl === 6);
        return !s || s.enabled === false || s.stock === 0;
      })()
        ? 'opacity-50 cursor-not-allowed'
        : ''
    ]"
    @click="
      (() => {
        const s = product?.bottleSizes?.find(x => x.sizeMl === 6);
        if (s && s.enabled === true && s.stock > 0) {
          selectedSize = '6ml';
        } else {
          autoSelectAvailableSize();
        }
      })()
    "
    :disabled="
      (() => {
        const s = product?.bottleSizes?.find(x => x.sizeMl === 6);
        return !s || s.enabled === false || s.stock === 0;
      })()
    "
    class="relative h-14 rounded-xl border flex flex-col items-center justify-center transition-all duration-300"
  >
    <span :class="selectedSize === '6ml' ? 'text-light-text dark:text-accent' : 'text-light-text dark:text-accent/60'" class="text-sm font-bold">6ml</span>
    <span class="text-[10px] text-light-text dark:text-accent/40">Standard</span>

    <template x-if="
      (() => {
        const s = product?.bottleSizes?.find(x => x.sizeMl === 6);
        return !s || s.enabled === false || s.stock === 0;
      })()
    ">
      <span class="absolute -bottom-3 text-[9px] text-red-400 font-bold">
        Out of stock
      </span>
    </template>

    <span class="absolute -top-2 bg-primary text-obsidian text-[9px] font-bold px-1.5 py-0.5 rounded">
      POPULAR
    </span>
  </button>

  <!-- 12ml -->
  <button
    :class="[
      selectedSize === '12ml'
        ? 'border-gold-500 bg-primary/10 shadow-[0_0_15px_-5px_rgba(200,155,63,0.3)]'
        : 'border-bronze/30 dark:border-white/20 bg-white/5 hover:border-white/30',
      (() => {
        const s = product?.bottleSizes?.find(x => x.sizeMl === 12);
        return !s || s.enabled === false || s.stock === 0;
      })()
        ? 'opacity-50 cursor-not-allowed'
        : ''
    ]"
    @click="
      (() => {
        const s = product?.bottleSizes?.find(x => x.sizeMl === 12);
        if (s && s.enabled === true && s.stock > 0) {
          selectedSize = '12ml';
        } else {
          autoSelectAvailableSize();
        }
      })()
    "
    :disabled="
      (() => {
        const s = product?.bottleSizes?.find(x => x.sizeMl === 12);
        return !s || s.enabled === false || s.stock === 0;
      })()
    "
    class="relative h-14 rounded-xl border flex flex-col items-center justify-center transition-all duration-300"
  >
    <span :class="selectedSize === '12ml' ? 'text-light-text dark:text-accent' : 'text-light-text dark:text-accent/60'" class="text-sm font-bold">12ml</span>
    <span class="text-[10px] text-light-text dark:text-accent/40">Grand</span>

    <template x-if="
      (() => {
        const s = product?.bottleSizes?.find(x => x.sizeMl === 12);
        return !s || s.enabled === false || s.stock === 0;
      })()
    ">
      <span class="absolute -bottom-3 text-[9px] text-red-400 font-bold">
        Out of stock
      </span>
    </template>
  </button>
  <template x-if="selectedStockStatus === 'low'">
    <div class="mt-3 text-xs text-yellow-400 font-semibold">
      Hurry! Only a few bottles left.
    </div>
  </template>
  
</div>

</div>


<div class="space-y-3">

  <label class="text-xs uppercase tracking-widest text-light-text dark:text-accent/50 font-bold">
    Quantity
  </label>

  <!-- MAIN ROW -->
  <div class="flex flex-col sm:flex-row sm:items-center sm:gap-6 gap-3">

    <!-- LEFT: quantity controls -->
    <div class="flex items-center gap-3">

      <!-- MINUS -->
      <button
        @click="
          let step = dozenMode ? 12 : 1;
          let q = Number(quantity) - step;
          quantity = String(q < (dozenMode ? 12 : 1) ? (dozenMode ? 12 : 1) : q);
        "
        :disabled="!isSelectedAvailable || quantity <= 1"
        class="h-10 w-10 flex items-center justify-center rounded-lg
               bg-white dark:bg-white/5
               border border-bronze/30 dark:border-white/20
               hover:bg-bronze/10 dark:hover:bg-white/10
               transition"
      >
        âˆ’
      </button>

      <!-- INPUT -->
      <input
        type="text"
        inputmode="numeric"
        x-model="quantity"
        @focus="$event.target.select()"
        @input="
          if (quantity === '') return;
          quantity = quantity.replace(/[^0-9]/g, '');
        "
        @blur="
          let q = Number(quantity);

          if (!q || q < 1) {
            quantity = dozenMode ? '12' : '1';
            return;
          }

          if (dozenMode) {
            const down = Math.floor(q / 12) * 12;
            const up = Math.ceil(q / 12) * 12;
            let nearest =
              Math.abs(q - down) <= Math.abs(up - q) ? down : up;

            if (nearest < 12) nearest = 12;

            if (selectedSizeObj && nearest > selectedSizeObj.stock) {
              nearest = Math.floor(selectedSizeObj.stock / 12) * 12;
            }

            q = nearest;
          }

          if (selectedSizeObj && q > selectedSizeObj.stock) {
            q = dozenMode
              ? Math.floor(selectedSizeObj.stock / 12) * 12
              : selectedSizeObj.stock;
          }

          quantity = String(q);
        "
        class="w-16 text-center bg-white dark:bg-white/10
               border border-bronze/30 dark:border-white/20
               rounded-lg py-2 focus:outline-none"
      />

      <!-- PLUS -->
      <button
        @click="
          let step = dozenMode ? 12 : 1;
          let q = Number(quantity) + step;

          if (selectedSizeObj && q > selectedSizeObj.stock) {
            q = dozenMode
              ? Math.floor(selectedSizeObj.stock / 12) * 12
              : selectedSizeObj.stock;
          }

          quantity = String(q);
        "
        :disabled="!isSelectedAvailable"
        class="h-10 w-10 flex items-center justify-center rounded-lg
               bg-white dark:bg-white/5
               border border-bronze/30 dark:border-white/20
               hover:bg-bronze/10 dark:hover:bg-white/10
               transition"
      >
        +
      </button>
    </div>

    <!-- RIGHT: dozen mode -->
    <div class="flex items-center gap-3">

      <button
      @click="
      dozenMode = !dozenMode;
    
      // save state per product
      localStorage.setItem(
        `dozen-mode:${product._id}`,
        dozenMode
      );
    
      if (dozenMode) {
        // ===== TURNING ON =====
        let q = Number(quantity || 12);
    
        const down = Math.floor(q / 12) * 12;
        const up = Math.ceil(q / 12) * 12;
    
        let nearest =
          Math.abs(q - down) <= Math.abs(up - q) ? down : up;
    
        if (nearest < 12) nearest = 12;
    
        if (selectedSizeObj && nearest > selectedSizeObj.stock) {
          nearest = Math.floor(selectedSizeObj.stock / 12) * 12;
        }
    
        quantity = String(nearest);
        // ðŸ” sync cart items when turning ON dozen mode
        const cart = JSON.parse(localStorage.getItem('cart')) || [];
        
        cart.forEach(item => {
          if (item.productId === product._id) {
            item.dozenMode = true;
        
            let q = Number(item.qty);
        
            const down = Math.floor(q / 12) * 12;
            const up = Math.ceil(q / 12) * 12;
        
            let nearest =
              Math.abs(q - down) <= Math.abs(up - q) ? down : up;
        
            if (nearest < 12) nearest = 12;
        
            if (selectedSizeObj && nearest > selectedSizeObj.stock) {
              nearest = Math.floor(selectedSizeObj.stock / 12) * 12;
            }
        
            item.qty = nearest;
          }
        });
        
        localStorage.setItem('cart', JSON.stringify(cart));
        window.dispatchEvent(new Event('cart-updated'));
        
      } else {
        // ===== TURNING OFF =====
        let q = Number(quantity);
        if (!q || q < 1) q = 1;
        quantity = String(q);
    
        // ðŸ”‘ PUTS YOUR CODE HERE (EXACTLY)
        const cart = JSON.parse(localStorage.getItem('cart')) || [];
    
        cart.forEach(item => {
          if (item.productId === product._id) {
            item.dozenMode = false;
    
            if (item.qty < 1) item.qty = 1;
          }
        });
    
        localStorage.setItem('cart', JSON.stringify(cart));
        window.dispatchEvent(new Event('cart-updated'));
      }
    "        class="h-10 px-5 rounded-full border text-sm font-semibold transition
               border-bronze dark:border-primary"
        :class="dozenMode
          ? 'bg-bronze text-white dark:bg-primary dark:text-secondary'
          : 'bg-transparent hover:bg-bronze/10 dark:hover:bg-primary/10'"
      >
        Dozen Mode
      </button>

      <span class="text-xs opacity-60 whitespace-nowrap">
        Quantity steps by 12
      </span>

    </div>
  </div>

</div>


<div class="py-6 border-y border-bronze/30 dark:border-white/20">
<div class="grid grid-cols-3 gap-6 text-center divide-x divide-bronze/20 dark:divide-white/10
">
<div class="space-y-2 group">
<span class="text-primary material-symbols-outlined text-3xl group-hover:-translate-y-1 transition-transform">spa</span>
<p class="text-xs uppercase tracking-widest text-light-text dark:text-accent/40">Top Notes</p>
<p
  class="text-sm font-medium text-light-text dark:text-accent/90"
  x-text="
    product?.notes?.top?.length
      ? product.notes.top.join(', ')
      : 'Unavailable'
  "
></p>
</div>
<div class="space-y-2 group">
<span class="text-primary material-symbols-outlined text-3xl group-hover:-translate-y-1 transition-transform">local_florist</span>
<p class="text-xs uppercase tracking-widest text-light-text dark:text-accent/40">Heart Notes</p>
<p
  class="text-sm font-medium text-light-text dark:text-accent/90"
  x-text="
    product?.notes?.heart?.length
      ? product.notes.heart.join(', ')
      : 'Unavailable'
  "
></p>
</div>
<div class="space-y-2 group">
<span class="text-primary material-symbols-outlined text-3xl group-hover:-translate-y-1 transition-transform">forest</span>
<p class="text-xs uppercase tracking-widest text-light-text dark:text-accent/40">Base Notes</p>
<p
  class="text-sm font-medium text-light-text dark:text-accent/90"
  x-text="
    product?.notes?.base?.length
      ? product.notes.base.join(', ')
      : 'Unavailable'
  "
></p>
</div>
</div>
</div>
<div class="flex flex-wrap gap-4 text-xs text-light-text dark:text-accent/60">
  <template x-if="product?.attributes?.longLasting">
    <div class="flex items-center gap-1.5 bg-white/5 px-3 py-1.5 rounded-md border border-white/5">
      <span class="material-symbols-outlined text-base text-gold-400">hourglass_top</span>
      <span>12+ Hours Longevity</span>
    </div>
  </template>
  
  <template x-if="product?.attributes?.alcoholFree">
    <div class="flex items-center gap-1.5 bg-white/5 px-3 py-1.5 rounded-md border border-white/5">
      <span class="material-symbols-outlined text-base text-gold-400">water_drop</span>
      <span>Alcohol Free</span>
    </div>
  </template>
  
  <template x-if="product?.attributes?.pureAttar">
    <div class="flex items-center gap-1.5 bg-white/5 px-3 py-1.5 rounded-md border border-white/5">
      <span class="material-symbols-outlined text-base text-gold-400">verified</span>
      <span>Pure Attar Oil</span>
    </div>
  </template>
  <template
  x-if="
    product &&
    (!product.attributes ||
     Object.values(product.attributes).every(v => !v))
  "
>
  <span class="italic opacity-50">
    Unavailable
  </span>
</template>
  
</div>

  
  
<div class="flex gap-4 pt-4">
  <button
  @click="addToCart()"
  class="flex-1 bg-gradient-to-r from-primary to-bronze hover:from-gold-400 hover:to-gold-500
         text-deep-brown font-bold py-4 rounded-xl shadow-lg
         hover:shadow-gold-500/20 transform hover:-translate-y-0.5
         transition-all duration-300 flex items-center justify-center gap-2 group"
>
  <span class="material-symbols-outlined group-hover:animate-bounce">
    shopping_cart
  </span>
  Add to Cart
</button>



<button
  @click="buyNow()"
  class="flex-1 border border-gold-500 text-gold-400 font-bold py-4 rounded-xl hover:bg-primary/10 transform hover:-translate-y-0.5 transition-all duration-300 flex items-center justify-center gap-2"
>
  Buy Now
</button>

</div>
</div>
</div>
<section
  id="productReviewsSection"
  class="mt-16 space-y-10 animate-slide-up
         bg-white/40 dark:bg-transparent
         rounded-2xl p-6 md:p-8
         border border-bronze/30 dark:border-white/20"
  style="animation-delay: 0.4s;"
>



<!-- HEADER -->
<div class="flex flex-col md:flex-row md:items-end justify-between gap-4
            border-b border-bronze/30 dark:border-white/20 pb-6">
  <div>
    <h2 class="text-3xl font-serif font-bold text-light-text dark:text-accent mb-2">
      Customer Reviews
    </h2>

    <div class="flex items-center gap-4">
      <!-- STARS -->
      <div id="reviewStars" class="flex text-gold-500"></div>

      <!-- AVERAGE -->
      <span id="reviewAverage"
      class="text-lg font-medium text-light-text dark:text-accent">
      
        0.0/5
      </span>

      <!-- COUNT -->
      <span id="reviewCount"
      class="text-light-text/50 dark:text-accent/50 text-sm tracking-wide">
      
        0 Reviews
      </span>
    </div>
  </div>
</div>

<!-- LIST -->
<div id="reviewList" class="space-y-6"></div>

<!-- VIEW ALL -->
<button
  id="viewAllReviewsBtn"
  onclick="openAllReviewsModal()"
  class="w-full py-3 text-xs uppercase tracking-[0.2em]
  font-bold text-bronze hover:text-primary
  dark:text-accent/50 dark:hover:text-primary
  transition-colors border-t border-bronze/30 dark:border-white/20
  mt-4 hidden"

>
  View All Reviews
</button>

</section>
<div class="mt-24 border-t border-bronze/30 dark:border-white/20 pt-16">
<div class="text-center max-w-3xl mx-auto space-y-6">
<h2 class="text-3xl font-serif text-light-text dark:text-accent">The Art of <span class="text-primary">Perfume Making</span></h2>
<p class="text-light-text dark:text-accent/60 leading-relaxed font-light">
                        Handcrafted with the rarest ingredients sourced from the depths of the Orient. 
                        Each drop of Hirah Attar is aged to perfection, ensuring a scent that evolves uniquely on your skin.
                        Free from alcohol and harsh chemicals, providing a pure, long-lasting olfactory experience.
                    </p>
<div class="flex justify-center gap-8 pt-8 opacity-70">
<div class="text-center">
<div class="w-16 h-16 rounded-full bg-white/5 flex items-center justify-center mx-auto mb-3 border border-bronze/30 dark:border-white/20">
<span class="material-symbols-outlined text-gold-400 text-2xl">science</span>
</div>
<p class="text-xs uppercase tracking-widest">Hand Blended</p>
</div>
<div class="text-center">
<div class="w-16 h-16 rounded-full bg-white/5 flex items-center justify-center mx-auto mb-3 border border-bronze/30 dark:border-white/20">
<span class="material-symbols-outlined text-gold-400 text-2xl">eco</span>
</div>
<p class="text-xs uppercase tracking-widest">Natural Oils</p>
</div>
<div class="text-center">
<div class="w-16 h-16 rounded-full bg-white/5 flex items-center justify-center mx-auto mb-3 border border-bronze/30 dark:border-white/20">
<span class="material-symbols-outlined text-gold-400 text-2xl">cruelty_free</span>
</div>
<p class="text-xs uppercase tracking-widest">Cruelty Free</p>
</div>
</div>
</div>
</div>
</div>
</main>
<footer class="bg-accent/50 dark:bg-secondary/50 pt-20 pb-8">
  <div class="container mx-auto px-4 md:px-8">

    <!-- TOP GRID -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-10 text-center md:text-left">

      <!-- BRAND -->
      <div class="md:col-span-1 flex flex-col items-center md:items-start">
        <div class="flex items-center gap-3">
          <div class="h-8 w-8 text-bronze dark:text-primary">
            <img
            src="assets/images/logo.png"
            alt="Attar Store Logo"
            class="h-8 w-8 object-cover rounded-full"
            />
          </div>
          <span class="text-xl font-bold font-display text-light-text dark:text-accent">
            Attar Store          </span>
        </div>

        <p class="mt-4 max-w-xs text-light-text/70 dark:text-dark-text/70 text-sm">
          Luxury attars crafted with purity, tradition, and elegance â€” delivering timeless fragrance experiences.
        </p>
      </div>

      <!-- QUICK LINKS -->
      <div>
        <h3 class="text-lg font-bold font-display text-light-text dark:text-white mb-4">
          Quick Links
        </h3>
        <ul class="space-y-2 text-sm">
          <li><a href="index.html" class="footer-link">Home</a></li>
          <li><a href="ProductListed.html" class="footer-link">Products</a></li>
          <li><a href="Blogs.html" class="footer-link">Blogs</a></li>
          <li><a href="cart.html" class="footer-link">Cart</a></li>
          <li><a href="contactUS.html" class="footer-link">Contact Us</a></li>
        </ul>
      </div>

      <!-- COMPANY -->
      <div>
        <h3 class="text-lg font-bold font-display text-light-text dark:text-white mb-4">
          Company
        </h3>
        <ul class="space-y-2 text-sm">
          <li><a href="AboutUS.html" class="footer-link">About Us</a></li>
          <li><a href="FAQ.html" class="footer-link">FAQ</a></li>
          <li><a href="contactUS.html" class="footer-link">Support</a></li>
        </ul>
      </div>

    <!-- SOCIAL + CONNECT -->
<div>
  <h3 class="text-lg font-bold font-display text-light-text dark:text-white mb-4">
    Connect
  </h3>
 
  <!-- SOCIAL ICONS -->
  <div class="mt-6 flex justify-center md:justify-start gap-4">
    <!-- WhatsApp -->
    <a href="#" aria-label="WhatsApp"
       class="social-outline hover:border-green-500 hover:text-green-500">
       <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-whatsapp" viewBox="0 0 16 16">
        <path d="M13.601 2.326A7.85 7.85 0 0 0 7.994 0C3.627 0 .068 3.558.064 7.926c0 1.399.366 2.76 1.057 3.965L0 16l4.204-1.102a7.9 7.9 0 0 0 3.79.965h.004c4.368 0 7.926-3.558 7.93-7.93A7.9 7.9 0 0 0 13.6 2.326zM7.994 14.521a6.6 6.6 0 0 1-3.356-.92l-.24-.144-2.494.654.666-2.433-.156-.251a6.56 6.56 0 0 1-1.007-3.505c0-3.626 2.957-6.584 6.591-6.584a6.56 6.56 0 0 1 4.66 1.931 6.56 6.56 0 0 1 1.928 4.66c-.004 3.639-2.961 6.592-6.592 6.592m3.615-4.934c-.197-.099-1.17-.578-1.353-.646-.182-.065-.315-.099-.445.099-.133.197-.513.646-.627.775-.114.133-.232.148-.43.05-.197-.1-.836-.308-1.592-.985-.59-.525-.985-1.175-1.103-1.372-.114-.198-.011-.304.088-.403.087-.088.197-.232.296-.346.1-.114.133-.198.198-.33.065-.134.034-.248-.015-.347-.05-.099-.445-1.076-.612-1.47-.16-.389-.323-.335-.445-.34-.114-.007-.247-.007-.38-.007a.73.73 0 0 0-.529.247c-.182.198-.691.677-.691 1.654s.71 1.916.81 2.049c.098.133 1.394 2.132 3.383 2.992.47.205.84.326 1.129.418.475.152.904.129 1.246.08.38-.058 1.171-.48 1.338-.943.164-.464.164-.86.114-.943-.049-.084-.182-.133-.38-.232"/>
      </svg>
    </a>

    <!-- Facebook -->
    <a href="#" aria-label="Facebook"
       class="social-outline hover:border-blue-600 hover:text-blue-600">
       <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-facebook" viewBox="0 0 16 16">
        <path d="M16 8.049c0-4.446-3.582-8.05-8-8.05C3.58 0-.002 3.603-.002 8.05c0 4.017 2.926 7.347 6.75 7.951v-5.625h-2.03V8.05H6.75V6.275c0-2.017 1.195-3.131 3.022-3.131.876 0 1.791.157 1.791.157v1.98h-1.009c-.993 0-1.303.621-1.303 1.258v1.51h2.218l-.354 2.326H9.25V16c3.824-.604 6.75-3.934 6.75-7.951"/>
      </svg>
    </a>

    <!-- Instagram -->
    <a href="#" aria-label="Instagram"
       class="social-outline hover:border-pink-500 hover:text-pink-500">
       <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-instagram" viewBox="0 0 16 16">
        <path d="M8 0C5.829 0 5.556.01 4.703.048 3.85.088 3.269.222 2.76.42a3.9 3.9 0 0 0-1.417.923A3.9 3.9 0 0 0 .42 2.76C.222 3.268.087 3.85.048 4.7.01 5.555 0 5.827 0 8.001c0 2.172.01 2.444.048 3.297.04.852.174 1.433.372 1.942.205.526.478.972.923 1.417.444.445.89.719 1.416.923.51.198 1.09.333 1.942.372C5.555 15.99 5.827 16 8 16s2.444-.01 3.298-.048c.851-.04 1.434-.174 1.943-.372a3.9 3.9 0 0 0 1.416-.923c.445-.445.718-.891.923-1.417.197-.509.332-1.09.372-1.942C15.99 10.445 16 10.173 16 8s-.01-2.445-.048-3.299c-.04-.851-.175-1.433-.372-1.941a3.9 3.9 0 0 0-.923-1.417A3.9 3.9 0 0 0 13.24.42c-.51-.198-1.092-.333-1.943-.372C10.443.01 10.172 0 7.998 0zm-.717 1.442h.718c2.136 0 2.389.007 3.232.046.78.035 1.204.166 1.486.275.373.145.64.319.92.599s.453.546.598.92c.11.281.24.705.275 1.485.039.843.047 1.096.047 3.231s-.008 2.389-.047 3.232c-.035.78-.166 1.203-.275 1.485a2.5 2.5 0 0 1-.599.919c-.28.28-.546.453-.92.598-.28.11-.704.24-1.485.276-.843.038-1.096.047-3.232.047s-2.39-.009-3.233-.047c-.78-.036-1.203-.166-1.485-.276a2.5 2.5 0 0 1-.92-.598 2.5 2.5 0 0 1-.6-.92c-.109-.281-.24-.705-.275-1.485-.038-.843-.046-1.096-.046-3.233s.008-2.388.046-3.231c.036-.78.166-1.204.276-1.486.145-.373.319-.64.599-.92s.546-.453.92-.598c.282-.11.705-.24 1.485-.276.738-.034 1.024-.044 2.515-.045zm4.988 1.328a.96.96 0 1 0 0 1.92.96.96 0 0 0 0-1.92m-4.27 1.122a4.109 4.109 0 1 0 0 8.217 4.109 4.109 0 0 0 0-8.217m0 1.441a2.667 2.667 0 1 1 0 5.334 2.667 2.667 0 0 1 0-5.334"/>
      </svg>
    </a>

    <!-- TikTok -->
    <a href="#" aria-label="TikTok"
       class="social-outline hover:border-black hover:text-black dark:hover:border-white dark:hover:text-white">
      <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
        <path d="M21 8.1c-1.5 0-3-.5-4.2-1.4v8.4a6.5 6.5 0 1 1-5.7-6.4v3.4a3.1 3.1 0 1 0 2.3 3V0h3.4c.2 1.2.8 2.4 1.7 3.3 1 1 2.3 1.6 3.7 1.8v3z"/>
      </svg>
    </a>

  </div>
</div>

    </div>

  <!-- BOTTOM -->
<div class="mt-12 border-t border-bronze/20 dark:border-primary/20 pt-6
flex flex-col md:flex-row items-center md:justify-between
text-sm text-light-text/60 dark:text-dark-text/60 gap-4">

<!-- Copyright -->
<div class="text-center md:text-left">
Â© 2026 Hirah Attar. All Rights Reserved.
</div>

<!-- LEGAL LINKS (BOTTOM RIGHT) -->
<div class="flex gap-6">
<a href="privacyPolicy.html" class="footer-link hover:underline">
Privacy Policy
</a>
<a href="terms.html" class="footer-link hover:underline">
Terms of Service
</a>
</div>

</div>

  </div>
</footer>
<style>
  .social-outline {
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 9999px;
    border: 1px solid rgba(0,0,0,0.25);
    color: #000;
    transition: all 0.25s ease;
  }

  .dark .social-outline {
    border-color: rgba(255,255,255,0.3);
    color: #fff;
  }

  /* ================= DARK MODE SOCIAL HOVER FIX ================= */

  .dark a[aria-label="WhatsApp"]:hover {
    color: #22c55e;
    border-color: #22c55e;
  }

  .dark a[aria-label="Facebook"]:hover {
    color: #2563eb;
    border-color: #2563eb;
  }

  .dark a[aria-label="Instagram"]:hover {
    color: #ec4899;
    border-color: #ec4899;
  }

  .dark a[aria-label="TikTok"]:hover {
    color: #ffffff;
    border-color: #ffffff;
  }
</style>
<script>
  (function () {
    const root = document.documentElement;
  
    // restore theme
    const savedTheme = localStorage.getItem("theme");
    if (savedTheme === "dark") {
      root.classList.add("dark");
    } else {
      root.classList.remove("dark");
    }
  
    // global toggle
    window.toggleTheme = function () {
      const isDark = root.classList.toggle("dark");
      localStorage.setItem("theme", isDark ? "dark" : "light");
    };
  })();
  </script>
  



  

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const user = getUser();
    if (!user) return;

    // default name
    if (!user.name && user.email) {
      user.name = user.email.split("@")[0];
    }

    // default avatar
    if (!user.avatar) {
      const initials = user.name
        .split(" ")
        .map(w => w[0])
        .join("")
        .substring(0, 2)
        .toUpperCase();

      user.avatar = `https://ui-avatars.com/api/?name=${initials}&background=8B5A2B&color=fff`;
    }

    // apply avatar
    document.querySelectorAll("[data-user-avatar]").forEach(el => {
      el.src = user.avatar;
      el.classList.remove("hidden");
    });

    document.getElementById("guest-profile-btn")?.classList.add("hidden");
  });

  function updateCartBadge() {
  const badge = document.getElementById("cart-count");
  if (!badge) return;

  const cart = JSON.parse(localStorage.getItem("cart")) || [];
  const count = cart.reduce((sum, i) => sum + i.qty, 0);

  badge.textContent = count;
  badge.style.display = count > 0 ? "flex" : "none";
}

window.addEventListener("cart-updated", updateCartBadge);
document.addEventListener("DOMContentLoaded", updateCartBadge);

</script>
<!-- AUTH MODAL -->
<div id="authModal" class="fixed inset-0 z-[999] hidden items-center justify-center">
  <!-- Overlay -->
  <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="closeAuthModal()"></div>

  <!-- Modal -->
  <div class="relative w-full max-w-[440px] mx-auto">
    <div class="bg-white dark:bg-[#181611] text-black dark:text-white border border-gray-200 dark:border-border-dark rounded-2xl shadow-2xl overflow-hidden flex flex-col group max-h-[90vh]">

      <!-- Header -->
      <div class="pt-8 px-8 pb-3 text-center">
        <div class="group-has-[#tab-signup:checked]:hidden">
          <h2 class="text-3xl font-extrabold">Welcome Back</h2>
          <p class="text-gray-500 dark:text-text-muted text-sm">
            Sign in to continue
          </p>
        </div>
        <div class="hidden group-has-[#tab-signup:checked]:block">
          <h2 class="text-3xl font-extrabold">Create Account</h2>
          <p class="text-gray-500 dark:text-text-muted text-sm">
            Join Hirah Attar today
          </p>
        </div>
      </div>

    <!-- Tabs -->
<div class="px-8 pb-5">
  <div
    class="flex h-12 rounded-xl p-1
           bg-gray-100 dark:bg-[#23201a]"
  >

    <!-- LOG IN -->
    <label
      class="flex-1 flex items-center justify-center cursor-pointer rounded-lg
             font-bold transition-all duration-300
             text-gray-700 dark:text-gray-300
             has-[:checked]:bg-primary
             has-[:checked]:text-secondary
             has-[:checked]:shadow-glow-gold"
    >
      Log In
      <input checked id="tab-login" type="radio" name="auth_tab" class="hidden">
    </label>

    <!-- SIGN UP -->
    <label
      class="flex-1 flex items-center justify-center cursor-pointer rounded-lg
             font-bold transition-all duration-300
             text-gray-700 dark:text-gray-300
             has-[:checked]:bg-primary
             has-[:checked]:text-secondary
             has-[:checked]:shadow-glow-gold"
    >
      Sign Up
      <input id="tab-signup" type="radio" name="auth_tab" class="hidden">
    </label>

  </div>
</div>

      <!-- Content -->
      <div class="overflow-y-auto flex-1 px-8 pb-6">

    <!-- LOGIN FORM -->
<div class="hidden group-has-[#tab-login:checked]:block">
  <form onsubmit="event.preventDefault()" class="space-y-4">
    <input id="loginEmail"
      class="w-full h-12 rounded-xl px-4 bg-gray-100 dark:bg-[#27241b]"
      placeholder="Email">

    <input id="loginPassword" type="password"
      class="w-full h-12 rounded-xl px-4 bg-gray-100 dark:bg-[#27241b]"
      placeholder="Password">

    <button type="button" onclick="loginUser()"
      class="w-full h-12 bg-primary text-black rounded-xl font-bold">
      Log In
    </button>
  </form>
</div>

<!-- SIGNUP FORM -->
<div id="signupBox" class="hidden group-has-[#tab-signup:checked]:block">
  <form onsubmit="event.preventDefault()" class="space-y-4">
    <input id="signupEmail"
      class="w-full h-12 rounded-xl px-4 bg-gray-100 dark:bg-[#27241b]"
      placeholder="Email">

    <input id="signupPassword" type="password"
      class="w-full h-12 rounded-xl px-4 bg-gray-100 dark:bg-[#27241b]"
      placeholder="Password">

    <input id="signupConfirm" type="password"
      class="w-full h-12 rounded-xl px-4 bg-gray-100 dark:bg-[#27241b]"
      placeholder="Confirm Password">

    <button   id="signupBtn"
    type="button" onclick="signupUser()"
      class="w-full h-12 bg-primary text-black rounded-xl font-bold">
      Sign Up
    </button>
  </form>
</div>


        <!-- Divider -->
        <div class="flex items-center my-6">
          <div class="flex-1 h-px bg-gray-300 dark:bg-border-dark"></div>
          <span class="mx-3 text-xs text-gray-400 uppercase font-bold">
            or continue with
          </span>
          <div class="flex-1 h-px bg-gray-300 dark:bg-border-dark"></div>
        </div>

        <!-- Social Login -->
        <div class="grid grid-cols-2 gap-4">
          <button
          onclick="loginWithGoogle()"
          class="h-12 flex items-center justify-center gap-2 rounded-xl
          border border-gray-300 dark:border-border-dark
          hover:bg-gray-100 dark:hover:bg-[#27241b]">
            <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12.545 10.239v3.821h5.445c-.712 2.315-2.647 3.972-5.445 3.972-3.332 0-6.033-2.701-6.033-6.032s2.701-6.032 6.033-6.032c1.498 0 2.866.549 3.921 1.453l2.814-2.814C17.503 2.988 15.139 2 12.545 2 7.021 2 2.543 6.477 2.543 12s4.478 10 10.002 10c8.396 0 10.249-7.85 9.426-11.748z"/>
            </svg>
            Google
          </button>

          <button class="h-12 flex items-center justify-center gap-2 rounded-xl
            border border-gray-300 dark:border-border-dark
            hover:bg-gray-100 dark:hover:bg-[#27241b]">
            <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
              <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
            </svg>
            Facebook
          </button>
        </div>
<!-- VERIFY OTP -->

      </div>


      <!-- Footer -->
      <div class="py-4 text-center border-t border-gray-200 dark:border-border-dark">
        <p class="group-has-[#tab-signup:checked]:hidden text-sm">
          Donâ€™t have an account?
          <label for="tab-signup" class="text-primary font-bold cursor-pointer">
            Sign Up
          </label>
        </p>
        <p class="hidden group-has-[#tab-signup:checked]:block text-sm">
          Already have an account?
          <label for="tab-login" class="text-primary font-bold cursor-pointer">
            Log In
          </label>
        </p>
      </div>

      <!-- Close -->
      <button onclick="closeAuthModal()" class="absolute top-4 right-4 text-xl opacity-60 hover:opacity-100">
        âœ•
      </button>

    </div>
  </div>
</div>
<!-- OTP MODAL -->
<div id="otpModal" class="fixed inset-0 z-[1000] hidden items-center justify-center">
  <!-- Overlay -->
  <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="closeOtpModal()"></div>

  <!-- Box -->
  <div class="relative w-full max-w-[360px] mx-auto bg-white dark:bg-[#181611]
              text-black dark:text-white rounded-2xl shadow-2xl p-6">

    <h2 class="text-2xl font-extrabold text-center mb-2">Verify Email</h2>
    <p class="text-center text-sm text-gray-500 mb-4">
      Enter the 4-digit code sent to your email
    </p>

    <input id="otpCode"
      maxlength="4"
      class="w-full h-12 text-center text-2xl tracking-widest rounded-xl
             bg-gray-100 dark:bg-[#27241b]"
      placeholder="____">

    <button onclick="verifyOTP()"
      class="w-full h-12 bg-primary text-black rounded-xl font-bold mt-4">
      Verify
    </button>

    <div class="flex justify-between text-sm mt-4">
      <button onclick="closeOtpModal()" class="text-primary font-semibold">
        Cancel
      </button>
      <button onclick="resendOTP()" class="text-primary font-semibold">
        Resend
      </button>
    </div>
  </div>
</div>
<script>
  const AUTH_API = "https://perfume-store-production.up.railway.app/api/auth";

  function restrictedAction(e) {
    if (!localStorage.getItem("token")) {
      e.preventDefault();
      openAuthModal(); // from global.js
    }
  }

  /* ---------------- LOGIN ---------------- */
  updateAuthUI();
  syncUserUI();
  async function loginUser() {
    const email = loginEmail.value.trim();
    const password = loginPassword.value.trim();

    if (!email || !password) {
      alert("Email and password are required");
      return;
    }

    const res = await fetch(`${AUTH_API}/login`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email, password })
    });

    const data = await res.json();
    if (!res.ok) {
      alert(data.message);
      return;
    }

    localStorage.setItem("token", data.token);
    localStorage.setItem("user", JSON.stringify(data.user));

    closeAuthModal(); // from global.js
  }

  /* ---------------- SIGNUP ---------------- */
  async function signupUser() {
  const email = signupEmail.value.trim();
  const password = signupPassword.value.trim();
  const confirm = signupConfirm.value.trim();

  if (!email || !password || !confirm) {
    alert("All fields required");
    return;
  }

  if (password !== confirm) {
    alert("Passwords do not match");
    return;
  }

  // âœ… UX: show loading immediately
  const btn = document.getElementById("signupBtn");
  btn.disabled = true;
  btn.innerText = "Sending OTP...";

  try {
    const res = await fetch(`${AUTH_API}/signup`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email, password })
    });

    const data = await res.json();

    if (!res.ok && !data.requiresOTP) {
      alert(data.message);
      return;
    }

    window.pendingEmail = email;
    closeAuthModal();
    openOtpModal();

  } finally {
    // âœ… restore button state
    btn.disabled = false;
    btn.innerText = "Sign Up";
  }
}


  /* ---------------- VERIFY OTP ---------------- */

  async function verifyOTP() {
    const code = otpCode.value.trim();
    if (code.length !== 4) {
      alert("Enter 4-digit code");
      return;
    }

    const res = await fetch(`${AUTH_API}/verify`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        email: window.pendingEmail,
        code
      })
    });

    const data = await res.json();
    if (!res.ok) {
      alert(data.message);
      return;
    }

    localStorage.setItem("token", data.token);
    localStorage.setItem("user", JSON.stringify(data.user));

    closeOtpModal(); // from global.js
  }
</script>


<div id="allReviewsModal"
  class="fixed inset-0 z-50 hidden items-center justify-center p-4 sm:p-6">

  <!-- BACKDROP -->
  <div
    onclick="closeAllReviewsModal()"
    class="fixed inset-0 bg-black/70 backdrop-blur-sm">
  </div>

  <!-- MODAL -->
  <div
    class="relative w-full max-w-3xl
           bg-accent dark:bg-secondary
           border border-bronze/30 dark:border-white/20
           rounded-2xl
           shadow-2xl
           overflow-hidden">

    <!-- HEADER -->
    <div
      class="px-6 py-4 flex justify-between items-center
             border-b border-bronze/30 dark:border-white/20
             bg-white/40 dark:bg-white/5">

      <h3 class="text-xl font-serif font-bold text-light-text dark:text-accent">
        All Reviews
      </h3>

      <button
        onclick="closeAllReviewsModal()"
        class="h-8 w-8 flex items-center justify-center rounded-full
               hover:bg-bronze/10 dark:hover:bg-white/10
               text-bronze dark:text-accent transition">
        <span class="material-symbols-outlined text-xl">close</span>
      </button>
    </div>

    <!-- LIST -->
    <div
      id="allReviewsList"
      class="p-6 space-y-6 max-h-[70vh] overflow-y-auto
             bg-white/20 dark:bg-transparent">
    </div>

  </div>
</div>

<script>
  function productPage() {
    return {
      // ================= CORE STATE =================
      product: null,
      loading: true,
      error: null,
      quantity: 1,
      dozenMode: false,

      wishlist: false,
      selectedSize: "6ml",
      selectedVariant: null,
  
      // ================= REVIEW NUDGE =================
      nudgeVisible: false,
      userOrderId: null,
      pendingQueue: null,
  
      // ================= INIT =================
      async init() {
        await this.loadProduct();
        await this.checkReviewNudge();
      },
  
      // ================= REVIEW NUDGE LOGIC =================
      async checkReviewNudge() {
  const token = localStorage.getItem("token");
  if (!token || !this.product?._id) {
    this.nudgeVisible = false;
    return;
  }

  try {
    const res = await fetch("https://perfume-store-production.up.railway.app/api/orders/my", {
      headers: { Authorization: `Bearer ${token}` }
    });

    const data = await res.json();
    if (!data.success || !Array.isArray(data.orders)) {
      this.nudgeVisible = false;
      return;
    }

    // DEFAULT: hide nudge
    this.nudgeVisible = false;
    this.userOrderId = null;
    this.pendingQueue = null;

    for (const order of data.orders) {
      // âœ… STRICT RULE: review ONLY after delivered
      if (order.orderStatus !== "delivered") continue;

      if (!Array.isArray(order.reviewQueue)) continue;

      const pending = order.reviewQueue.find(q =>
        String(q.productId) === String(this.product._id) &&
        q.reviewed === false
      );

      if (pending) {
        this.userOrderId = order._id;
        this.pendingQueue = order.reviewQueue;
        this.nudgeVisible = true;
        break; // stop at first valid delivered order
      }
    }

  } catch (err) {
    console.error("Review nudge check failed:", err);
    this.nudgeVisible = false;
  }
},

openReviewFromNudge() {
  if (!this.userOrderId || !this.product?._id) {
    console.warn("Review nudge missing data");
    return;
  }

  const url = new URL("./profile.html", window.location.href);
  url.searchParams.set("reviewOrderId", this.userOrderId);
  url.searchParams.set("reviewProductId", this.product._id);

  window.location.href = url.toString();
},




// ================= STOCK / CART LOGIC =================
      get isInStock() {
        if (!this.product) return false;
        return Number(this.product.inventoryQty) > 0;
      },
  
      get totalPrice() {
        if (!this.priceData) return 0;
        const unit = Number(this.priceData.discounted ?? this.priceData.original);
        return (unit * this.quantity).toFixed(2);
      },
  
      addToCart() {
        if (!this.product) return;
  
        const sizeObj = this.selectedSizeObj;
        if (!sizeObj || !sizeObj.enabled || sizeObj.stock <= 0) {
          this.showToast("This size is out of stock");
          return;
        }
  
        const cart = JSON.parse(localStorage.getItem("cart")) || [];
  
        const item = {
          productId: this.product._id,
          name: this.product.name,
          image: this.product.images?.[0] || null,
          size: this.selectedSize,
          variant: this.selectedVariant,
          price: Number(this.priceData.discounted ?? this.priceData.original),
          qty: this.quantity,
          dozenMode: this.dozenMode,

        };
  
        const existing = cart.find(
          p =>
            p.productId === item.productId &&
            p.size === item.size &&
            p.variant === item.variant
        );
  
        if (existing) {
  existing.qty = Number(existing.qty) + Number(item.qty);
} else {
  cart.push(item);
}

        localStorage.setItem("cart", JSON.stringify(cart));
        window.dispatchEvent(new Event("cart-updated"));
        this.showToast("Added to cart");
        // ðŸ” RESET QUANTITY AFTER ADD
this.quantity = this.dozenMode ? '12' : '1';

      },
  
      buyNow() {
  if (!this.product) return;

  const user = localStorage.getItem("user");
  if (!user) {
    openAuthModal();
    return;
  }

  const sizeObj = this.selectedSizeObj;
  if (!sizeObj || !sizeObj.enabled || sizeObj.stock <= 0) {
    this.showToast("This size is out of stock");
    return;
  }

  if (this.quantity > sizeObj.stock) {
    this.quantity = sizeObj.stock;
    this.showToast("Quantity adjusted to available stock");
    return;
  }

  // âœ… ONLY NEW RULE (VERY SMALL)
  if (
    this.product.quality &&
    this.product.quality.toLowerCase() === "normal" &&
    Number(this.quantity) < 12
  ) {
    this.showToast(
      "Minimum 12 items required for normal quality products"
    );
    return;
  }

  // ðŸ” ORIGINAL LOGIC (UNCHANGED)
  const cart = [];

  const item = {
    productId: this.product._id,
    name: this.product.name,
    image: this.product.images?.[0] || null,
    size: this.selectedSize,
    variant: this.selectedVariant,
    price: Number(this.priceData.discounted ?? this.priceData.original),
    qty: this.quantity
  };

  cart.push(item);
  localStorage.setItem("cart", JSON.stringify(cart));
  window.dispatchEvent(new Event("cart-updated"));
  window.location.href = "checkout.html";
}, 
      showToast(message) {
        const toast = document.createElement("div");
        toast.textContent = message;
        toast.className =
          "fixed bottom-6 right-6 bg-black text-white px-6 py-3 rounded-xl shadow-lg z-50 animate-fade-in";
        document.body.appendChild(toast);
        setTimeout(() => toast.remove(), 2000);
      },
  
      // ================= PRODUCT LOADER =================
      async loadProduct() {
        try {
          const params = new URLSearchParams(window.location.search);
          const slug = params.get("slug");
          if (!slug) {
            this.error = "Invalid product";
            return;
          }
  
          const res = await fetch(
            `https://perfume-store-production.up.railway.app/api/products/slug/${slug}`
          );
  
          if (!res.ok) throw new Error("Failed to load product");
  
          const data = await res.json();
          this.product = data.product;
  // restore dozen mode per product
const saved = localStorage.getItem(
  `dozen-mode:${this.product._id}`
);
this.dozenMode = saved === "true";

          this.autoSelectAvailableSize();
          this.selectedVariant =
            this.product.fragranceVariants?.[0] || null;
  
          if (this.product?._id) {
            loadProductReviews(this.product._id);
          }
  
          this.$watch("quantity", value => {
  if (!this.product) return;

  if (value === '') return;

  if (Number(value) < 1) {
    this.quantity = this.dozenMode ? '12' : '1';
  }
});


        } catch (err) {
          console.error(err);
          this.error = "Failed to load product";
        } finally {
          this.loading = false;
        }
      },
  
      // ================= SIZE / PRICE HELPERS =================
      get selectedSizeObj() {
        if (!this.product || !this.selectedSize) return null;
        const ml = Number(this.selectedSize.replace("ml", ""));
        return this.product.bottleSizes?.find(s => s.sizeMl === ml) || null;
      },
  
      get isSelectedAvailable() {
        const s = this.selectedSizeObj;
        return !!(s && s.enabled === true && s.stock > 0);
      },
  
      get selectedStockStatus() {
        const s = this.selectedSizeObj;
        if (!s) return null;
        if (s.stock === 0 || s.enabled === false) return "out";
        if (s.stock > 0 && s.stock <= 20) return "low";
        return "in";
      },
  
      autoSelectAvailableSize() {
        if (!this.product?.bottleSizes?.length) return;
        const firstAvailable = this.product.bottleSizes.find(
          s => s.enabled === true && s.stock > 0
        );
        if (firstAvailable) {
          this.selectedSize = firstAvailable.sizeMl + "ml";
        } else {
          this.selectedSize = null;
        }
      },
  
      get priceData() {
        if (!this.product?.prices) return null;
  
        const base = Number(this.product.prices.base6ml);
        const perc = this.product.prices.sizePercentages || {};
        const disc = this.product.prices.discountPercentages || {};
  
        let price = base;
        if (this.selectedSize === "3ml") {
          price = base + base * ((perc.size3 ?? 0) / 100);
        }
        if (this.selectedSize === "12ml") {
          price = base + base * ((perc.size12 ?? 0) / 100);
        }
  
        let discount = null;
        if (this.selectedSize === "3ml") discount = disc.size3;
        else if (this.selectedSize === "12ml") discount = disc.size12;
        else discount = disc.base;
  
        const discounted =
          discount !== null && discount !== undefined
            ? price - price * (discount / 100)
            : null;
  
        return {
          original: price.toFixed(2),
          discounted: discounted ? discounted.toFixed(2) : null
        };
      },
  
      get variants() {
        if (!this.product?.fragranceVariants?.length) return [];
        const colors = [
          "bg-stone-800",
          "bg-zinc-700",
          "bg-rose-900",
          "bg-amber-800",
          "bg-emerald-900"
        ];
        return this.product.fragranceVariants.map((v, i) => ({
          name: v,
          color: colors[i % colors.length]
        }));
      }
    };
  }
  </script>
  
  
  

  <script>
    // store full review list
    let __allProductReviews = [];
  
    // hook into existing loader
    const __originalLoadProductReviews = loadProductReviews;
    loadProductReviews = async function (productId) {
      await __originalLoadProductReviews(productId);
  
      try {
        const res = await fetch(
          `https://perfume-store-production.up.railway.app/api/products/${productId}/reviews`
        );
        const data = await res.json();
        if (data.success) {
          __allProductReviews = data.reviews || [];
        }
      } catch (e) {
        console.error("Failed to cache reviews", e);
      }
    };
  
    function openAllReviewsModal() {
      const modal = document.getElementById("allReviewsModal");
      const list = document.getElementById("allReviewsList");
  
      if (!modal || !list) return;
  
      list.innerHTML = "";
  
      if (!__allProductReviews.length) {
        list.innerHTML = `
          <p class="text-center text-white/60 italic">
            No reviews available.
          </p>
        `;
      }
  
      __allProductReviews.forEach(r => {
        const div = document.createElement("div");
        div.className =
  "rounded-xl p-5 space-y-2 " +
  "bg-white/50 dark:bg-white/5 " +
  "border border-bronze/30 dark:border-white/20";

  
        div.innerHTML = `
          <div class="flex justify-between items-start mb-2">
            <span class="font-serif text-lg text-white">
              ${escapeHtml(r.user || "User")}
            </span>
  
            <div class="flex gap-0.5">
              ${renderStarRow(r.rating)}
            </div>
          </div>
  
          <p class="text-white/80 italic text-sm mb-3">
            "${escapeHtml(r.comment || "")}"
          </p>
  
          ${
            r.adminReply
              ? `
                <div class="bg-gold-500/10 border-l-2 border-gold-400
                            rounded-md p-3 mt-3">
                  <p class="text-[11px] uppercase tracking-widest
                             text-gold-400 font-bold mb-1">
                    Admin Reply
                  </p>
                  <p class="text-white/70 text-sm">
                    ${escapeHtml(r.adminReply)}
                  </p>
                </div>
              `
              : ""
          }
        `;
  
        list.appendChild(div);
      });
  
      modal.classList.remove("hidden");
      modal.classList.add("flex");
    }
  
    function closeAllReviewsModal() {
      const modal = document.getElementById("allReviewsModal");
      if (!modal) return;
  
      modal.classList.add("hidden");
      modal.classList.remove("flex");
    }
  </script>
  
  <script src="js/global.js"></script>

  
</body></html>