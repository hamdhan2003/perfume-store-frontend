<!DOCTYPE html>
<html class="dark" lang="en">
  <head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Attar Store - Admin Dashboard</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;800&amp;family=Cairo:wght@400;600;700&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>

<script id="tailwind-config">

    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            "primary": "#C89B3F", // Gold
            "secondary": "#0A192F", // Deep Navy
            "accent": "#F5F1E9", // Cream
            "bronze": "#A97142",
            "light-bg": "#F9F6F2",
            "dark-bg": "#071324",
            "light-text": "#3D3D3D",
            "dark-text": "#E0E0E0",
            "success": "#28a745",
            "warning": "#ffc107",
            "danger": "#dc3545",
          },
          fontFamily: {
            "display": ["Playfair Display", "serif"],
            "body": ["Cairo", "sans-serif"],
          },
          boxShadow: {
            'glow-gold': '0 0 15px 0px rgba(200, 155, 63, 0.3)',
            'glow-bronze': '0 0 15px 0px rgba(169, 113, 66, 0.3)',
            'card-lift': '0 10px 20px -5px rgba(0, 0, 0, 0.1)',
          },
          animation: {
            'fade-in': 'fade-in 0.5s ease-out forwards',
            'fade-in-up': 'fade-in-up 0.6s ease-out forwards',
            'pop-in': 'pop-in 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards',
            'count-up': 'count-up 1.5s ease-out forwards',
            'draw-chart': 'draw-chart 1s ease-out forwards',
            'slide-in-right': 'slide-in-right 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards',
            'slide-out-right': 'slide-out-right 0.5s cubic-bezier(0.55, 0.085, 0.68, 0.53) forwards',
          },
          keyframes: {
            'fade-in': { '0%': { opacity: '0' }, '100%': { opacity: '1' } },
            'fade-in-up': {
              '0%': { opacity: '0', transform: 'translateY(20px)' },
              '100%': { opacity: '1', transform: 'translateY(0)' },
            },
            'pop-in': {
              '0%': { opacity: '0', transform: 'scale(0.9)' },
              '100%': { opacity: '1', transform: 'scale(1)' },
            },
            'count-up': {
                'from': { '--num': 0 },
                'to': { '--num': 1 }
            },
            'draw-chart': {
              'from': { 'stroke-dashoffset': '1000' },
              'to': { 'stroke-dashoffset': '0' }
            },
            'slide-in-right': {
                '0%': { transform: 'translateX(100%)' },
                '100%': { transform: 'translateX(0)' },
            },
            'slide-out-right': {
                '0%': { transform: 'translateX(0)' },
                '100%': { transform: 'translateX(100%)' },
            },
          }
        },
      },
    }
    </script>
    <!-- This block is self-contained for Alpine/Tailwind. You may move the <style> to <head> later. -->
<style>
  /* Slide-up modal animation (works with x-transition) */
  .modal-enter-start { transform: translateY(24px); opacity: 0; }
  .modal-enter-end   { transform: translateY(0);     opacity: 1; transition: all .36s cubic-bezier(.2,.9,.2,1); }
  .modal-leave-start { transform: translateY(0);     opacity: 1; }
  .modal-leave-end   { transform: translateY(24px); opacity: 0; transition: all .28s cubic-bezier(.4,.9,.2,1); }
/* Base: hide all tabs */
#analytics-tabs > div[class^="content-"] {
    display: none;
}

/* Sales tab */
#tab-sales:checked ~ .content-sales {
    display: block;
}

/* Products tab */
#tab-products:checked ~ .content-products {
    display: block;
}



/* Customers tab */
#tab-customers:checked ~ .content-customers {
    display: block;
}

/* Active TAB highlight */
#tab-sales:checked + label,
#tab-products:checked + label,
#tab-customers:checked + label {
    border-color: var(--primary);
    color: var(--primary);
}

  /* Prevent flicker while Alpine initializes */
  [x-cloak] { display: none !important; }
</style>
<style>
        .material-symbols-outlined { font-variation-settings: 'FILL' 0, 'wght' 300, 'GRAD' 0, 'opsz' 24 }
        .material-symbols-outlined.filled { font-variation-settings: 'FILL' 1 }
        .sidebar-group:hover .sidebar-icon { transform: scale(1.1); color: var(--hover-color); }
        .sidebar-group:hover .sidebar-label { color: var(--hover-color); transform: translateX(2px); }
        .dark .sidebar-group:hover { --hover-color: #C89B3F; }.light .sidebar-group:hover { --hover-color: #A97142; }[x-cloak] { display: none !important; }
        @property --num {
          syntax: '<number>';
          initial-value: 0;
          inherits: false;
        }
        .animate-count-up {
            animation: count-up 1.5s ease-out forwards;
            counter-reset: num var(--num);
        }
        .animate-count-up::after {
            content: counter(num);
        }
        .carousel-snap { scroll-snap-type: x mandatory; }
        .carousel-item { scroll-snap-align: start; }
        .ghost { opacity: 0.5; background: #c89b3f33; }
        .drag-handle { cursor: grab; }
        .drag-handle:active { cursor: grabbing; }
    </style>
<script defer="" src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
<script defer="" src="https://unpkg.com/sortablejs@1.15.0/Sortable.min.js"></script>
<script>
(function () {
  const token = localStorage.getItem("token");
  const raw = localStorage.getItem("user");

  if (!token || !raw) {
    window.location.href = "index.html";
    return;
  }

  const user = JSON.parse(raw);

  // ONLY admin allowed
  if (user.role !== "admin") {
    window.location.href = "index.html";
  }
})();
</script>
<script src="/assets/js/font.js"></script>
</head>
<body class="bg-light-bg dark:bg-dark-bg font-body text-light-text dark:text-dark-text transition-colors duration-500" x-data="{ sidebarOpen: true, mobileMenuOpen: false, addProductOpen: false, editProductOpen: false, activeView: 'dashboard',}">
<div class="flex h-screen overflow-hidden">
<aside :class="{'w-64': sidebarOpen, 'w-20': !sidebarOpen}" class="fixed left-0 top-0 h-full bg-accent dark:bg-secondary text-light-text dark:text-dark-text shadow-lg z-30 transition-all duration-300 ease-in-out hidden lg:flex flex-col">
<div :class="{'px-6': sidebarOpen, 'px-0': !sidebarOpen}" class="flex items-center justify-center h-20 border-b border-bronze/10 dark:border-primary/10 transition-all duration-300">
<a class="flex items-center gap-3" href="index.html">
<div class="h-8 w-8 text-bronze dark:text-primary flex-shrink-0">

  <img
          src="assets/images/logo.png"
          alt="Attar Store Logo"
          class="h-8 w-8 object-cover rounded-full"
          />  </div>
<span :class="{'opacity-100': sidebarOpen, 'opacity-0': !sidebarOpen}" class="text-xl font-bold font-display text-light-text dark:text-accent whitespace-nowrap overflow-hidden transition-opacity duration-200">Attar Store</span>
</a>
</div>
<nav class="flex-grow pt-6 px-4 space-y-2 overflow-y-auto">
<a :class="{ 'bg-bronze/10 dark:bg-primary/10 text-bronze dark:text-primary': activeView === 'dashboard', 'hover:bg-bronze/5 dark:hover:bg-primary/5': activeView !== 'dashboard' }" @click.prevent="activeView = 'dashboard'" class="sidebar-group flex items-center p-3 rounded-lg transition-all duration-200" href="#" style="--hover-color: #A97142;" x-bind:class="{ 'dark: [--hover-color:#C89B3F]': true }">
<span class="material-symbols-outlined sidebar-icon transition-transform duration-200">dashboard</span>
<span :class="{'opacity-100 w-auto': sidebarOpen, 'opacity-0 w-0': !sidebarOpen}" class="ml-4 font-semibold sidebar-label whitespace-nowrap overflow-hidden transition-all duration-200">Dashboard</span>
</a>
<a :class="{ 'bg-bronze/10 dark:bg-primary/10 text-bronze dark:text-primary': activeView === 'products', 'hover:bg-bronze/5 dark:hover:bg-primary/5': activeView !== 'products' }" @click.prevent="activeView = 'products'" class="sidebar-group flex items-center p-3 rounded-lg transition-all duration-200" href="#" style="--hover-color: #A97142;" x-bind:class="{ 'dark: [--hover-color:#C89B3F]': true }">
<span class="material-symbols-outlined sidebar-icon transition-transform duration-200">inventory_2</span>
<span :class="{'opacity-100 w-auto': sidebarOpen, 'opacity-0 w-0': !sidebarOpen}" class="ml-4 font-semibold sidebar-label whitespace-nowrap overflow-hidden transition-all duration-200">Products</span>
</a>


<a
  :class="{ 
    'bg-bronze/10 dark:bg-primary/10 text-bronze dark:text-primary': activeView === 'orders', 
    'hover:bg-bronze/5 dark:hover:bg-primary/5': activeView !== 'orders' 
  }"
  @click.prevent="activeView = 'orders'; mobileMenuOpen = false"
  class="sidebar-group flex items-center p-3 rounded-lg transition-all duration-200 cursor-pointer"
  href="#"
  style="--hover-color: #A97142;"
  x-bind:class="{ 'dark: [--hover-color:#C89B3F]': true }"
>
  <span class="material-symbols-outlined sidebar-icon transition-transform duration-200">receipt_long</span>
  <span 
    :class="{'opacity-100 w-auto': sidebarOpen, 'opacity-0 w-0': !sidebarOpen}" 
    class="ml-4 font-semibold sidebar-label whitespace-nowrap overflow-hidden transition-all duration-200"
  >
    Orders
  </span>
</a>



<a
  :class="{ 
    'bg-bronze/10 dark:bg-primary/10 text-bronze dark:text-primary': activeView === 'users',
    'hover:bg-bronze/5 dark:hover:bg-primary/5': activeView !== 'users'
  }"
  @click.prevent="activeView = 'users'; mobileMenuOpen = false"
  class="sidebar-group flex items-center p-3 rounded-lg transition-all duration-200 cursor-pointer"
  href="#"
  style="--hover-color: #A97142;"
  x-bind:class="{ 'dark: [--hover-color:#C89B3F]': true }"
>
  <span class="material-symbols-outlined sidebar-icon transition-transform duration-200">person</span>

  <span 
    :class="{
      'opacity-100 w-auto': sidebarOpen,
      'opacity-0 w-0': !sidebarOpen
    }" 
    class="ml-4 font-semibold sidebar-label whitespace-nowrap overflow-hidden transition-all duration-200"
  >
    Users
  </span>
</a>
<a
  :class="{
    'bg-bronze/10 dark:bg-primary/10 text-bronze dark:text-primary': activeView === 'reviews',
    'hover:bg-bronze/5 dark:hover:bg-primary/5': activeView !== 'reviews'
  }"
  @click.prevent="activeView = 'reviews'; mobileMenuOpen = false"
  class="sidebar-group flex items-center p-3 rounded-lg transition-all duration-200 cursor-pointer"
  style="--hover-color: #A97142;"
  x-bind:class="{ 'dark: [--hover-color:#C89B3F]': true }"
>
  <span class="material-symbols-outlined sidebar-icon">rate_review</span>
  <span
    :class="{
      'opacity-100 w-auto': sidebarOpen,
      'opacity-0 w-0': !sidebarOpen
    }"
    class="ml-4 font-semibold sidebar-label whitespace-nowrap overflow-hidden transition-all duration-200"
  >
    Reviews
  </span>
</a>

<a 
    @click.prevent="activeView = 'stock'" 
    class="sidebar-group flex items-center p-3 rounded-lg hover:bg-bronze/5 dark:hover:bg-primary/5 transition-all duration-200 cursor-pointer"
>
    <span class="material-symbols-outlined sidebar-icon transition-transform duration-200">
        inventory
    </span>

    <span :class="{
            'opacity-100 w-auto ml-4': sidebarOpen, 
            'opacity-0 w-0 -ml-2': !sidebarOpen
        }"
        class="font-semibold sidebar-label whitespace-nowrap overflow-hidden transition-all duration-200"
    >
        Stock Control
    </span>
</a>



<a
  :class="{
    'bg-bronze/10 dark:bg-primary/10 text-bronze dark:text-primary': activeView === 'messages',
    'hover:bg-bronze/5 dark:hover:bg-primary/5': activeView !== 'messages'
  }"
  @click.prevent="activeView = 'messages'; mobileMenuOpen = false"
  class="sidebar-group flex items-center p-3 rounded-lg transition-all duration-200 cursor-pointer"
  style="--hover-color: #A97142;"
  x-bind:class="{ 'dark: [--hover-color:#C89B3F]': true }"
>
  <span class="material-symbols-outlined sidebar-icon">forum</span>
  <span
    :class="{
      'opacity-100 w-auto': sidebarOpen,
      'opacity-0 w-0': !sidebarOpen
    }"
    class="ml-4 font-semibold sidebar-label whitespace-nowrap overflow-hidden transition-all duration-200"
  >
    Messages
  </span>
</a>

<a
  :class="{
    'bg-bronze/10 dark:bg-primary/10 text-bronze dark:text-primary': activeView === 'blog',
    'hover:bg-bronze/5 dark:hover:bg-primary/5': activeView !== 'blog'
  }"
  @click.prevent="activeView = 'blog'; mobileMenuOpen = false"
  class="sidebar-group flex items-center p-3 rounded-lg transition-all duration-200 cursor-pointer"
  style="--hover-color:#A97142;"
  x-bind:class="{ 'dark:[--hover-color:#C89B3F]': true }"
>
  <span class="material-symbols-outlined sidebar-icon">article</span>
  <span
    :class="{
      'opacity-100 w-auto': sidebarOpen,
      'opacity-0 w-0': !sidebarOpen
    }"
    class="ml-4 font-semibold sidebar-label whitespace-nowrap overflow-hidden transition-all duration-200"
  >
    Blog & Articles
  </span>
</a>

<a 
@click="activeView = 'analytics'"
class="sidebar-group flex items-center p-3 rounded-lg hover:bg-bronze/5 dark:hover:bg-primary/5 transition-all duration-200" href="#" style="--hover-color: #A97142;" x-bind:class="{ 'dark: [--hover-color:#C89B3F]': true }">
<span class="material-symbols-outlined sidebar-icon transition-transform duration-200">analytics</span>
<span :class="{'opacity-100 w-auto': sidebarOpen, 'opacity-0 w-0': !sidebarOpen}" class="ml-4 font-semibold sidebar-label whitespace-nowrap overflow-hidden transition-all duration-200">Analytics</span>
</a>
</nav>
<div class="p-4 border-t border-bronze/10 dark:border-primary/10">
  <a
  href="#"
  @click.prevent="activeView = 'settings'; mobileMenuOpen = false"
  :class="{
    'bg-bronze/10 dark:bg-primary/10 text-bronze dark:text-primary': activeView === 'settings',
    'hover:bg-bronze/5 dark:hover:bg-primary/5': activeView !== 'settings'
  }"
  class="sidebar-group flex items-center p-3 rounded-lg transition-all duration-200"
  style="--hover-color: #A97142;"
  x-bind:class="{ 'dark: [--hover-color:#C89B3F]': true }"
>
  <span class="material-symbols-outlined sidebar-icon transition-transform duration-200">
    settings
  </span>

  <span
    :class="{
      'opacity-100 w-auto': sidebarOpen,
      'opacity-0 w-0': !sidebarOpen
    }"
    class="ml-4 font-semibold sidebar-label whitespace-nowrap overflow-hidden transition-all duration-200"
  >
    Settings
  </span>
</a>


<a   onclick="adminLogout()"
class="sidebar-group flex items-center p-3 rounded-lg hover:bg-bronze/5 dark:hover:bg-primary/5 transition-all duration-200 text-danger" href="#" style="--hover-color: #dc3545;" x-bind:class="{ 'dark: [--hover-color:#dc3545]': true }">
<span class="material-symbols-outlined sidebar-icon transition-transform duration-200">logout</span>
<span :class="{'opacity-100 w-auto': sidebarOpen, 'opacity-0 w-0': !sidebarOpen}" class="ml-4 font-semibold sidebar-label whitespace-nowrap overflow-hidden transition-all duration-200">Logout</span>
</a>
</div>
</aside>
<div :class="{'lg:ml-64': sidebarOpen, 'lg:ml-20': !sidebarOpen}" class="relative flex flex-col flex-1 overflow-y-auto overflow-x-hidden">
<header class="sticky top-0 bg-light-bg/80 dark:bg-dark-bg/80 backdrop-blur-lg z-20 shadow-sm">
<div class="px-4 sm:px-6 lg:px-8">
<div class="flex items-center justify-between h-20 -mb-px">
<div class="flex items-center space-x-4">
<button @click.stop="sidebarOpen = !sidebarOpen" class="text-light-text dark:text-dark-text hover:text-bronze dark:hover:text-primary hidden lg:block">
<span class="material-symbols-outlined text-3xl">menu_open</span>
</button>

<div class="relative hidden sm:block">
<span class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-light-text/50 dark:text-dark-text/50">search</span>
<input class="w-full max-w-xs pl-10 pr-4 py-2 bg-accent/50 dark:bg-secondary/50 border border-transparent focus:border-bronze dark:focus:border-primary rounded-full transition-all focus:w-72" placeholder="Search..." type="search"/>
</div>
</div>
<div class="flex items-center space-x-3">
<button @click="toggleTheme()" class="flex h-10 w-10 cursor-pointer items-center justify-center rounded-full bg-transparent text-bronze dark:text-primary transition-transform duration-500 ease-in-out hover:rotate-[360deg] hover:bg-bronze/10 dark:hover:bg-primary/10">
<span class="material-symbols-outlined hidden dark:inline">light_mode</span>
<span class="material-symbols-outlined dark:hidden">dark_mode</span>
</button>
<div
  class="relative"
  x-data="adminNotifications()"
  x-init="loadNotifications()"
><button @click="open = !open" class="flex h-10 w-10 items-center justify-center rounded-full bg-bronze/10 dark:bg-primary/10 text-bronze dark:text-primary">
<span class="material-symbols-outlined">notifications</span>
<span
  x-show="unreadCount > 0"
  x-text="unreadCount"
  class="absolute -top-1 -right-1 min-w-[18px] h-[18px] px-1 text-[10px] flex items-center justify-center rounded-full bg-danger text-white ring-2 ring-light-bg dark:ring-dark-bg"
></span>
</button>
<div
  @click.outside="open = false"
  class="absolute mt-2 w-80 max-w-[90vw]
         left-1/2 -translate-x-1/2
         sm:left-auto sm:translate-x-0 sm:right-0
         bg-accent dark:bg-secondary
         rounded-lg shadow-lg overflow-hidden
         border border-bronze/10 dark:border-primary/10
         z-50"
  x-cloak
  x-show="open"
  x-transition:enter="transition ease-out duration-200"
  x-transition:enter-start="opacity-0 scale-95"
  x-transition:enter-end="opacity-100 scale-100"
  x-transition:leave="transition ease-in duration-75"
  x-transition:leave-start="opacity-100 scale-100"
  x-transition:leave-end="opacity-0 scale-95"
><div class="p-3 font-semibold border-b border-bronze/10 dark:border-primary/10">Notifications</div>
<div class="max-h-72 overflow-y-auto divide-y divide-bronze/10 dark:divide-primary/10">
  <template x-if="unread.length === 0">
    <div class="p-4 text-sm opacity-70">
      No new notifications
    </div>
  </template>

  <template x-for="n in unread" :key="n._id">
    <div
      @click="markAsRead(n)"
      class="p-3 cursor-pointer hover:bg-bronze/5 dark:hover:bg-primary/5 bg-bronze/5 dark:bg-primary/5"
    >
      <p class="font-semibold" x-text="n.title"></p>
      <p class="text-xs opacity-70" x-text="n.message"></p>
    </div>
  </template>
  <button
  @click="open = false; openAdminNotificationModal(notifications)"
  class="w-full text-center py-2 text-sm hover:bg-bronze/10 dark:hover:bg-primary/10"
>
  View all notifications
</button>
</div>
</div>


</div>

<script>
function adminNotifications() {
  return {
    open: false,
    modalOpen: false,
    notifications: [],
    unread: [],

    async loadNotifications() {
      const token = localStorage.getItem("token");

      const res = await fetch("https://perfume-store-production.up.railway.app/api/notifications", {
        headers: { Authorization: `Bearer ${token}` }
      });

      const data = await res.json();
      if (!data.success) return;

      this.notifications = data.notifications;
      this.unread = this.notifications.filter(n => !n.isRead);
    },

    get unreadCount() {
      return this.unread.length;
    },

    async markAsRead(n) {
      if (n.isRead) return;

      const token = localStorage.getItem("token");

      await fetch(
        `https://perfume-store-production.up.railway.app/api/notifications/${n._id}/read`,
        {
          method: "PATCH",
          headers: { Authorization: `Bearer ${token}` }
        }
      );

      n.isRead = true;
      this.unread = this.unread.filter(x => x._id !== n._id);
    }
  };
}
</script>


<script>
function openAdminNotificationModal(notifications) {
  const modal = document.getElementById("adminNotificationModal");
  const body = document.getElementById("adminNotificationModalBody");

  body.innerHTML = "";

  if (!notifications || notifications.length === 0) {
    body.innerHTML = `
      <div class="p-6 text-center text-sm opacity-60">
        No notifications
      </div>
    `;
  } else {
    notifications.forEach(n => {
      const div = document.createElement("div");
      div.className = "p-4";
      if (!n.isRead) {
        div.classList.add("bg-bronze/5", "dark:bg-primary/5");
      }
      div.innerHTML = `
        <p class="font-semibold">${n.title}</p>
        <p class="text-sm opacity-70 mt-1">${n.message}</p>
      `;
      body.appendChild(div);
    });
  }

  modal.classList.remove("hidden");
  modal.classList.add("flex");
}

function closeAdminNotificationModal() {
  const modal = document.getElementById("adminNotificationModal");
  modal.classList.add("hidden");
  modal.classList.remove("flex");
}

// close on background click
document
  .getElementById("adminNotificationModal")
  .addEventListener("click", e => {
    if (e.target.id === "adminNotificationModal") {
      closeAdminNotificationModal();
    }
  });
</script>
<div class="relative" x-data="{ open: false }">
<button @click="open = !open" class="flex items-center space-x-2">
  <img
  data-user-avatar
  alt="Admin avatar"
  class="h-10 w-10 rounded-full object-cover border-2 border-bronze dark:border-primary"
/>
<div class="hidden md:block text-left">
  <span class="font-semibold text-sm" data-user-name></span>
<span class="block text-xs text-light-text/70 dark:text-dark-text/70">Super Admin</span>
</div>
</button>

<div @click.outside="open = false" class="absolute right-0 mt-2 w-48 bg-accent dark:bg-secondary rounded-lg shadow-lg overflow-hidden border border-bronze/10 dark:border-primary/10" x-cloak="" x-show="open" x-transition:enter="transition ease-out duration-200" x-transition:enter-end="opacity-100 scale-100" x-transition:enter-start="opacity-0 scale-95" x-transition:leave="transition ease-in duration-75" x-transition:leave-end="opacity-0 scale-95" x-transition:leave-start="opacity-100 scale-100">
<a class="block px-4 py-2 text-sm hover:bg-bronze/5 dark:hover:bg-primary/5" href="#">Profile</a>
<a class="block px-4 py-2 text-sm hover:bg-bronze/5 dark:hover:bg-primary/5" href="#">Settings</a>
<div class="border-t border-bronze/10 dark:border-primary/10"></div>
<a class="block px-4 py-2 text-sm text-danger hover:bg-danger/10" href="#">Logout</a>
</div>

</div>
<button @click.stop="mobileMenuOpen = !mobileMenuOpen" class="text-light-text dark:text-dark-text lg:hidden">
<span class="material-symbols-outlined text-3xl">menu</span>
</button>
</div>
</div>
</div>
</header>

<main class="flex-grow">
  <div class="max-w-full px-4 sm:px-6 lg:px-8 py-6 space-y-8">
    <div class="space-y-8 animate-fade-in" x-show="activeView === 'dashboard'" x-transition:enter="transition ease-out duration-300" x-transition:enter-end="opacity-100" x-transition:enter-start="opacity-0" x-transition:leave="transition ease-in duration-200" x-transition:leave-end="opacity-0" x-transition:leave-start="opacity-100">
<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-6">
<div class="bg-accent dark:bg-secondary p-6 rounded-xl border border-bronze/10 dark:border-primary/10 shadow-sm hover:shadow-card-lift hover:-translate-y-1 transition-all duration-300 animate-fade-in-up" style="animation-delay: 100ms;">
<div class="flex items-center justify-between">
<span class="material-symbols-outlined text-3xl text-bronze dark:text-primary">inventory_2</span>
<div class="flex items-center text-sm text-success font-semibold">
<span class="material-symbols-outlined text-base">arrow_upward</span>
<span>5%</span>
</div>
</div>
<h3 class="mt-4 text-3xl font-bold font-display"><span class="animate-count-up" style="--num: 1254"></span></h3>
<p class="text-sm text-light-text/70 dark:text-dark-text/70 mt-1">Total Products</p>
</div>
<div class="bg-accent dark:bg-secondary p-6 rounded-xl border border-bronze/10 dark:border-primary/10 shadow-sm hover:shadow-card-lift hover:-translate-y-1 transition-all duration-300 animate-fade-in-up" style="animation-delay: 200ms;">
<div class="flex items-center justify-between">
<span class="material-symbols-outlined text-3xl text-bronze dark:text-primary">receipt_long</span>
<div class="flex items-center text-sm text-success font-semibold">
<span class="material-symbols-outlined text-base">arrow_upward</span>
<span>12%</span>
</div>
</div>
<h3 class="mt-4 text-3xl font-bold font-display"><span class="animate-count-up" style="--num: 873"></span></h3>
<p class="text-sm text-light-text/70 dark:text-dark-text/70 mt-1">Total Orders</p>
</div>

<div class="bg-accent dark:bg-secondary p-6 rounded-xl border border-bronze/10 dark:border-primary/10 shadow-sm hover:shadow-card-lift hover:-translate-y-1 transition-all duration-300 animate-fade-in-up relative overflow-hidden" style="animation-delay: 400ms;">
<div class="absolute -top-1 -right-1 h-8 w-8 bg-danger rounded-bl-lg flex items-center justify-center animate-pulse">
<span class="material-symbols-outlined text-white text-base">priority_high</span>
</div>
<div class="flex items-center justify-between">
<span class="material-symbols-outlined text-3xl text-danger">production_quantity_limits</span>
<div class="flex items-center text-sm text-danger font-semibold">
<span class="material-symbols-outlined text-base">arrow_downward</span>
<span>-3%</span>
</div>
</div>
<h3 class="mt-4 text-3xl font-bold font-display"><span class="animate-count-up" style="--num: 15"></span></h3>
<p class="text-sm text-light-text/70 dark:text-dark-text/70 mt-1">Low Stock Alerts</p>
</div>
<div class="bg-accent dark:bg-secondary p-6 rounded-xl border border-bronze/10 dark:border-primary/10 shadow-sm hover:shadow-card-lift hover:-translate-y-1 transition-all duration-300 animate-fade-in-up" style="animation-delay: 500ms;">
<div class="flex items-center justify-between">
<span class="material-symbols-outlined text-3xl text-bronze dark:text-primary">person_add</span>
<div class="flex items-center text-sm text-success font-semibold">
<span class="material-symbols-outlined text-base">arrow_upward</span>
<span>8%</span>
</div>
</div>
<h3 class="mt-4 text-3xl font-bold font-display"><span class="animate-count-up" style="--num: 2109"></span></h3>
<p class="text-sm text-light-text/70 dark:text-dark-text/70 mt-1">Total Users</p>
</div>
<div class="bg-accent dark:bg-secondary p-6 rounded-xl border border-bronze/10 dark:border-primary/10 shadow-sm hover:shadow-card-lift hover:-translate-y-1 transition-all duration-300 animate-fade-in-up" style="animation-delay: 600ms;">
<div class="flex items-center justify-between">
<span class="material-symbols-outlined text-3xl text-bronze dark:text-primary">paid</span>
<div class="flex items-center text-sm text-success font-semibold">
<span class="material-symbols-outlined text-base">arrow_upward</span>
<span>21%</span>
</div>
</div>
<h3 class="mt-4 text-3xl font-bold font-display">$<span class="animate-count-up" style="--num: 48500"></span></h3>
<p class="text-sm text-light-text/70 dark:text-dark-text/70 mt-1">Monthly Revenue</p>
</div>
</div>
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
<div class="lg:col-span-2 bg-accent dark:bg-secondary p-6 rounded-xl border border-bronze/10 dark:border-primary/10 shadow-sm animate-fade-in-up" style="animation-delay: 700ms;">
<h3 class="font-display font-bold text-xl mb-4">Sales Overview</h3>
<div class="h-80">
<svg class="w-full h-full" viewBox="0 0 400 200">
<text class="opacity-50" fill="currentColor" font-family="Cairo" font-size="16" x="150" y="100">Sales Graph Area</text>
<path class="stroke-bronze dark:stroke-primary" d="M 20 180 C 80 40, 150 150, 220 80, 290 20, 340 120, 380 100" fill="none" stroke-width="2" style="stroke-dasharray: 1000; animation: draw-chart 2s ease-out forwards;"></path>
</svg>
</div>
</div>
<div class="bg-accent dark:bg-secondary p-6 rounded-xl border border-bronze/10 dark:border-primary/10 shadow-sm animate-fade-in-up" style="animation-delay: 800ms;">
<h3 class="font-display font-bold text-xl mb-4">Best Sellers</h3>
<div class="h-80 flex items-center justify-center">
<svg class="w-full h-full" viewBox="0 0 200 200">
<text class="opacity-50" fill="currentColor" font-family="Cairo" font-size="16" x="50" y="100">Pie Chart Area</text>
<circle class="stroke-bronze/20 dark:stroke-primary/20" cx="100" cy="100" fill="none" r="80" stroke-width="20"></circle>
<circle class="stroke-bronze dark:stroke-primary" cx="100" cy="100" fill="none" r="80" stroke-dasharray="351.858 502.655" stroke-width="20" style="animation: draw-chart 1.5s ease-out forwards;" transform="rotate(-90 100 100)"></circle>
</svg>
</div>
</div>
</div>
</div>
<div
  class="bg-accent dark:bg-secondary rounded-xl border border-bronze/10 dark:border-primary/10 shadow-sm animate-fade-in"
  x-data="adminProducts()"
  x-init="loadProducts()"
  x-show="activeView === 'products'"
  x-transition:enter="transition ease-out duration-300"
  x-transition:enter-start="opacity-0"
  x-transition:enter-end="opacity-100"
  x-transition:leave="transition ease-in duration-200"
  x-transition:leave-start="opacity-100"
  x-transition:leave-end="opacity-0"
>

<!-- HEADER -->
<div class="p-4 sm:p-6 space-y-4">

  <!-- Top Row -->
  <div class="flex flex-wrap justify-between items-center gap-4">
    <h3 class="font-display font-bold text-xl">Product Management</h3>

    <div class="flex items-center space-x-2">
      <!-- View Toggle -->
      <div class="flex items-center rounded-xl border border-bronze/20 dark:border-primary/20 p-1">
        <button
          :class="view === 'grid'
            ? 'bg-bronze/10 dark:bg-primary/10'
            : 'hover:bg-bronze/5 dark:hover:bg-primary/5'"
          @click="view='grid'"
          class="p-2 rounded-lg transition"
        >
          <span class="material-symbols-outlined">grid_view</span>
        </button>

        <button
          :class="view === 'list'
            ? 'bg-bronze/10 dark:bg-primary/10'
            : 'hover:bg-bronze/5 dark:hover:bg-primary/5'"
          @click="view='list'"
          class="p-2 rounded-lg transition"
        >
          <span class="material-symbols-outlined">view_list</span>
        </button>
      </div>

      <!-- Add Product -->
      <button
@click="
  addProductOpen = true;
  loadPrimaryTags();
"

        class="flex items-center px-4 py-2 text-sm font-semibold rounded-xl
               bg-bronze dark:bg-primary text-white dark:text-secondary
               hover:opacity-90 transition shadow-sm"
      >
        <span class="material-symbols-outlined mr-2 text-base">add</span>
        Add New Product
      </button>
    </div>
  </div>

  <!-- QUALITY FILTER (PREMIUM) -->
  <div class="flex justify-start">
    <div
      class="inline-flex rounded-full border border-bronze/20 dark:border-primary/20
             bg-light-bg dark:bg-dark-bg shadow-sm p-1"
    >
      <button
        @click="qualityFilter = 'all'"
        class="px-5 py-2 text-sm font-medium rounded-full transition-all duration-200"
        :class="qualityFilter === 'all'
          ? 'bg-bronze dark:bg-primary text-white shadow'
          : 'text-light-text/70 dark:text-dark-text/70 hover:bg-bronze/10 dark:hover:bg-primary/10'"
      >
        All
      </button>

      <button
        @click="qualityFilter = 'normal'"
        class="px-5 py-2 text-sm font-medium rounded-full transition-all duration-200"
        :class="qualityFilter === 'normal'
          ? 'bg-bronze dark:bg-primary text-white shadow'
          : 'text-light-text/70 dark:text-dark-text/70 hover:bg-bronze/10 dark:hover:bg-primary/10'"
      >
        Normal
      </button>

      <button
        @click="qualityFilter = 'original'"
        class="px-5 py-2 text-sm font-medium rounded-full transition-all duration-200"
        :class="qualityFilter === 'original'
          ? 'bg-bronze dark:bg-primary text-white shadow'
          : 'text-light-text/70 dark:text-dark-text/70 hover:bg-bronze/10 dark:hover:bg-primary/10'"
      >
        Original
      </button>
    </div>
  </div>

</div>

<!-- GRID VIEW -->
<div
  class="p-4 sm:p-6 grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-6"
  x-show="view === 'grid'"
>
  <template x-for="product in products.filter(p =>
  qualityFilter === 'all' || p.quality === qualityFilter
)" :key="product._id">
    <div class="bg-light-bg dark:bg-dark-bg rounded-xl border border-bronze/10 dark:border-primary/10 shadow-lg overflow-hidden flex flex-col group transition-all duration-300 hover:shadow-card-lift hover:-translate-y-1">

      <!-- IMAGE -->
      <div class="relative w-full aspect-square">
        <img
        :src="product.images?.[0] || '/placeholder.png'"
        alt="Product image"
          class="w-full h-full object-cover"
        />

        <span
          class="absolute top-2 left-2 px-2.5 py-1 text-xs font-bold rounded-full text-white backdrop-blur-sm"
          :class="
  product.bottleSizes.every(s => s.stock === 0)
    ? 'bg-danger/80'
    : product.bottleSizes.some(s => s.stock < 20)
      ? 'bg-warning/80'
      : product.active
        ? 'bg-success/80'
        : 'bg-gray-500/80'""
       
        x-text="
  product.bottleSizes.every(s => s.stock === 0)
    ? 'Out of Stock'
    : product.bottleSizes.some(s => s.stock < 20)
      ? 'Low Stock'
      : product.active
        ? 'Active'
        : 'Hidden'
"
        ></span>
      </div>

      <!-- CONTENT -->
      <div class="p-4 flex-grow flex flex-col">
        <h4 class="font-display font-bold text-lg truncate" x-text="product.name"></h4>

        <div class="flex justify-between items-center text-sm opacity-70 mt-2">
         



          <div class="mt-3 flex flex-wrap gap-2">
  <template x-for="s in sizeStockBadges(product)" :key="s.size">
    <span
      class="px-2 py-1 text-xs font-semibold rounded-md"
      :class="{
        'bg-success/20 text-success': s.status === 'ok',
        'bg-warning/20 text-warning': s.status === 'low',
        'bg-danger/20 text-danger': s.status === 'out'
      }"
      x-text="`${s.size}ml • ${s.stock}`"
    ></span>
  </template>
</div>

        </div>

        <!-- ACTIONS (UNCHANGED) -->
        <div class="mt-4 pt-4 border-t border-bronze/10 dark:border-primary/10 flex justify-between items-center">

<!-- EDIT -->
<button
@click="$store.productUI.openEdit(product)"
  class="p-2 rounded-full hover:bg-bronze/10 dark:hover:bg-primary/10"
  title="Edit"
>
  <span class="material-symbols-outlined text-xl">edit</span>
</button>

<!-- VIEW -->
<button
@click="$store.productUI.openView(product)"
  class="p-2 rounded-full hover:bg-bronze/10 dark:hover:bg-primary/10"
  title="View"
>
  <span class="material-symbols-outlined text-xl">visibility</span>
</button>

<!-- TOGGLE VISIBILITY -->
<button
  @click="
    product.bottleSizes.every(s => s.stock === 0)
      ? alert('Cannot enable: all sizes are out of stock')
      : toggleStatus(product)
  "
  :disabled="product.bottleSizes.every(s => s.stock === 0) && !product.active"
  :class="[
    product.active
      ? 'text-success hover:bg-success/10'
      : 'text-gray-500 hover:bg-gray-500/10',
    product.bottleSizes.every(s => s.stock === 0) && !product.active
      ? 'opacity-50 cursor-not-allowed'
      : ''
  ]"
  class="p-2 rounded-full transition-colors"
  title="Toggle Visibility"
>
  <span class="material-symbols-outlined text-xl"
    x-text="product.active ? 'toggle_on' : 'toggle_off'">
  </span>
</button>


<!-- DELETE -->
<button
@click="$store.productUI.openDelete(product)"
  class="p-2 rounded-full text-danger hover:bg-danger/10"
  title="Delete"
>
  <span class="material-symbols-outlined text-xl">delete</span>
</button>

</div>

      </div>
    </div>
  </template>
</div>

<!-- LIST VIEW -->
<div class="overflow-x-auto" x-show="view === 'list'">
<table class="w-full min-w-[800px]">
<thead class="bg-light-bg dark:bg-dark-bg">
<tr>
  <th class="p-4 text-left text-sm font-semibold uppercase tracking-wider">Product</th>
  <th class="p-4 text-center text-sm font-semibold uppercase tracking-wider">Stock</th>
  <th class="p-4 text-center text-sm font-semibold uppercase tracking-wider">Price</th>
  <th class="p-4 text-center text-sm font-semibold uppercase tracking-wider">Status</th>
  <th class="p-4 text-center text-sm font-semibold uppercase tracking-wider">Actions</th>
</tr>
</thead>

<tbody class="divide-y divide-bronze/10 dark:divide-primary/10">
<template x-for="product in products" :key="product._id">
<tr>
  <td class="p-4">
    <div class="flex items-center space-x-3">
      <img
      :src="product.images?.[0] || '/placeholder.png'"
      alt="Product image"
        class="h-12 w-12 rounded-lg object-cover"
      />
      <div>
  <div class="font-semibold" x-text="product.name"></div>
  <div class="text-xs opacity-70" x-text="'quality ' + product.quality"></div>
  
</div>

    </div>
  </td>

  <td class="p-4">
  <div class="flex justify-center flex-wrap gap-2">
    <template x-for="s in sizeStockBadges(product)" :key="s.size">
      <span
        class="px-2 py-1 text-xs font-semibold rounded-md"
        :class="{
          'bg-success/20 text-success': s.status === 'ok',
          'bg-warning/20 text-warning': s.status === 'low',
          'bg-danger/20 text-danger': s.status === 'out'
        }"
        x-text="`${s.size}ml • ${s.stock}`"
      ></span>
    </template>
  </div>
</td>

  <td class="p-4 text-center font-semibold">
    LKR <span x-text="product.prices?.base6ml"></span>
  </td>

  <td class="p-4 text-center">
    <span
      class="px-3 py-1 text-xs font-bold rounded-full"
      :class="product.active ? 'bg-success/20 text-success' : 'bg-gray-500/20 text-gray-500'"
      x-text="product.active ? 'Active' : 'Hidden'"
    ></span>
  </td>

  <td class="p-4 text-center">
  <div class="flex justify-center items-center space-x-1">

    <!-- EDIT -->
    <button
    @click="$store.productUI.openEdit(product)"
    class="p-2 rounded-full hover:bg-bronze/10 dark:hover:bg-primary/10"
      title="Edit"
    >
      <span class="material-symbols-outlined text-xl">edit</span>
    </button>

    <!-- VIEW -->
    <button
    @click="$store.productUI.openView(product)"
    class="p-2 rounded-full hover:bg-bronze/10 dark:hover:bg-primary/10"
      title="View"
    >
      <span class="material-symbols-outlined text-xl">visibility</span>
    </button>

 

    <!-- DELETE -->
    <button
    @click="$store.productUI.openDelete(product)"
    class="p-2 rounded-full text-danger hover:bg-danger/10"
      title="Delete"
    >
      <span class="material-symbols-outlined text-xl">delete</span>
    </button>

  </div>
</td>

</tr>
</template>
</tbody>
</table>
</div>
</div>


<script>
function adminProducts() {
  return {
    products: [],
    view: 'grid',
    qualityFilter: "all", 
    primaryTagSuggestions: [],

    /* ================= LOAD ================= */
    async loadProducts() {
      const token = localStorage.getItem("token");
      const res = await fetch("https://perfume-store-production.up.railway.app/api/admin/products", {
        headers: { Authorization: `Bearer ${token}` }
      });
      const data = await res.json();
      this.products = data.products || [];
    },

    /* ================= SIZES ================= */
    enabledBottleSizes(product) {
      if (!product.bottleSizes || !Array.isArray(product.bottleSizes)) {
        return "-";
      }

      return product.bottleSizes
        .map(size => `${size.sizeMl}ml`)
        .join(", ");
    },
    sizeStockBadges(product) {
  if (!product.bottleSizes) return [];

  return product.bottleSizes.map(s => {
    let status = "ok";
    if (s.stock === 0) status = "out";
    else if (s.stock < 20) status = "low";

    return {
      size: s.sizeMl,
      stock: s.stock,
      status
    };
  });
}
,

async loadPrimaryTags() {
  try {
    const token = localStorage.getItem("token");
    const res = await fetch(
      "https://perfume-store-production.up.railway.app/api/products/admin/primary-tags",
      {
        headers: { Authorization: `Bearer ${token}` }
      }
    );

    const data = await res.json();
    if (data.success) {
      this.primaryTagSuggestions = data.tags;
    }
  } catch (e) {
    console.error("Failed to load primary tags", e);
  }
},
    /* ================= VIEW MODAL ================= */
    openView(product) {
      Alpine.store("productUI").selected = product;
      Alpine.store("productUI").viewOpen = true;
    },

    /* ================= DELETE MODAL ================= */
    openDelete(product) {
      Alpine.store("productUI").selected = product;
      Alpine.store("productUI").deleteOpen = true;
    },


    /* ================= TOGGLE STATUS ================= */
    async toggleStatus(product) {
      const token = localStorage.getItem("token");

      const res = await fetch(
        `https://perfume-store-production.up.railway.app/api/admin/products/${product._id}/toggle`,
        {
          method: "PATCH",
          headers: { Authorization: `Bearer ${token}` }
        }
      );

      if (!res.ok) {
        alert("Failed to update product status");
        return;
      }

      const data = await res.json();
      product.active = data.active;
    }
  };
}
</script>

<script>
document.addEventListener("alpine:init", () => {
  Alpine.store("productUI", {

    /* ================= STATE ================= */
    editOpen: false,
    viewOpen: false,
    deleteOpen: false,

    selected: null,
    original: null,

    /* ================= OPEN MODALS ================= */
    openEdit(product) {
      this.selected = JSON.parse(JSON.stringify(product));
      this.original = JSON.parse(JSON.stringify(product));
      this.editOpen = true;
    },

    openView(product) {
      this.selected = product;
      this.viewOpen = true;
    },

    openDelete(product) {
      this.selected = product;
      this.deleteOpen = true;
    },

    /* ================= CLOSE ================= */
    closeAll() {
      this.editOpen = false;
      this.viewOpen = false;
      this.deleteOpen = false;
      this.selected = null;
      this.original = null;
    },

    /* ================= SAVE (EDIT PRODUCT) ================= */
    async save() {
  const token = localStorage.getItem("token");
  const s = this.selected;
  const o = this.original;

  if (!s || !o) {
    alert("No product selected");
    return;
  }

  const changed =
    JSON.stringify({
      name: s.name,
      quality: s.quality,
      description: s.description,
      prices: s.prices
    }) !==
    JSON.stringify({
      name: o.name,
      quality: o.quality,
      description: o.description,
      prices: o.prices
    });

  if (!changed) {
    alert("Change at least one field before saving");
    return;
  }

  if (!s.prices?.base6ml || s.prices.base6ml <= 0) {
    alert("Base 6ml price is required");
    return;
  }
  const normalizeNotes = (value) => {
  if (!value) return [];
  if (Array.isArray(value)) return value;
  return value
    .split(",")
    .map(v => v.trim())
    .filter(Boolean);
};

  const payload = {
    name: s.name,
    quality: s.quality,
    description: s.description,
    prices: {
      base6ml: Number(s.prices.base6ml),
      sizePercentages: {
        size3: Number(s.prices.sizePercentages?.size3 ?? -30),
        size12: Number(s.prices.sizePercentages?.size12 ?? 35)
      },
      discountPercentages: {
        base: s.prices.discountPercentages?.base ?? null,
        size3: s.prices.discountPercentages?.size3 ?? null,
        size12: s.prices.discountPercentages?.size12 ?? null
      }
    },
    fragranceVariants: Array.isArray(s.fragranceVariants)
  ? s.fragranceVariants.map(v => v.trim()).filter(Boolean)
  : [],

  notes: {
    top: normalizeNotes(s.notes?.top),
    heart: normalizeNotes(s.notes?.heart),
    base: normalizeNotes(s.notes?.base)
  },

  attributes: {
    longLasting: !!s.attributes?.longLasting,
    alcoholFree: !!s.attributes?.alcoholFree,
    pureAttar: !!s.attributes?.pureAttar
  }
};

  try {
    const res = await fetch(
      `https://perfume-store-production.up.railway.app/api/admin/products/${s._id}`,
      {
        method: "PUT",
        headers: {
          "Content-Type": "application/json",
          Authorization: `Bearer ${token}`
        },
        body: JSON.stringify(payload)
      }
    );

    if (!res.ok) {
      const data = await res.json().catch(() => ({}));
      throw new Error(data.message || "Update failed");
    }

    alert("Product updated successfully");
    this.closeAll();

    const adminComp = document.querySelector('[x-data="adminProducts()"]');
    if (adminComp?.__x?.$data?.loadProducts) {
      adminComp.__x.$data.loadProducts();
    }

  } catch (err) {
    console.error("UPDATE FAILED:", err);
    alert("Failed to update product");
  }
}

  });
});
</script>








<div
  x-show="activeView === 'orders'"
  x-cloak
  x-transition.opacity.duration.400ms
  x-data="adminOrders()"
x-init="loadOrders()"

  class="space-y-6 animate-fade-in"
>



<div class="flex flex-wrap justify-between items-center gap-4">
  <div class="flex flex-col gap-2">
      <p class="text-gray-900 dark:text-white text-4xl font-black leading-tight tracking-[-0.033em]">Orders Management</p>
      <p class="text-gray-500 dark:text-[#9dabb9] text-base font-normal leading-normal">View, filter, and manage all customer orders.</p>
    </div>
    <div class="flex items-center gap-3">
      <button class="flex items-center gap-2 px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-[#1a2632] border border-gray-300 dark:border-[#3b4754] rounded-lg hover:bg-gray-50 dark:hover:bg-[#283039] transition-colors">
        <span class="material-symbols-outlined text-base">ios_share</span>
        Export
      </button>
      <button @click="$store.orders.openNewOrder()" class="flex items-center gap-2 px-4 py-2 text-sm font-medium text-white bg-primary rounded-lg hover:bg-primary/90 focus:ring-4 focus:outline-none focus:ring-blue-300 dark:focus:ring-blue-800">
        <span class="material-symbols-outlined text-base">add_circle</span>
        Create New Order
      </button>
    </div>
</div>

  <!-- Stats Cards (unchanged) -->
  <section class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">

<!-- TOTAL -->
<div class="flex flex-col gap-2 rounded-lg p-6 bg-white dark:bg-[#1a2632] border border-gray-200 dark:border-[#3b4754]">
  <p class="text-gray-600 dark:text-white text-base font-medium leading-normal">Total Orders</p>
  <p class="text-gray-900 dark:text-white text-2xl font-bold" x-text="stats().total"></p>
</div>

<!-- PENDING -->
<div class="flex flex-col gap-2 rounded-lg p-6 bg-white dark:bg-[#1a2632] border border-gray-200 dark:border-[#3b4754]">
  <p class="text-gray-600 dark:text-white text-base font-medium leading-normal">Pending Orders</p>
  <p class="text-gray-900 dark:text-white text-2xl font-bold" x-text="stats().pending"></p>
</div>

<!-- APPROVED -->
<div class="flex flex-col gap-2 rounded-lg p-6 bg-white dark:bg-[#1a2632] border border-gray-200 dark:border-[#3b4754]">
  <p class="text-gray-600 dark:text-white text-base font-medium leading-normal">Approved Orders</p>
  <p class="text-gray-900 dark:text-white text-2xl font-bold" x-text="stats().approved"></p>
</div>

<!-- SHIPPED -->
<div class="flex flex-col gap-2 rounded-lg p-6 bg-white dark:bg-[#1a2632] border border-gray-200 dark:border-[#3b4754]">
  <p class="text-gray-600 dark:text-white text-base font-medium leading-normal">Shipped Orders</p>
  <p class="text-gray-900 dark:text-white text-2xl font-bold" x-text="stats().shipped"></p>
</div>

<!-- DELIVERED -->
<div class="flex flex-col gap-2 rounded-lg p-6 bg-white dark:bg-[#1a2632] border border-gray-200 dark:border-[#3b4754]">
  <p class="text-gray-600 dark:text-white text-base font-medium leading-normal">Completed Orders</p>
  <p class="text-gray-900 dark:text-white text-2xl font-bold" x-text="stats().delivered"></p>
</div>

<!-- CANCELLED -->
<div class="flex flex-col gap-2 rounded-lg p-6 bg-white dark:bg-[#1a2632] border border-gray-200 dark:border-[#3b4754]">
  <p class="text-gray-600 dark:text-white text-base font-medium leading-normal">Cancelled Orders</p>
  <p class="text-gray-900 dark:text-white text-2xl font-bold" x-text="stats().cancelled"></p>
</div>

</section>


  <!-- Orders Table Section (keeps original markup and classes, now dynamic via x-for) -->
  <section class="bg-white dark:bg-[#1a2632] border border-gray-200 dark:border-[#3b4754] rounded-xl overflow-hidden">
    <div class="p-4 border-b border-gray-200 dark:border-[#3b4754]">
      <h2 class="text-gray-900 dark:text-white text-[22px] font-bold leading-tight tracking-[-0.015em] mb-4">All Orders</h2>
      <div class="flex flex-wrap items-center gap-3">
        <div class="flex-grow">
          <label class="flex flex-col min-w-40 h-10 w-full">
            <div class="flex w-full flex-1 items-stretch rounded-lg h-full">
              <div class="text-gray-400 dark:text-[#9dabb9] flex bg-gray-100 dark:bg-[#283039] items-center justify-center pl-3 rounded-l-lg border border-r-0 border-gray-300 dark:border-[#3b4754]">
                <span class="material-symbols-outlined text-xl">search</span>
              </div>
              <input class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-gray-800 dark:text-white focus:outline-0 focus:ring-2 focus:ring-primary/50 border border-gray-300 dark:border-[#3b4754] bg-gray-100 dark:bg-[#283039] h-full placeholder:text-gray-400 dark:placeholder:text-[#9dabb9] px-4 rounded-l-none border-l-0 pl-2 text-sm font-normal leading-normal" placeholder="Search by Order ID or Customer Name..." x-ref="searchInput" />
            </div>
          </label>
        </div>

        <select class="form-select h-10 text-sm bg-gray-100 dark:bg-[#283039] border-gray-300 dark:border-[#3b4754] text-gray-800 dark:text-white rounded-lg focus:ring-primary/50 focus:border-primary" x-model="filterStatus">
          <option value="">Status: All</option>
          <option>Pending</option>
          <option>Approved</option>
          <option>Shipped</option>
          <option>Delivered</option>
          <option>Cancelled</option>
        </select>

        <input class="form-input h-10 text-sm bg-gray-100 dark:bg-[#283039] border-gray-300 dark:border-[#3b4754] text-gray-800 dark:text-white rounded-lg focus:ring-primary/50 focus:border-primary" type="date" x-model="filterDate"/>

        <button
  class="h-10 px-4 text-sm text-gray-600 dark:text-gray-300 hover:text-primary transition-colors"
  @click="
    $refs.searchInput.value='';
    filterStatus='';
    filterDate='';
    currentPage=1;
  "
>
  Reset
</button>
      </div>
    </div>

    <div class="overflow-x-auto">
      <table class="w-full text-sm text-left text-gray-500 dark:text-gray-400">
        <thead class="text-xs text-gray-700 dark:text-gray-300 uppercase bg-gray-50 dark:bg-[#1f2937]">
          <tr>
            <th class="p-4" scope="col"><input class="form-checkbox rounded bg-gray-200 dark:bg-gray-600 border-gray-300 dark:border-gray-500" type="checkbox"/></th>
            <th class="px-6 py-3" scope="col">Order ID</th>
            <th class="px-6 py-3" scope="col">Customer</th>
            <th class="px-6 py-3" scope="col">Amount</th>
            <th class="px-6 py-3" scope="col">Date</th>
            <th class="px-6 py-3" scope="col">Status</th>
            <th class="px-6 py-3" scope="col">Action</th>
          </tr>
        </thead>

        <tbody>
          <!-- dynamic rows (matches your original rows visually) -->
          <template x-for="order in pagedOrders()"
          :key="order.id">
            <tr class="bg-white dark:bg-[#1a2632] border-b dark:border-[#3b4754] hover:bg-gray-50 dark:hover:bg-[#283039]">
              <td class="w-4 p-4"><input class="form-checkbox rounded bg-gray-200 dark:bg-gray-600 border-gray-300 dark:border-gray-500" type="checkbox"/></td>
              <th class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white" scope="row" x-text="order.id"></th>
              <td class="px-6 py-4" x-text="order.customer"></td>
              <td class="px-6 py-4" x-text="`RS.${order.amount.toFixed(2)}`"></td>
              <td class="px-6 py-4" x-text="order.date"></td>
              <td class="px-6 py-4">

<!-- Pending -->
<span
  x-show="order.orderStatus === 'pending'"
  class="bg-yellow-100 text-yellow-800 text-xs font-medium px-2.5 py-0.5 rounded-full">
  Pending
</span>

<!-- Confirmed (Approved in UI language) -->
<span
  x-show="order.orderStatus === 'confirmed'"
  class="bg-teal-100 text-teal-800 text-xs font-medium px-2.5 py-0.5 rounded-full">
  Approved
</span>

<!-- Shipped -->
<span
  x-show="order.orderStatus === 'shipped'"
  class="bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded-full">
  Shipped
</span>
<!-- Returned -->
<span
  x-show="order.orderStatus === 'returned'"
  class="bg-orange-100 text-orange-800 text-xs font-medium px-2.5 py-0.5 rounded-full">
  Returned
</span>

<!-- Delivered -->
<span
  x-show="order.orderStatus === 'delivered'"
  class="bg-green-100 text-green-800 text-xs font-medium px-2.5 py-0.5 rounded-full">
  Delivered
</span>

<!-- Cancelled -->
<span
  x-show="order.orderStatus === 'cancelled'"
  class="bg-red-100 text-red-800 text-xs font-medium px-2.5 py-0.5 rounded-full">
  Cancelled
</span>


</td>
<td class="px-6 py-4">
  <div class="flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4">

    <!-- VIEW -->
    <button
      @click="$store.orders.openDetails(order)"
      class="font-medium text-primary hover:underline"
    >
      <span class="material-symbols-outlined">visibility</span>
    </button>

    <!-- CONFIRM -->
    <button
      x-show="
        order.orderStatus === 'pending' &&
        (
          order.paymentMethod === 'cash' ||
          order.paymentStatus === 'paid'
        )
      "
      @click="confirmOrder(order)"
      class="font-medium text-green-600 hover:underline"
    >
      <span class="material-symbols-outlined">check_circle</span>
    </button>

    <!-- SHIP -->
    <button
      x-show="order.orderStatus === 'confirmed'"
      @click="shipOrder(order)"
      class="font-medium text-blue-600 hover:underline"
    >
      <span class="material-symbols-outlined">local_shipping</span>
    </button>
    <!-- RETURN (admin only, shipped only) -->
<button
  x-show="order.orderStatus === 'shipped'"
  @click="returnOrder(order)"
  class="font-medium text-orange-600 hover:underline"
>
  <span class="material-symbols-outlined">keyboard_return</span>
</button>
<button
  x-show="order.orderStatus === 'shipped'"
  @click="markDelivered(order)"
  class="px-3 py-1 text-xs font-semibold rounded-lg bg-success text-white hover:bg-success/90"
>
  Mark Delivered
</button>
    <!-- CANCEL -->
    <button
      x-show="!['cancelled','delivered','shipped','returned'].includes(order.orderStatus)"
      @click="$store.orders.openCancel(order)"
      class="font-medium text-red-600 hover:underline"
    >
      <span class="material-symbols-outlined">cancel</span>
    </button>

  </div>
</td>



            </tr>
          </template>
        </tbody>
      </table>
    </div>

    <nav aria-label="Table navigation" class="flex items-center justify-between p-4">
      <span class="text-sm font-normal text-gray-500 dark:text-gray-400">
  Orders
  <span class="font-semibold text-gray-900 dark:text-white">
    <span x-text="pagedOrders().length"></span>
    –
    <span x-text="currentPage"></span>
  </span>
  of
  <span
    class="font-semibold text-gray-900 dark:text-white"
    x-text="totalPages()"
  ></span>
  pages
</span>



  <ul class="inline-flex -space-x-px text-sm h-8">
    <li>
      <button
        @click="currentPage = Math.max(1, currentPage - 1)"
        :disabled="currentPage === 1"
        class="flex items-center justify-center px-3 h-8 ml-0 leading-tight border rounded-l-lg"
      >
        Previous
      </button>
    </li>

    <template x-for="page in getVisiblePages(currentPage, totalPages())" :key="page">
  <button
    @click="goToPage(page)"
    :class="{
      'bg-primary text-white border-primary': page === currentPage,
      'border border-bronze/30 text-light-text dark:text-dark-text hover:bg-bronze/10 dark:hover:bg-white/10': page !== currentPage
    }"
    class="px-3 py-1 rounded transition"
    x-text="page">
  </button>
</template>



    <li>
      <button
        @click="currentPage = Math.min(totalPages(), currentPage + 1)"
        :disabled="currentPage === totalPages()"
        class="flex items-center justify-center px-3 h-8 border rounded-r-lg"
      >
        Next
      </button>
    </li>
  </ul>
</nav>

  </section>

 

</div>

<!-- USERS SECTION -->
<div
  x-show="activeView === 'users'"
  x-cloak
  x-transition.opacity.duration.400ms
  x-init="fetchUsers()"
  x-data="usersSection()"
  class="space-y-6 animate-fade-in"
>
<script>
window.loyaltyBadgeConfig = function (tier) {
  const map = {
    bronze:   { label: 'Bronze',   icon: 'workspace_premium', color: 'bg-amber-100 text-amber-800' },
    silver:   { label: 'Silver',   icon: 'military_tech',     color: 'bg-gray-200 text-gray-800' },
    gold:     { label: 'Gold',     icon: 'emoji_events',      color: 'bg-yellow-100 text-yellow-800' },
    platinum: { label: 'Platinum', icon: 'stars',             color: 'bg-indigo-100 text-indigo-800' },
    diamond:  { label: 'Diamond',  icon: 'diamond',           color: 'bg-primary/10 text-primary' }
  };
  return map[tier] || map.bronze;
};
</script>

<script>
function usersSection() {
  return {
    users: [],
    loading: true,

    search: '',
    filterRole: '',
    filterStatus: '',
    viewMode: 'list',
    currentPage: 1,
    perPage: 6,

    async fetchUsers() {
      try {
        const token = localStorage.getItem('token');

        const res = await fetch('https://perfume-store-production.up.railway.app/api/admin/users', {
          headers: { Authorization: `Bearer ${token}` }
        });

        const data = await res.json();
        if (!res.ok) throw new Error(data.message);

        this.users = data.users.map(u => ({
  id: u._id,
  name: u.name || u.email.split('@')[0],
  email: u.email,

  // ===== CORE (ADMIN + USER) =====
  phone: u.phone || '',
  address: u.address || '',

  // ===== USER-ENTERED DETAILS (VIEW ONLY FOR ADMIN) =====
  profileDetails: {
    province: u.profileDetails?.province || '',
    district: u.profileDetails?.district || '',
    city: u.profileDetails?.city || '',
    postalCode: u.profileDetails?.postalCode || ''
  },

  notes: u.notes || '',
  role: u.role || 'user',
  status: u.computedStatus || 'active',
  avatar: u.avatar || this.fallbackAvatar(u),
  loyaltyTier: u.loyaltyTier || 'bronze',
  loyaltyMode: u.loyaltyMode || 'auto'
}));

      } catch (err) {
        console.error('FAILED TO LOAD USERS', err);
        alert('Failed to load users');
      } finally {
        this.loading = false;
      }
    },

    pagedUsers() {
      const start = (this.currentPage - 1) * this.perPage;
      return this.filteredUsers().slice(start, start + this.perPage);
    },

    goToPage(page) {
      this.currentPage = page;
    },

    totalPages() {
      return Math.max(1, Math.ceil(this.filteredUsers().length / this.perPage));
    },

    formatRole(role) {
      return role ? role.charAt(0).toUpperCase() + role.slice(1) : 'User';
    },

    formatStatus(status) {
      return status
        ? status.charAt(0).toUpperCase() + status.slice(1)
        : 'Active';
    },

   

    fallbackAvatar(user) {
      const base = user.name || user.email.split('@')[0];
      const initials = base
        .split(' ')
        .map(w => w[0])
        .join('')
        .substring(0, 2)
        .toUpperCase();

      return `https://ui-avatars.com/api/?name=${initials}&background=8B5A2B&color=fff`;
    },

    filteredUsers() {
      return this.users.filter(u => {
        const q = this.search.toLowerCase().trim();
        if (q && !(`${u.name} ${u.email} ${u.id}`).toLowerCase().includes(q)) return false;
        if (this.filterRole && u.role !== this.filterRole) return false;
        if (this.filterStatus && u.status !== this.filterStatus) return false;
        return true;
      });
    }
  };
}
</script>

<div class="flex flex-wrap justify-between items-center gap-4">
  <div class="flex flex-col gap-2">
      <p class="text-gray-900 dark:text-white text-4xl font-black leading-tight tracking-[-0.033em]">Users Management</p>
      <p class="text-gray-500 dark:text-[#9dabb9] text-base">View, filter, and manage users.</p>
    </div>

    <div class="flex items-center gap-3">
      <div class="flex items-center rounded-lg border border-gray-200 dark:border-[#3b4754] p-1">
        <button :class="{'bg-gray-100 dark:bg-[#283039]': viewMode === 'list'}" @click="viewMode = 'list'" class="px-3 py-2 rounded-md">List</button>
        <button :class="{'bg-gray-100 dark:bg-[#283039]': viewMode === 'grid'}" @click="viewMode = 'grid'" class="px-3 py-2 rounded-md">Grid</button>
      </div>
      <button @click="$store.userModals.openAdd()" class="flex items-center gap-2 px-4 py-2 text-sm font-medium text-white bg-primary rounded-lg hover:bg-primary/90">
        <span class="material-symbols-outlined text-base">add_circle</span> Add New User
      </button>
    </div>
</div>

  <!-- Stats Cards -->
  <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4">
    <div class="flex flex-col gap-2 rounded-lg p-6 bg-white dark:bg-[#1a2632] border border-gray-200 dark:border-[#3b4754]">
      <p class="text-gray-600 dark:text-white text-base">Total Users</p>
      <p class="text-gray-900 dark:text-white text-2xl font-bold" x-text="users.length"></p>
    </div>
    <div class="flex flex-col gap-2 rounded-lg p-6 bg-white dark:bg-[#1a2632] border border-gray-200 dark:border-[#3b4754]">
      <p class="text-gray-600 dark:text-white text-base">Active Users</p>
      <p class="text-gray-900 dark:text-white text-2xl font-bold"x-text="users.filter(u => u.status === 'active').length"></p>
    </div>
    <div class="flex flex-col gap-2 rounded-lg p-6 bg-white dark:bg-[#1a2632] border border-gray-200 dark:border-[#3b4754]">
      <p class="text-gray-600 dark:text-white text-base">Suspended Users</p>
      <p
  class="text-gray-900 dark:text-white text-2xl font-bold"
  x-text="users.filter(u => u.status === 'suspended').length">
</p>


    </div>
    <div class="flex flex-col gap-2 rounded-lg p-6 bg-white dark:bg-[#1a2632] border border-gray-200 dark:border-[#3b4754]">
  <p class="text-gray-600 dark:text-white text-base">Pending Users</p>
  <p class="text-gray-900 dark:text-white text-2xl font-bold"
     x-text="users.filter(u => u.status === 'pending').length">
  </p>
</div>

    <div class="flex flex-col gap-2 rounded-lg p-6 bg-white dark:bg-[#1a2632] border border-gray-200 dark:border-[#3b4754]">
      <p class="text-gray-600 dark:text-white text-base">Admins</p>
      <p class="text-gray-900 dark:text-white text-2xl font-bold" x-text="users.filter(u => u.role === 'admin').length"></p>
    </div>
  </div>

  <!-- Filters -->
  <div class="bg-white dark:bg-[#1a2632] border border-gray-200 dark:border-[#3b4754] rounded-xl p-4">
    <div class="flex flex-wrap items-center gap-3">
      <div class="flex-grow">
        <label class="relative w-full">
          <div class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"><span class="material-symbols-outlined">search</span></div>
          <input type="text" placeholder="Search by name, email or id..." class="form-input w-full pl-10 h-10 rounded-lg bg-gray-100 dark:bg-[#283039] border border-gray-300 dark:border-[#3b4754] text-sm" x-model="search" />
        </label>
      </div>

      <select class="form-select h-10 text-sm bg-gray-100 dark:bg-[#283039] border border-gray-300 dark:border-[#3b4754] rounded-lg" x-model="filterRole">
        <option value="">Role: All</option>
<option value="admin">Admin</option>
<option value="user">User</option>

      </select>

      <select class="form-select h-10 text-sm bg-gray-100 dark:bg-[#283039] border border-gray-300 dark:border-[#3b4754] rounded-lg" x-model="filterStatus">
        <option value="">Status: All</option>
<option value="active">Active</option>
<option value="suspended">Suspended</option>
<option value="pending">Pending</option>

      </select>

      <button
  class="h-10 px-4 text-sm text-gray-600 dark:text-gray-300 hover:text-primary"
  @click="
    search = '';
    filterRole = '';
    filterStatus = '';
    currentPage = 1;
  "
>
  Reset
</button>
    </div>
  </div>
  <!-- Loading state -->
<div x-show="loading" class="text-center py-10 text-gray-500 dark:text-gray-400">
  Loading users…
</div>
<div x-show="!loading">
  
  <!-- Grid view -->
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6" x-show="viewMode === 'grid'">
    <template x-for="user in pagedUsers()" :key="user.id">
      <div class="bg-white dark:bg-[#1a2632] border border-gray-200 dark:border-[#3b4754] rounded-xl p-4 flex flex-col">
        <div class="flex items-center gap-4">
          <div class="h-16 w-16 rounded-full bg-cover bg-center" :style="`background-image: url(${user.avatar})`"></div>
          <div>
            <div class="font-semibold text-gray-900 dark:text-white" x-text="user.name"></div>
            <div class="text-xs text-gray-500 dark:text-gray-400" x-text="user.email"></div>
            <div class="text-xs text-gray-500 dark:text-gray-400" x-text="user.phone"></div>
          </div>
        </div>
        <div class="mt-4 flex items-center justify-between">
          <div>
            <span
  class="inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium"
  :class="{
  'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300': user.status === 'active',
  'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300': user.status === 'suspended',
  'bg-gray-200 text-gray-800 dark:bg-gray-700 dark:text-gray-300': user.status === 'pending'
}"
x-text="user.status.charAt(0).toUpperCase() + user.status.slice(1)"

></span>

          </div>
          <!-- Loyalty Badge -->
<template x-if="user.loyaltyTier">
  <span
    class="mt-1 inline-flex items-center gap-1 rounded-full px-2 py-0.5 text-xs font-medium"
    :class="loyaltyBadgeConfig(user.loyaltyTier).color"
  >
    <span class="material-symbols-outlined text-[14px]"
      x-text="loyaltyBadgeConfig(user.loyaltyTier).icon"></span>
    <span x-text="loyaltyBadgeConfig(user.loyaltyTier).label"></span>
  </span>
</template>

          <div class="flex items-center gap-2">
            <button @click="$store.userModals.openView(user)" class="p-2 rounded-lg text-gray-600 hover:text-primary"><span class="material-symbols-outlined">visibility</span></button>
            <button
  @click="user.status !== 'pending' && $store.userModals.openEdit(user)"
  :disabled="user.status === 'pending'"
  :class="user.status === 'pending'
    ? 'opacity-40 cursor-not-allowed'
    : 'hover:text-primary'"
>
  <span class="material-symbols-outlined">edit</span>
</button>
            <button @click="$store.userModals.openDelete(user)" class="p-2 rounded-lg text-red-600 hover:text-red-800"><span class="material-symbols-outlined">delete</span></button>
          </div>
        </div>
      </div>
    </template>
    <template x-if="filteredUsers().length === 0">
      <div class="col-span-full text-center text-gray-500">No users found.</div>
    </template>
  </div>

  <!-- List view -->
  <div class="overflow-x-auto" x-show="viewMode === 'list'">
    <table class="w-full text-sm text-left">
      <thead class="bg-gray-50 dark:bg-[#1f2937]">
        <tr>
          <th class="px-6 py-3 text-xs font-medium uppercase tracking-wider text-gray-500 dark:text-gray-300">User</th>
          <th class="px-6 py-3 text-xs font-medium uppercase tracking-wider text-gray-500 dark:text-gray-300">Email</th>
          <th class="px-6 py-3 text-xs font-medium uppercase tracking-wider text-gray-500 dark:text-gray-300">Phone</th>
          <th class="px-6 py-3 text-xs font-medium uppercase tracking-wider text-gray-500 dark:text-gray-300">Role</th>
          <th class="px-6 py-3 text-xs font-medium uppercase tracking-wider text-gray-500 dark:text-gray-300">
  Loyalty
</th>
          <th class="px-6 py-3 text-xs font-medium uppercase tracking-wider text-gray-500 dark:text-gray-300">Status</th>
          <th class="px-6 py-3 text-xs font-medium uppercase tracking-wider text-gray-500 dark:text-gray-300 text-right">Actions</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-200 dark:divide-[#283039]">
        <template x-for="user in pagedUsers()" :key="user.id">
          <tr class="bg-white dark:bg-[#1a2632]">
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="flex items-center gap-3">
                <div class="h-10 w-10 rounded-full bg-cover bg-center" :style="`background-image: url(${user.avatar})`"></div>
                <div>
                  <div class="font-medium text-gray-900 dark:text-white" x-text="user.name"></div>
                  <div class="text-xs text-gray-500 dark:text-gray-400" x-text="user.id"></div>
                </div>
              </div>
            </td>
            <td class="px-6 py-4 text-sm text-gray-500 dark:text-gray-400" x-text="user.email"></td>
            <td class="px-6 py-4 text-sm text-gray-500 dark:text-gray-400" x-text="user.phone"></td>
            <td class="px-6 py-4 whitespace-nowrap">
              <span
  class="inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium"
  :class="{
    'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300': user.role === 'admin',
    'bg-gray-200 text-gray-800 dark:bg-gray-700 dark:text-gray-300': user.role === 'user'
  }"
  x-text="user.role.charAt(0).toUpperCase() + user.role.slice(1)"
></span>

            </td>
            <td class="px-6 py-4 whitespace-nowrap">
  <span
    class="inline-flex items-center gap-1 rounded-full px-2 py-0.5 text-xs font-medium"
    :class="loyaltyBadgeConfig(user.loyaltyTier).color"
  >
    <span class="material-symbols-outlined text-[14px]"
      x-text="loyaltyBadgeConfig(user.loyaltyTier).icon"></span>
    <span x-text="loyaltyBadgeConfig(user.loyaltyTier).label"></span>
  </span>
</td>

            <td class="px-6 py-4 whitespace-nowrap">
              <span
  class="inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium"
  :class="{
    'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300': user.status === 'active',
    'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300': user.status === 'suspended',
    'bg-gray-200 text-gray-800 dark:bg-gray-700 dark:text-gray-300': user.status === 'pending'
  }"
  x-text="user.status.charAt(0).toUpperCase() + user.status.slice(1)">
</span>

            </td>
            <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
              <div class="flex items-center justify-end gap-2">
                <button @click="$store.userModals.openView(user)" class="p-2 text-gray-400 hover:text-primary rounded-lg"><span class="material-symbols-outlined">visibility</span></button>
                <button
  @click="user.status !== 'pending' && $store.userModals.openEdit(user)"
  :disabled="user.status === 'pending'"
  :class="user.status === 'pending'
    ? 'opacity-40 cursor-not-allowed'
    : 'hover:text-primary'"
>
  <span class="material-symbols-outlined">edit</span>
</button>
                <button @click="$store.userModals.openDelete(user)" class="p-2 text-red-600 hover:text-red-800 rounded-lg"><span class="material-symbols-outlined">delete</span></button>
              </div>
            </td>
          </tr>
        </template>
        <template x-if="filteredUsers().length === 0">
          <tr><td class="px-6 py-4 text-gray-500" colspan="6">No users match the filters.</td></tr>
        </template>
      </tbody>
    </table>
  </div>
  </div>
 

  <!-- PAGINATION (static placeholder like ) -->
  <nav class="flex items-center justify-between p-4">
  <span class="text-sm text-gray-500 dark:text-gray-400">
    Showing
    <span class="font-semibold text-gray-900 dark:text-white"
      x-text="filteredUsers().length === 0 ? 0 : (currentPage - 1) * perPage + 1"></span>
    –
    <span class="font-semibold text-gray-900 dark:text-white"
      x-text="Math.min(currentPage * perPage, filteredUsers().length)"></span>
    of
    <span class="font-semibold text-gray-900 dark:text-white"
      x-text="filteredUsers().length"></span>
  </span>

  <ul class="inline-flex -space-x-px text-sm h-8">
    <!-- Previous -->
    <li>
      <button
        @click="currentPage--"
        :disabled="currentPage === 1"
        class="px-3 h-8 border rounded-l-lg"
        :class="currentPage === 1 ? 'text-gray-300' : 'hover:bg-gray-100'"
      >
        Previous
      </button>
    </li>

    <!-- Page Numbers -->
    <template x-for="page in getVisiblePages(currentPage, totalPages())" :key="page">
  <button
    @click="goToPage(page)"
    :class="{
      'bg-primary text-white border-primary': page === currentPage,
      'border border-bronze/30 text-light-text dark:text-dark-text hover:bg-bronze/10 dark:hover:bg-white/10': page !== currentPage
    }"
    class="px-3 py-1 rounded transition"
    x-text="page">
  </button>
</template>



    <!-- Next -->
    <li>
      <button
        @click="currentPage++"
        :disabled="currentPage === totalPages()"
        class="px-3 h-8 border rounded-r-lg"
        :class="currentPage === totalPages() ? 'text-gray-300' : 'hover:bg-gray-100'"
      >
        Next
      </button>
    </li>
  </ul>
</nav>

 



</div>
<!-- STOCK CONTROL SECTION -->
<div 
    x-show="activeView === 'stock'" 
    x-transition.opacity.duration.300ms 
    class="w-full"
>
    
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-3xl font-bold">Stock Control</h1>

        <div class="flex items-center gap-3">
            <button class="px-4 py-2 bg-bronze/10 dark:bg-primary/10 rounded-lg text-bronze dark:text-primary font-semibold">
                Import
            </button>

            <button class="px-4 py-2 bg-bronze/10 dark:bg-primary/10 rounded-lg text-bronze dark:text-primary font-semibold">
                Export
            </button>

            <button 
            @click="$store.stock.bulkOpen = true"
            class="flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg font-semibold shadow hover:bg-primary/90 transition"
            >
                <span class="material-symbols-outlined">edit</span>
                Bulk Update
            </button>
        </div>
    </div>

    <!-- STOCK TABLE -->
    <div class="bg-white dark:bg-gray-900 rounded-xl shadow border border-gray-200 dark:border-gray-800">
      <div class="overflow-x-auto overscroll-x-contain">
        <table class="w-full min-w-[900px] text-left whitespace-nowrap">
                      <thead class="bg-gray-50 dark:bg-gray-800/50 text-gray-600 dark:text-gray-300 text-sm">
                <tr>
                    <th class="p-4">Product</th>
                    <th class="p-4">Quality</th>
                    <th class="p-4">Current Stock</th>
                    <th class="p-4">Reorder Level</th>
                    <th class="p-4">Status</th>
                    <th class="p-4">Actions</th>
                </tr>
            </thead>

            <tbody>
              <template x-for="item in $store.stock.items" :key="item.id">
                <tr class="border-t border-gray-200 dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-800/50 transition">

      <!-- Product -->
      <td class="p-4 flex items-center gap-3">
        <img
  class="w-12 h-12 rounded-lg object-cover border"
  :src= "product.images?.[0] || '/placeholder.png'"
  alt="Product"
/>
        <span class="font-semibold" x-text="item.name"></span>
      </td>

      <!-- Category (TEMP – later replaced with Quality) -->
      <td class="p-4 font-medium capitalize" x-text="item.quality"></td>

      <!-- Current Stock -->
      <td class="p-4">
        <div class="flex gap-2 flex-nowrap">
              <template x-for="s in item.bottleSizes" :key="s.sizeMl">
      <span
        class="px-2 py-1 text-xs rounded-md bg-gray-100 dark:bg-gray-800 font-semibold"
        x-text="s.sizeMl + 'ml: ' + s.stock"
      ></span>
    </template>
  </div>
</td>

      <!-- Reorder Level -->
      <td class="p-4" x-text="item.reorder"></td>

      <!-- Status -->
      <td class="p-4">
        <span
        class="px-3 py-1 text-xs rounded-full font-semibold whitespace-nowrap inline-block"
                  :class="{
            'bg-green-100 text-green-700': item.status === 'In Stock',
            'bg-yellow-100 text-yellow-700': item.status === 'Low Stock',
            'bg-red-100 text-red-700': item.status === 'Out of Stock'
          }"
          x-text="item.status"
        ></span>
      </td>

      <!-- Actions -->
      <td class="p-4">
        <button
          @click="$store.stock.openUpdate(item)"
          class="px-3 py-1.5 text-sm border border-primary text-primary rounded-lg hover:bg-primary hover:text-white transition"
        >
          Update
        </button>
      </td>

    </tr>
  </template>
</tbody>

<!--stocks scripta-->
<script>
document.addEventListener('alpine:init', () => {

  Alpine.store('stock', {

    /* ================= STATE ================= */
    items: [],
    updateOpen: false,
    bulkOpen: false,

    editItem: null,
    selectedSize: null,

    addValue: '',
    reduceValue: '',

    bulk: {
      quality: 'all',
      size: 'all',
      action: 'increase',
      value: 0
    },

    /* ================= LOAD ================= */
    async loadStockProducts() {
      const token = localStorage.getItem("token");

      const res = await fetch("https://perfume-store-production.up.railway.app/api/admin/products", {
        headers: { Authorization: `Bearer ${token}` }
      });

      const data = await res.json();

      this.items = (data.products || []).map(p => {
        const totalStock = (p.bottleSizes || []).reduce(
          (sum, s) => sum + (s.stock || 0),
          0
        );

        let status = "In Stock";
        if (totalStock === 0) status = "Out of Stock";
        else if (totalStock < 20) status = "Low Stock";

        return {
          id: p._id,
          name: p.name,
          image: p.images?.[0]
            ? `https://perfume-store-production.up.railway.app/${p.images[0]}`
            : "",
          quality: p.quality,
          reorder: 20,
          status,
          bottleSizes: p.bottleSizes.map(s => ({
            sizeMl: s.sizeMl,
            stock: s.stock || 0,
            enabled: s.enabled === true
          }))
        };
      });
    },

    /* ================= OPEN UPDATE ================= */
    openUpdate(item) {
      this.editItem = JSON.parse(JSON.stringify(item));
      this.selectedSize = null;
      this.addValue = '';
      this.reduceValue = '';
      this.updateOpen = true;
    },

    /* ================= SIZE SELECT ================= */
    selectSize(size) {
  this.selectedSize = size;
  this.addValue = '';
  this.reduceValue = '';
},


    /* ================= TOGGLE ================= */
    toggleAvailability(size) {
      if (size.stock === 0) {
        size.enabled = false;
        return;
      }
      size.enabled = !size.enabled;

      if (!size.enabled && this.selectedSize?.sizeMl === size.sizeMl) {
        this.selectedSize = null;
      }
    },

    /* ================= SAVE SINGLE ================= */
    async saveStock() {
      const token = localStorage.getItem("token");

      if (this.selectedSize) {
        const add = Number(this.addValue) || 0;
        const reduce = Number(this.reduceValue) || 0;

        let newStock = this.selectedSize.stock + add - reduce;
        if (newStock < 0) newStock = 0;

        this.selectedSize.stock = newStock;

// auto-enable only if stock was 0 → now > 0
if (newStock > 0 && this.selectedSize.enabled === false) {
  this.selectedSize.enabled = true;
}

// auto-disable if stock becomes 0
if (newStock === 0) {
  this.selectedSize.enabled = false;
}

      }

      const payload = {
        bottleSizes: this.editItem.bottleSizes.map(s => ({
          sizeMl: s.sizeMl,
          stock: Number(s.stock),
          enabled: Boolean(s.enabled)
        }))
      };

      await fetch(
        `https://perfume-store-production.up.railway.app/api/admin/products/${this.editItem.id}/stock`,
        {
          method: "PUT",
          headers: {
            "Content-Type": "application/json",
            Authorization: `Bearer ${token}`
          },
          body: JSON.stringify(payload)
        }
      );

      await this.loadStockProducts();
      this.updateOpen = false;
    },

    /* ================= BULK APPLY ================= */
    async applyBulkUpdate() {
      const token = localStorage.getItem("token");
      const value = Number(this.bulk.value);
      if (!value || value <= 0) return;

      for (const item of this.items) {

        if (this.bulk.quality !== 'all' && item.quality !== this.bulk.quality) {
          continue;
        }

        const updatedSizes = item.bottleSizes.map(s => {
          if (this.bulk.size !== 'all' && Number(this.bulk.size) !== s.sizeMl) {
            return s;
          }

          let stock = s.stock || 0;

          if (this.bulk.action === 'increase') {
            stock += value;
          } else {
            stock = Math.max(0, stock - value);
          }

          return {
            ...s,
            stock,
            enabled: stock > 0
          };
        });

        await fetch(
          `https://perfume-store-production.up.railway.app/api/admin/products/${item.id}/stock`,
          {
            method: "PUT",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${token}`
            },
            body: JSON.stringify({ bottleSizes: updatedSizes })
          }
        );
      }

      await this.loadStockProducts();
      this.bulkOpen = false;
      this.bulk.value = 0;
    }

  });

});
</script>


<script>
document.addEventListener('DOMContentLoaded', () => {
  Alpine.store('stock').loadStockProducts();
});
</script>


        </table>

    </div>

</div>

<div 
    x-show="activeView === 'analytics'" 
    x-transition.opacity 
    class="space-y-6 animate-fade-in"
    >
<div class="flex flex-col md:flex-row md:items-end justify-between gap-6">
<div class="space-y-2">

<h1 class="text-3xl font-bold tracking-tight text-gray-900 dark:text-white">Analytics Dashboard</h1>
</div>
<div class="flex flex-wrap items-center gap-3">
<button class="flex items-center gap-2 bg-surface-light dark:bg-surface-dark border border-border-light dark:border-border-dark px-4 py-2 rounded-lg text-sm font-medium text-gray-700 dark:text-gray-200 hover:border-primary transition-colors shadow-sm">
<span class="material-symbols-outlined text-[18px]">calendar_today</span>
<span>Oct 1, 2023 - Oct 31, 2023</span>
<span class="material-symbols-outlined text-[18px]">expand_more</span>
</button>
<div class="flex bg-surface-light dark:bg-surface-dark rounded-lg p-1 border border-border-light dark:border-border-dark shadow-sm">
<button class="p-2 hover:bg-gray-100 dark:hover:bg-border-dark rounded transition-colors text-gray-600 dark:text-gray-300" title="Export PNG">
<span class="material-symbols-outlined text-[20px]">image</span>
</button>
<button class="p-2 hover:bg-gray-100 dark:hover:bg-border-dark rounded transition-colors text-gray-600 dark:text-gray-300" title="Export PDF">
<span class="material-symbols-outlined text-[20px]">picture_as_pdf</span>
</button>
</div>
</div>
</div>

<section id="analytics-tabs" class="space-y-8">

<input checked="" class="hidden" id="tab-sales" name="tabs" type="radio"/>
<input class="hidden" id="tab-products" name="tabs" type="radio"/>
<input class="hidden" id="tab-customers" name="tabs" type="radio"/>
<div class="flex flex-col lg:flex-row justify-between items-start lg:items-center border-b border-border-light dark:border-border-dark pb-1 gap-4 tabs-nav">
<div class="tabs-nav flex gap-6 overflow-x-auto scrollbar-hide w-full lg:w-auto">
<label class="cursor-pointer pb-3 border-b-2 border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white font-medium text-sm transition-colors whitespace-nowrap" for="tab-sales">
                    Sales Overview
                </label>
<label class="cursor-pointer pb-3 border-b-2 border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white font-medium text-sm transition-colors whitespace-nowrap" for="tab-products">
                    Products
                </label>

<label class="cursor-pointer pb-3 border-b-2 border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white font-medium text-sm transition-colors whitespace-nowrap" for="tab-customers">
                    Customer Insights
                </label>
</div>
<div class="flex gap-2">
<div class="relative">
<select class="appearance-none bg-surface-light dark:bg-surface-dark border border-border-light dark:border-border-dark text-gray-700 dark:text-gray-300 text-sm rounded-lg pl-3 pr-8 py-2 focus:ring-primary focus:border-primary">
<option>This Month</option>
<option>Last Month</option>
<option>Last Quarter</option>
</select>
<span class="material-symbols-outlined absolute right-2 top-2.5 text-gray-500 text-sm pointer-events-none">expand_more</span>
</div>
<div class="relative">
<select class="appearance-none bg-surface-light dark:bg-surface-dark border border-border-light dark:border-border-dark text-gray-700 dark:text-gray-300 text-sm rounded-lg pl-3 pr-8 py-2 focus:ring-primary focus:border-primary">
<option>All Categories</option>
<option>Electronics</option>
<option>Fashion</option>
<option>Home</option>
</select>
<span class="material-symbols-outlined absolute right-2 top-2.5 text-gray-500 text-sm pointer-events-none">expand_more</span>
</div>
</div>
</div>
<div class="content-sales space-y-8">
<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4">
<div class="bg-surface-light dark:bg-surface-dark p-5 rounded-xl border border-border-light dark:border-border-dark shadow-sm hover:border-primary/50 transition-colors group">
<div class="flex justify-between items-start mb-2">
<p class="text-sm font-medium text-gray-500 dark:text-gray-400">Monthly Revenue</p>
<div class="p-1.5 bg-green-500/10 rounded-md text-green-500">
<span class="material-symbols-outlined text-[20px]">payments</span>
</div>
</div>
<div class="flex items-end gap-2">
<h3 class="text-2xl font-bold text-gray-900 dark:text-white">$0</h3>
<span class="text-xs font-medium text-green-500 flex items-center mb-1">
<span class="material-symbols-outlined text-[14px]">trending_up</span>
                            12%
                        </span>
</div>
</div>
<div class="bg-surface-light dark:bg-surface-dark p-5 rounded-xl border border-border-light dark:border-border-dark shadow-sm hover:border-primary/50 transition-colors">
<div class="flex justify-between items-start mb-2">
<p class="text-sm font-medium text-gray-500 dark:text-gray-400">Total Orders</p>
<div class="p-1.5 bg-blue-500/10 rounded-md text-blue-500">
<span class="material-symbols-outlined text-[20px]">shopping_cart</span>
</div>
</div>
<div class="flex items-end gap-2">
<h3 class="text-2xl font-bold text-gray-900 dark:text-white">0</h3>
<span class="text-xs font-medium text-green-500 flex items-center mb-1">
<span class="material-symbols-outlined text-[14px]">trending_up</span>
                            8%
                        </span>
</div>
</div>

<div class="bg-surface-light dark:bg-surface-dark p-5 rounded-xl border border-border-light dark:border-border-dark shadow-sm hover:border-primary/50 transition-colors">
<div class="flex justify-between items-start mb-2">
<p class="text-sm font-medium text-gray-500 dark:text-gray-400">Top Product</p>
<div class="p-1.5 bg-orange-500/10 rounded-md text-orange-500">
<span class="material-symbols-outlined text-[20px]">star</span>
</div>
</div>
<div class="flex flex-col">
<h3 class="text-lg font-bold text-gray-900 dark:text-white truncate">Lacoste</h3>
<span class="text-xs text-gray-500 dark:text-gray-400">
                            342 sold this month
                        </span>
</div>
</div>
<div class="bg-surface-light dark:bg-surface-dark p-5 rounded-xl border border-border-light dark:border-border-dark shadow-sm hover:border-primary/50 transition-colors">
<div class="flex justify-between items-start mb-2">
<p class="text-sm font-medium text-gray-500 dark:text-gray-400">Returning Customers</p>
<div class="p-1.5 bg-pink-500/10 rounded-md text-pink-500">
<span class="material-symbols-outlined text-[20px]">group_add</span>
</div>
</div>
<div class="flex items-end gap-2">
<h3 class="text-2xl font-bold text-gray-900 dark:text-white">0%</h3>
<span class="text-xs font-medium text-red-500 flex items-center mb-1">
<span class="material-symbols-outlined text-[14px]">trending_down</span>
                            2%
                        </span>
</div>
</div>
</div>
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
<div class="lg:col-span-2 bg-surface-light dark:bg-surface-dark p-6 rounded-xl border border-border-light dark:border-border-dark shadow-sm flex flex-col h-96">
<div class="flex justify-between items-center mb-6">
<h3 class="text-lg font-bold text-gray-900 dark:text-white">Revenue vs Cost</h3>
<div class="flex items-center gap-4 text-xs">
<div class="flex items-center gap-1">
<span class="w-3 h-3 rounded-full bg-primary"></span>
<span class="text-gray-500 dark:text-gray-400">Revenue</span>
</div>
<div class="flex items-center gap-1">
<span class="w-3 h-3 rounded-full bg-gray-300 dark:bg-gray-600"></span>
<span class="text-gray-500 dark:text-gray-400">Cost</span>
</div>
</div>
</div>
<div class="flex-1 relative w-full h-full flex items-end justify-between px-2 gap-2">
<div class="absolute inset-0 flex flex-col justify-between pointer-events-none">
<div class="border-b border-dashed border-gray-200 dark:border-gray-700 w-full h-0"></div>
<div class="border-b border-dashed border-gray-200 dark:border-gray-700 w-full h-0"></div>
<div class="border-b border-dashed border-gray-200 dark:border-gray-700 w-full h-0"></div>
<div class="border-b border-dashed border-gray-200 dark:border-gray-700 w-full h-0"></div>
<div class="border-b border-gray-300 dark:border-gray-600 w-full h-0"></div>
</div>
<svg class="absolute inset-0 w-full h-full z-10 overflow-visible" preserveAspectRatio="none" viewBox="0 0 100 100">
<path class="animate-path" d="M0,80 Q10,70 20,60 T40,40 T60,50 T80,20 T100,30" fill="none" stroke="#137fec" stroke-linecap="round" stroke-width="2" vector-effect="non-scaling-stroke"></path>
<path d="M0,80 Q10,70 20,60 T40,40 T60,50 T80,20 T100,30 V100 H0 Z" fill="url(#gradient)" opacity="0.2" vector-effect="non-scaling-stroke"></path>
<defs>
<linearGradient id="gradient" x1="0%" x2="0%" y1="0%" y2="100%">
<stop offset="0%" style="stop-color:#137fec;stop-opacity:1"></stop>
<stop offset="100%" style="stop-color:#137fec;stop-opacity:0"></stop>
</linearGradient>
</defs>
<path class="animate-path" d="M0,90 Q15,85 30,80 T50,70 T70,75 T90,60 T100,65" fill="none" stroke="#9ca3af" stroke-dasharray="4" stroke-width="2" style="animation-delay: 0.5s" vector-effect="non-scaling-stroke"></path>
</svg>
<div class="absolute -bottom-6 w-full flex justify-between text-xs text-gray-400">
<span>Jan</span>
<span>Feb</span>
<span>Mar</span>
<span>Apr</span>
<span>May</span>
<span>Jun</span>
<span>Jul</span>
</div>
</div>
</div>
<div class="bg-surface-light dark:bg-surface-dark p-6 rounded-xl border border-border-light dark:border-border-dark shadow-sm flex flex-col h-96">
<h3 class="text-lg font-bold text-gray-900 dark:text-white mb-6">Best Selling</h3>
<div class="flex flex-col justify-between flex-1 gap-4">
<div class="space-y-1">
<div class="flex justify-between text-xs">
<span class="text-gray-500 dark:text-gray-300">Headphones Pro</span>
<span class="font-bold dark:text-white">85%</span>
</div>
<div class="h-2 w-full bg-gray-100 dark:bg-gray-700 rounded-full overflow-hidden">
<div class="h-full bg-primary rounded-full animate-bar" style="width: 0; --target-height: 100%; width: 85%;"></div>
</div>
</div>
<div class="space-y-1">
<div class="flex justify-between text-xs">
<span class="text-gray-500 dark:text-gray-300">Smart Watch V2</span>
<span class="font-bold dark:text-white">65%</span>
</div>
<div class="h-2 w-full bg-gray-100 dark:bg-gray-700 rounded-full overflow-hidden">
<div class="h-full bg-purple-500 rounded-full animate-bar" style="width: 0; --target-height: 100%; width: 65%;"></div>
</div>
</div>
<div class="space-y-1">
<div class="flex justify-between text-xs">
<span class="text-gray-500 dark:text-gray-300">Ergo Chair</span>
<span class="font-bold dark:text-white">50%</span>
</div>
<div class="h-2 w-full bg-gray-100 dark:bg-gray-700 rounded-full overflow-hidden">
<div class="h-full bg-cyan-500 rounded-full animate-bar" style="width: 0; --target-height: 100%; width: 50%;"></div>
</div>
</div>
<div class="space-y-1">
<div class="flex justify-between text-xs">
<span class="text-gray-500 dark:text-gray-300">Wireless Mouse</span>
<span class="font-bold dark:text-white">45%</span>
</div>
<div class="h-2 w-full bg-gray-100 dark:bg-gray-700 rounded-full overflow-hidden">
<div class="h-full bg-orange-400 rounded-full animate-bar" style="width: 0; --target-height: 100%; width: 45%;"></div>
</div>
</div>
<div class="space-y-1">
<div class="flex justify-between text-xs">
<span class="text-gray-500 dark:text-gray-300">USB-C Hub</span>
<span class="font-bold dark:text-white">20%</span>
</div>
<div class="h-2 w-full bg-gray-100 dark:bg-gray-700 rounded-full overflow-hidden">
<div class="h-full bg-pink-500 rounded-full animate-bar" style="width: 0; --target-height: 100%; width: 20%;"></div>
</div>
</div>
</div>
</div>
<div class="bg-surface-light dark:bg-surface-dark p-6 rounded-xl border border-border-light dark:border-border-dark shadow-sm h-80">
<h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4">Revenue by Category</h3>
<div class="flex items-center justify-center h-48 relative">
<div class="w-40 h-40 rounded-full" style="background: conic-gradient(
                            #137fec 0% 40%, 
                            #a855f7 40% 70%, 
                            #06b6d4 70% 90%, 
                            #283039 90% 100%
                         );"></div>
<div class="absolute w-28 h-28 bg-surface-light dark:bg-surface-dark rounded-full flex items-center justify-center flex-col">
<span class="text-xs text-gray-500">Total</span>
<span class="text-xl font-bold dark:text-white">$45k</span>
</div>
</div>
<div class="flex justify-center gap-4 mt-2">
<div class="flex items-center gap-1 text-xs text-gray-500 dark:text-gray-400">
<span class="w-2 h-2 rounded-full bg-primary"></span> Tech
                        </div>
<div class="flex items-center gap-1 text-xs text-gray-500 dark:text-gray-400">
<span class="w-2 h-2 rounded-full bg-purple-500"></span> Home
                        </div>
<div class="flex items-center gap-1 text-xs text-gray-500 dark:text-gray-400">
<span class="w-2 h-2 rounded-full bg-cyan-500"></span> Fashion
                        </div>
</div>
</div>

<div class="lg:col-span-3 bg-surface-light dark:bg-surface-dark p-6 rounded-xl border border-border-light dark:border-border-dark shadow-sm h-64 flex flex-col">
<div class="flex justify-between items-center mb-4">
<h3 class="text-lg font-bold text-gray-900 dark:text-white">Customer Acquisition</h3>
<button class="text-gray-500 hover:text-primary"><span class="material-symbols-outlined">more_horiz</span></button>
</div>
<div class="flex-1 w-full flex items-end gap-1 sm:gap-3">
<div class="flex-1 flex flex-col justify-end items-center gap-2 group">
<div class="relative w-full max-w-[40px] h-[40%] bg-primary/20 dark:bg-primary/10 rounded-t-sm group-hover:bg-primary/30 transition-all">
<div class="absolute bottom-0 w-full h-[60%] bg-primary rounded-t-sm animate-bar" style="--target-height: 60%"></div>
</div>
<span class="text-xs text-gray-400">Jan</span>
</div>
<div class="flex-1 flex flex-col justify-end items-center gap-2 group">
<div class="relative w-full max-w-[40px] h-[55%] bg-primary/20 dark:bg-primary/10 rounded-t-sm group-hover:bg-primary/30 transition-all">
<div class="absolute bottom-0 w-full h-[70%] bg-primary rounded-t-sm animate-bar" style="--target-height: 70%"></div>
</div>
<span class="text-xs text-gray-400">Feb</span>
</div>
<div class="flex-1 flex flex-col justify-end items-center gap-2 group">
<div class="relative w-full max-w-[40px] h-[35%] bg-primary/20 dark:bg-primary/10 rounded-t-sm group-hover:bg-primary/30 transition-all">
<div class="absolute bottom-0 w-full h-[50%] bg-primary rounded-t-sm animate-bar" style="--target-height: 50%"></div>
</div>
<span class="text-xs text-gray-400">Mar</span>
</div>
<div class="flex-1 flex flex-col justify-end items-center gap-2 group">
<div class="relative w-full max-w-[40px] h-[65%] bg-primary/20 dark:bg-primary/10 rounded-t-sm group-hover:bg-primary/30 transition-all">
<div class="absolute bottom-0 w-full h-[80%] bg-primary rounded-t-sm animate-bar" style="--target-height: 80%"></div>
</div>
<span class="text-xs text-gray-400">Apr</span>
</div>
<div class="flex-1 flex flex-col justify-end items-center gap-2 group">
<div class="relative w-full max-w-[40px] h-[80%] bg-primary/20 dark:bg-primary/10 rounded-t-sm group-hover:bg-primary/30 transition-all">
<div class="absolute bottom-0 w-full h-[90%] bg-primary rounded-t-sm animate-bar" style="--target-height: 90%"></div>
</div>
<span class="text-xs text-gray-400">May</span>
</div>
<div class="flex-1 flex flex-col justify-end items-center gap-2 group">
<div class="relative w-full max-w-[40px] h-[75%] bg-primary/20 dark:bg-primary/10 rounded-t-sm group-hover:bg-primary/30 transition-all">
<div class="absolute bottom-0 w-full h-[85%] bg-primary rounded-t-sm animate-bar" style="--target-height: 85%"></div>
</div>
<span class="text-xs text-gray-400">Jun</span>
</div>
<div class="flex-1 flex flex-col justify-end items-center gap-2 group">
<div class="relative w-full max-w-[40px] h-[90%] bg-primary/20 dark:bg-primary/10 rounded-t-sm group-hover:bg-primary/30 transition-all">
<div class="absolute bottom-0 w-full h-[95%] bg-primary rounded-t-sm animate-bar" style="--target-height: 95%"></div>
</div>
<span class="text-xs text-gray-400">Jul</span>
</div>
</div>
</div>
</div>
</div>
<div class="content-products space-y-8">
<div class="bg-surface-light dark:bg-surface-dark p-4 rounded-xl border border-border-light dark:border-border-dark shadow-sm flex flex-col md:flex-row gap-4 justify-between items-center">
<div class="flex flex-col sm:flex-row gap-4 w-full md:w-auto">
<div class="relative">
<span class="material-symbols-outlined absolute left-3 top-2.5 text-gray-400 text-[20px]">search</span>
<input class="pl-10 pr-4 py-2 bg-background-light dark:bg-background-dark border-transparent rounded-lg text-sm focus:ring-1 focus:ring-primary w-full sm:w-64 text-gray-900 dark:text-white" placeholder="Search by Product ID, SKU..." type="text"/>
</div>
<select class="bg-background-light dark:bg-background-dark border-transparent rounded-lg text-sm px-4 py-2 focus:ring-1 focus:ring-primary text-gray-700 dark:text-gray-300">
<option>All Suppliers</option>
<option>TechDirect Inc.</option>
<option>Global Furnishings</option>
<option>Fashion Forward</option>
</select>
<select class="bg-background-light dark:bg-background-dark border-transparent rounded-lg text-sm px-4 py-2 focus:ring-1 focus:ring-primary text-gray-700 dark:text-gray-300">
<option>All Categories</option>
<option>Electronics</option>
<option>Furniture</option>
<option>Clothing</option>
</select>
</div>
<div class="flex gap-2 self-end md:self-auto">
<button class="flex items-center gap-2 px-4 py-2 bg-white dark:bg-surface-dark border border-gray-200 dark:border-border-dark rounded-lg text-sm font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-border-dark transition-colors">
<span class="material-symbols-outlined text-[18px]">download</span>
                Export CSV
            </button>
</div>
</div>
<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
<div class="bg-surface-light dark:bg-surface-dark p-5 rounded-xl border border-border-light dark:border-border-dark shadow-sm">
<div class="flex justify-between items-start mb-2">
<p class="text-sm font-medium text-gray-500 dark:text-gray-400">Total Product Revenue</p>
<div class="p-1.5 bg-primary/10 rounded-md text-primary">
<span class="material-symbols-outlined text-[20px]">attach_money</span>
</div>
</div>
<div class="flex items-end gap-2">
<h3 class="text-2xl font-bold text-gray-900 dark:text-white">$842,300</h3>
<span class="text-xs font-medium text-green-500 flex items-center mb-1">
<span class="material-symbols-outlined text-[14px]">trending_up</span> 14%
                </span>
</div>
</div>
<div class="bg-surface-light dark:bg-surface-dark p-5 rounded-xl border border-border-light dark:border-border-dark shadow-sm">
<div class="flex justify-between items-start mb-2">
<p class="text-sm font-medium text-gray-500 dark:text-gray-400">Units Sold</p>
<div class="p-1.5 bg-purple-500/10 rounded-md text-purple-500">
<span class="material-symbols-outlined text-[20px]">inventory_2</span>
</div>
</div>
<div class="flex items-end gap-2">
<h3 class="text-2xl font-bold text-gray-900 dark:text-white">12,450</h3>
<span class="text-xs font-medium text-green-500 flex items-center mb-1">
<span class="material-symbols-outlined text-[14px]">trending_up</span> 5.2%
                </span>
</div>
</div>
<div class="bg-surface-light dark:bg-surface-dark p-5 rounded-xl border border-border-light dark:border-border-dark shadow-sm">
<div class="flex justify-between items-start mb-2">
<p class="text-sm font-medium text-gray-500 dark:text-gray-400">Avg. Return Rate</p>
<div class="p-1.5 bg-orange-500/10 rounded-md text-orange-500">
<span class="material-symbols-outlined text-[20px]">keyboard_return</span>
</div>
</div>
<div class="flex items-end gap-2">
<h3 class="text-2xl font-bold text-gray-900 dark:text-white">2.8%</h3>
<span class="text-xs font-medium text-red-500 flex items-center mb-1">
<span class="material-symbols-outlined text-[14px]">trending_up</span> 0.3%
                </span>
</div>
</div>
<div class="bg-surface-light dark:bg-surface-dark p-5 rounded-xl border border-border-light dark:border-border-dark shadow-sm">
<div class="flex justify-between items-start mb-2">
<p class="text-sm font-medium text-gray-500 dark:text-gray-400">Active Listings</p>
<div class="p-1.5 bg-blue-500/10 rounded-md text-blue-500">
<span class="material-symbols-outlined text-[20px]">list_alt</span>
</div>
</div>
<div class="flex items-end gap-2">
<h3 class="text-2xl font-bold text-gray-900 dark:text-white">1,420</h3>
<span class="text-xs font-medium text-gray-500 flex items-center mb-1">
                    +12 New
                </span>
</div>
</div>
</div>
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
<div class="bg-surface-light dark:bg-surface-dark p-6 rounded-xl border border-border-light dark:border-border-dark shadow-sm h-80 flex flex-col">
<h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4">New Product Performance</h3>
<div class="flex-1 relative w-full h-full flex items-end justify-between px-2 gap-2">
<svg class="absolute inset-0 w-full h-full overflow-visible" preserveAspectRatio="none" viewBox="0 0 100 100">
<path d="M0,90 L20,70 L40,75 L60,40 L80,50 L100,20" fill="none" stroke="#137fec" stroke-width="2" vector-effect="non-scaling-stroke"></path>
<path d="M0,90 L20,70 L40,75 L60,40 L80,50 L100,20 V100 H0 Z" fill="url(#gradient-prod)" opacity="0.1" vector-effect="non-scaling-stroke"></path>
<defs>
<linearGradient id="gradient-prod" x1="0%" x2="0%" y1="0%" y2="100%">
<stop offset="0%" stop-color="#137fec" stop-opacity="1"></stop>
<stop offset="100%" stop-color="#137fec" stop-opacity="0"></stop>
</linearGradient>
</defs>
</svg>
<div class="absolute -bottom-6 w-full flex justify-between text-xs text-gray-400">
<span>Week 1</span><span>Week 2</span><span>Week 3</span><span>Week 4</span><span>Week 5</span><span>Week 6</span>
</div>
</div>
<div class="mt-6 text-center text-xs text-gray-500">Sales volume over the last 6 weeks for newly launched items</div>
</div>
<div class="bg-surface-light dark:bg-surface-dark p-6 rounded-xl border border-border-light dark:border-border-dark shadow-sm h-80 flex flex-col">
<h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4">Return Rate by Category</h3>
<div class="flex flex-col justify-center gap-4 flex-1">
<div>
<div class="flex justify-between text-xs mb-1">
<span class="text-gray-500 dark:text-gray-300">Electronics</span>
<span class="font-bold text-gray-900 dark:text-white">4.2%</span>
</div>
<div class="w-full bg-gray-100 dark:bg-gray-700 rounded-full h-2.5">
<div class="bg-red-400 h-2.5 rounded-full" style="width: 45%"></div>
</div>
</div>
<div>
<div class="flex justify-between text-xs mb-1">
<span class="text-gray-500 dark:text-gray-300">Fashion</span>
<span class="font-bold text-gray-900 dark:text-white">3.1%</span>
</div>
<div class="w-full bg-gray-100 dark:bg-gray-700 rounded-full h-2.5">
<div class="bg-orange-400 h-2.5 rounded-full" style="width: 35%"></div>
</div>
</div>
<div>
<div class="flex justify-between text-xs mb-1">
<span class="text-gray-500 dark:text-gray-300">Home &amp; Garden</span>
<span class="font-bold text-gray-900 dark:text-white">1.5%</span>
</div>
<div class="w-full bg-gray-100 dark:bg-gray-700 rounded-full h-2.5">
<div class="bg-yellow-400 h-2.5 rounded-full" style="width: 15%"></div>
</div>
</div>
<div>
<div class="flex justify-between text-xs mb-1">
<span class="text-gray-500 dark:text-gray-300">Sports</span>
<span class="font-bold text-gray-900 dark:text-white">0.8%</span>
</div>
<div class="w-full bg-gray-100 dark:bg-gray-700 rounded-full h-2.5">
<div class="bg-green-400 h-2.5 rounded-full" style="width: 8%"></div>
</div>
</div>
</div>
</div>
</div>
<div class="bg-surface-light dark:bg-surface-dark p-6 rounded-xl border border-border-light dark:border-border-dark shadow-sm">
<div class="flex justify-between items-center mb-6">
<h3 class="text-lg font-bold text-gray-900 dark:text-white">Product Stock Levels</h3>
<div class="flex gap-4">
<div class="flex items-center gap-2 text-xs">
<span class="w-3 h-3 bg-primary rounded-sm"></span> Current Stock
                </div>
<div class="flex items-center gap-2 text-xs">
<span class="w-3 h-3 bg-gray-300 dark:bg-gray-600 rounded-sm"></span> Safety Level
                </div>
</div>
</div>
<div class="h-48 w-full flex items-end justify-between gap-2 sm:gap-4 px-2">
<div class="flex flex-col items-center gap-2 flex-1 group">
<div class="w-full max-w-[40px] bg-gray-100 dark:bg-gray-700 rounded-t-sm h-full relative overflow-hidden">
<div class="absolute bottom-0 w-full bg-primary transition-all duration-500" style="height: 80%"></div>
<div class="absolute bottom-[40%] w-full h-[2px] bg-red-500 z-10 border-t border-dashed border-red-500"></div>
</div>
<span class="text-xs text-gray-500 truncate w-full text-center">Prod A</span>
</div>
<div class="flex flex-col items-center gap-2 flex-1 group">
<div class="w-full max-w-[40px] bg-gray-100 dark:bg-gray-700 rounded-t-sm h-full relative overflow-hidden">
<div class="absolute bottom-0 w-full bg-primary transition-all duration-500" style="height: 30%"></div>
</div>
<span class="text-xs text-gray-500 truncate w-full text-center">Prod B</span>
</div>
<div class="flex flex-col items-center gap-2 flex-1 group">
<div class="w-full max-w-[40px] bg-gray-100 dark:bg-gray-700 rounded-t-sm h-full relative overflow-hidden">
<div class="absolute bottom-0 w-full bg-primary transition-all duration-500" style="height: 65%"></div>
</div>
<span class="text-xs text-gray-500 truncate w-full text-center">Prod C</span>
</div>
<div class="flex flex-col items-center gap-2 flex-1 group">
<div class="w-full max-w-[40px] bg-gray-100 dark:bg-gray-700 rounded-t-sm h-full relative overflow-hidden">
<div class="absolute bottom-0 w-full bg-primary transition-all duration-500" style="height: 90%"></div>
</div>
<span class="text-xs text-gray-500 truncate w-full text-center">Prod D</span>
</div>
<div class="flex flex-col items-center gap-2 flex-1 group">
<div class="w-full max-w-[40px] bg-gray-100 dark:bg-gray-700 rounded-t-sm h-full relative overflow-hidden">
<div class="absolute bottom-0 w-full bg-yellow-400 transition-all duration-500" style="height: 15%"></div>
</div>
<span class="text-xs text-gray-500 truncate w-full text-center">Prod E</span>
</div>
<div class="flex flex-col items-center gap-2 flex-1 group">
<div class="w-full max-w-[40px] bg-gray-100 dark:bg-gray-700 rounded-t-sm h-full relative overflow-hidden">
<div class="absolute bottom-0 w-full bg-primary transition-all duration-500" style="height: 55%"></div>
</div>
<span class="text-xs text-gray-500 truncate w-full text-center">Prod F</span>
</div>
<div class="flex flex-col items-center gap-2 flex-1 group">
<div class="w-full max-w-[40px] bg-gray-100 dark:bg-gray-700 rounded-t-sm h-full relative overflow-hidden">
<div class="absolute bottom-0 w-full bg-red-500 transition-all duration-500" style="height: 5%"></div>
</div>
<span class="text-xs text-gray-500 truncate w-full text-center">Prod G</span>
</div>
</div>
</div>
<div class="bg-surface-light dark:bg-surface-dark rounded-xl border border-border-light dark:border-border-dark shadow-sm overflow-hidden">
<div class="p-6 border-b border-border-light dark:border-border-dark">
<h3 class="text-lg font-bold text-gray-900 dark:text-white">Top Products by Revenue</h3>
</div>
<div class="overflow-x-auto">
<table class="w-full text-left border-collapse">
<thead class="bg-gray-50 dark:bg-surface-dark/50 text-xs text-gray-500 uppercase">
<tr>
<th class="px-6 py-3 font-medium">Product Details</th>
<th class="px-6 py-3 font-medium">SKU</th>
<th class="px-6 py-3 font-medium">Units Sold</th>
<th class="px-6 py-3 font-medium">Revenue</th>
<th class="px-6 py-3 font-medium">Stock Level</th>
<th class="px-6 py-3 font-medium text-right">Trend</th>
</tr>
</thead>
<tbody class="text-sm divide-y divide-border-light dark:divide-border-dark">
<tr class="hover:bg-gray-50 dark:hover:bg-border-dark/30 transition-colors">
<td class="px-6 py-4 font-medium text-gray-900 dark:text-white flex items-center gap-3">
<div class="size-10 rounded bg-gray-200 dark:bg-gray-700"></div>
<div>
<div class="font-bold">Headphones Pro Max</div>
<div class="text-xs text-gray-500">Electronics</div>
</div>
</td>
<td class="px-6 py-4 text-gray-500 dark:text-gray-400">#SKU-8821</td>
<td class="px-6 py-4 text-gray-900 dark:text-white">1,240</td>
<td class="px-6 py-4 text-gray-900 dark:text-white font-medium">$370,760</td>
<td class="px-6 py-4">
<div class="flex items-center gap-2">
<div class="w-16 h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
<div class="h-full bg-green-500 w-[80%]"></div>
</div>
<span class="text-xs text-gray-500">450</span>
</div>
</td>
<td class="px-6 py-4 text-right text-green-500 font-medium">+12%</td>
</tr>
<tr class="hover:bg-gray-50 dark:hover:bg-border-dark/30 transition-colors">
<td class="px-6 py-4 font-medium text-gray-900 dark:text-white flex items-center gap-3">
<div class="size-10 rounded bg-gray-200 dark:bg-gray-700"></div>
<div>
<div class="font-bold">Ergo Office Chair</div>
<div class="text-xs text-gray-500">Furniture</div>
</div>
</td>
<td class="px-6 py-4 text-gray-500 dark:text-gray-400">#SKU-1029</td>
<td class="px-6 py-4 text-gray-900 dark:text-white">850</td>
<td class="px-6 py-4 text-gray-900 dark:text-white font-medium">$126,650</td>
<td class="px-6 py-4">
<div class="flex items-center gap-2">
<div class="w-16 h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
<div class="h-full bg-yellow-500 w-[20%]"></div>
</div>
<span class="text-xs text-gray-500">12</span>
</div>
</td>
<td class="px-6 py-4 text-right text-green-500 font-medium">+5%</td>
</tr>
<tr class="hover:bg-gray-50 dark:hover:bg-border-dark/30 transition-colors">
<td class="px-6 py-4 font-medium text-gray-900 dark:text-white flex items-center gap-3">
<div class="size-10 rounded bg-gray-200 dark:bg-gray-700"></div>
<div>
<div class="font-bold">Smart Watch V3</div>
<div class="text-xs text-gray-500">Electronics</div>
</div>
</td>
<td class="px-6 py-4 text-gray-500 dark:text-gray-400">#SKU-4402</td>
<td class="px-6 py-4 text-gray-900 dark:text-white">620</td>
<td class="px-6 py-4 text-gray-900 dark:text-white font-medium">$123,380</td>
<td class="px-6 py-4">
<div class="flex items-center gap-2">
<div class="w-16 h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
<div class="h-full bg-red-500 w-[0%]"></div>
</div>
<span class="text-xs text-red-500">0</span>
</div>
</td>
<td class="px-6 py-4 text-right text-red-500 font-medium">-2%</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div class="content-customers space-y-8">
<div class="bg-surface-light dark:bg-surface-dark p-4 rounded-xl border border-border-light dark:border-border-dark shadow-sm flex flex-col md:flex-row gap-4 justify-between items-center">
<div class="flex flex-col sm:flex-row gap-4 w-full md:w-auto">
<div class="relative">
<span class="material-symbols-outlined absolute left-3 top-2.5 text-gray-400 text-[20px]">search</span>
<input class="pl-10 pr-4 py-2 bg-background-light dark:bg-background-dark border-transparent rounded-lg text-sm focus:ring-1 focus:ring-primary w-full sm:w-64 text-gray-900 dark:text-white" placeholder="Search by Customer ID, Name..." type="text"/>
</div>
<select class="bg-background-light dark:bg-background-dark border-transparent rounded-lg text-sm px-4 py-2 focus:ring-1 focus:ring-primary text-gray-700 dark:text-gray-300">
<option>All Age Groups</option>
<option>18-24</option>
<option>25-34</option>
<option>35-44</option>
<option>45+</option>
</select>
<select class="bg-background-light dark:bg-background-dark border-transparent rounded-lg text-sm px-4 py-2 focus:ring-1 focus:ring-primary text-gray-700 dark:text-gray-300">
<option>All Locations</option>
<option>North America</option>
<option>Europe</option>
<option>Asia</option>
</select>
<select class="bg-background-light dark:bg-background-dark border-transparent rounded-lg text-sm px-4 py-2 focus:ring-1 focus:ring-primary text-gray-700 dark:text-gray-300">
<option>Last Purchase Date</option>
<option>Last 7 Days</option>
<option>Last 30 Days</option>
<option>Last 3 Months</option>
</select>
</div>
<div class="flex gap-2 self-end md:self-auto">
<button class="flex items-center gap-2 px-4 py-2 bg-white dark:bg-surface-dark border border-gray-200 dark:border-border-dark rounded-lg text-sm font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-border-dark transition-colors">
<span class="material-symbols-outlined text-[18px]">download</span>
                    Export Customer Data
                </button>
</div>
</div>
<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4">
<div class="bg-surface-light dark:bg-surface-dark p-5 rounded-xl border border-border-light dark:border-border-dark shadow-sm">
<div class="flex justify-between items-start mb-2">
<p class="text-sm font-medium text-gray-500 dark:text-gray-400">Total Customers</p>
<div class="p-1.5 bg-blue-500/10 rounded-md text-blue-500">
<span class="material-symbols-outlined text-[20px]">groups</span>
</div>
</div>
<div class="flex items-end gap-2">
<h3 class="text-2xl font-bold text-gray-900 dark:text-white">12,450</h3>
<span class="text-xs font-medium text-green-500 flex items-center mb-1">
<span class="material-symbols-outlined text-[14px]">trending_up</span> +5.2%
                    </span>
</div>
</div>
<div class="bg-surface-light dark:bg-surface-dark p-5 rounded-xl border border-border-light dark:border-border-dark shadow-sm">
<div class="flex justify-between items-start mb-2">
<p class="text-sm font-medium text-gray-500 dark:text-gray-400">New This Month</p>
<div class="p-1.5 bg-green-500/10 rounded-md text-green-500">
<span class="material-symbols-outlined text-[20px]">person_add</span>
</div>
</div>
<div class="flex items-end gap-2">
<h3 class="text-2xl font-bold text-gray-900 dark:text-white">450</h3>
<span class="text-xs font-medium text-green-500 flex items-center mb-1">
<span class="material-symbols-outlined text-[14px]">trending_up</span> +12%
                    </span>
</div>
</div>
<div class="bg-surface-light dark:bg-surface-dark p-5 rounded-xl border border-border-light dark:border-border-dark shadow-sm">
<div class="flex justify-between items-start mb-2">
<p class="text-sm font-medium text-gray-500 dark:text-gray-400">Returning Rate</p>
<div class="p-1.5 bg-purple-500/10 rounded-md text-purple-500">
<span class="material-symbols-outlined text-[20px]">replay</span>
</div>
</div>
<div class="flex items-end gap-2">
<h3 class="text-2xl font-bold text-gray-900 dark:text-white">35%</h3>
<span class="text-xs font-medium text-gray-500 dark:text-gray-400 flex items-center mb-1">
                        +2%
                    </span>
</div>
</div>
<div class="bg-surface-light dark:bg-surface-dark p-5 rounded-xl border border-border-light dark:border-border-dark shadow-sm">
<div class="flex justify-between items-start mb-2">
<p class="text-sm font-medium text-gray-500 dark:text-gray-400">Lifetime Value</p>
<div class="p-1.5 bg-orange-500/10 rounded-md text-orange-500">
<span class="material-symbols-outlined text-[20px]">savings</span>
</div>
</div>
<div class="flex items-end gap-2">
<h3 class="text-2xl font-bold text-gray-900 dark:text-white">$850</h3>
<span class="text-xs font-medium text-green-500 flex items-center mb-1">
<span class="material-symbols-outlined text-[14px]">trending_up</span> +5%
                    </span>
</div>
</div>
<div class="bg-surface-light dark:bg-surface-dark p-5 rounded-xl border border-border-light dark:border-border-dark shadow-sm">
<div class="flex justify-between items-start mb-2">
<p class="text-sm font-medium text-gray-500 dark:text-gray-400">Avg Order Value</p>
<div class="p-1.5 bg-pink-500/10 rounded-md text-pink-500">
<span class="material-symbols-outlined text-[20px]">shopping_bag</span>
</div>
</div>
<div class="flex items-end gap-2">
<h3 class="text-2xl font-bold text-gray-900 dark:text-white">$120</h3>
<span class="text-xs font-medium text-red-500 flex items-center mb-1">
<span class="material-symbols-outlined text-[14px]">trending_down</span> -1%
                    </span>
</div>
</div>
</div>
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
<div class="lg:col-span-2 bg-surface-light dark:bg-surface-dark p-6 rounded-xl border border-border-light dark:border-border-dark shadow-sm h-80 flex flex-col">
<div class="flex justify-between items-center mb-4">
<h3 class="text-lg font-bold text-gray-900 dark:text-white">CAC vs CLTV Analysis</h3>
<div class="flex items-center gap-4 text-xs">
<div class="flex items-center gap-1">
<span class="w-3 h-3 rounded-sm bg-primary"></span>
<span class="text-gray-500 dark:text-gray-400">CLTV</span>
</div>
<div class="flex items-center gap-1">
<span class="w-3 h-3 rounded-sm bg-red-400"></span>
<span class="text-gray-500 dark:text-gray-400">CAC</span>
</div>
</div>
</div>
<div class="flex-1 w-full flex items-end justify-between gap-4 px-2">
<div class="flex flex-col items-center gap-2 flex-1 group">
<div class="w-full flex gap-1 items-end justify-center h-full">
<div class="w-3 bg-red-400 rounded-t-sm h-[30%]"></div>
<div class="w-3 bg-primary rounded-t-sm h-[70%]"></div>
</div>
<span class="text-xs text-gray-500">Q1</span>
</div>
<div class="flex flex-col items-center gap-2 flex-1 group">
<div class="w-full flex gap-1 items-end justify-center h-full">
<div class="w-3 bg-red-400 rounded-t-sm h-[32%]"></div>
<div class="w-3 bg-primary rounded-t-sm h-[72%]"></div>
</div>
<span class="text-xs text-gray-500">Q2</span>
</div>
<div class="flex flex-col items-center gap-2 flex-1 group">
<div class="w-full flex gap-1 items-end justify-center h-full">
<div class="w-3 bg-red-400 rounded-t-sm h-[28%]"></div>
<div class="w-3 bg-primary rounded-t-sm h-[75%]"></div>
</div>
<span class="text-xs text-gray-500">Q3</span>
</div>
<div class="flex flex-col items-center gap-2 flex-1 group">
<div class="w-full flex gap-1 items-end justify-center h-full">
<div class="w-3 bg-red-400 rounded-t-sm h-[25%]"></div>
<div class="w-3 bg-primary rounded-t-sm h-[80%]"></div>
</div>
<span class="text-xs text-gray-500">Q4</span>
</div>
</div>
</div>
<div class="bg-surface-light dark:bg-surface-dark p-6 rounded-xl border border-border-light dark:border-border-dark shadow-sm h-80 flex flex-col">
<h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4">Churn Rate</h3>
<div class="flex-1 flex flex-col items-center justify-center relative">
<svg class="transform -rotate-90 w-40 h-40" viewBox="0 0 100 100">
<circle class="text-gray-200 dark:text-gray-700" cx="50" cy="50" fill="transparent" r="40" stroke="currentColor" stroke-width="10"></circle>
<circle class="text-red-500" cx="50" cy="50" fill="transparent" r="40" stroke="currentColor" stroke-dasharray="251.2" stroke-dashoffset="230" stroke-linecap="round" stroke-width="10"></circle>
</svg>
<div class="absolute inset-0 flex flex-col items-center justify-center">
<span class="text-3xl font-bold text-gray-900 dark:text-white">8.5%</span>
<span class="text-xs text-gray-500">This Month</span>
</div>
</div>
<div class="text-center text-xs text-gray-500 mt-2">
                    2.1% lower than last month
                </div>
</div>
</div>
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
<div class="bg-surface-light dark:bg-surface-dark p-6 rounded-xl border border-border-light dark:border-border-dark shadow-sm">
<h3 class="text-lg font-bold text-gray-900 dark:text-white mb-6">Customer Segmentation</h3>
<div class="flex flex-col gap-4">
<div class="space-y-2">
<div class="flex justify-between text-xs items-center">
<span class="text-gray-500 dark:text-gray-400">Loyal Customers (Tier 1)</span>
<span class="text-gray-900 dark:text-white font-medium">45%</span>
</div>
<div class="h-2 w-full bg-gray-100 dark:bg-gray-700 rounded-full overflow-hidden">
<div class="h-full bg-primary rounded-full" style="width: 45%"></div>
</div>
</div>
<div class="space-y-2">
<div class="flex justify-between text-xs items-center">
<span class="text-gray-500 dark:text-gray-400">Occasional Buyers (Tier 2)</span>
<span class="text-gray-900 dark:text-white font-medium">30%</span>
</div>
<div class="h-2 w-full bg-gray-100 dark:bg-gray-700 rounded-full overflow-hidden">
<div class="h-full bg-blue-400 rounded-full" style="width: 30%"></div>
</div>
</div>
<div class="space-y-2">
<div class="flex justify-between text-xs items-center">
<span class="text-gray-500 dark:text-gray-400">New Customers (Tier 3)</span>
<span class="text-gray-900 dark:text-white font-medium">25%</span>
</div>
<div class="h-2 w-full bg-gray-100 dark:bg-gray-700 rounded-full overflow-hidden">
<div class="h-full bg-purple-400 rounded-full" style="width: 25%"></div>
</div>
</div>
</div>
</div>
<div class="bg-surface-light dark:bg-surface-dark p-6 rounded-xl border border-border-light dark:border-border-dark shadow-sm">
<h3 class="text-lg font-bold text-gray-900 dark:text-white mb-6">Feedback &amp; Satisfaction Trends</h3>
<div class="space-y-4">
<div class="flex items-center gap-4">
<div class="p-3 bg-green-100 dark:bg-green-900/30 rounded-lg text-green-600 dark:text-green-400">
<span class="material-symbols-outlined">sentiment_very_satisfied</span>
</div>
<div class="flex-1">
<div class="flex justify-between mb-1">
<span class="text-sm font-medium text-gray-900 dark:text-white">Positive Feedback</span>
<span class="text-sm text-gray-500">68%</span>
</div>
<div class="h-1.5 w-full bg-gray-100 dark:bg-gray-700 rounded-full">
<div class="h-full bg-green-500 rounded-full" style="width: 68%"></div>
</div>
</div>
</div>
<div class="flex items-center gap-4">
<div class="p-3 bg-yellow-100 dark:bg-yellow-900/30 rounded-lg text-yellow-600 dark:text-yellow-400">
<span class="material-symbols-outlined">sentiment_neutral</span>
</div>
<div class="flex-1">
<div class="flex justify-between mb-1">
<span class="text-sm font-medium text-gray-900 dark:text-white">Neutral Feedback</span>
<span class="text-sm text-gray-500">22%</span>
</div>
<div class="h-1.5 w-full bg-gray-100 dark:bg-gray-700 rounded-full">
<div class="h-full bg-yellow-500 rounded-full" style="width: 22%"></div>
</div>
</div>
</div>
<div class="flex items-center gap-4">
<div class="p-3 bg-red-100 dark:bg-red-900/30 rounded-lg text-red-600 dark:text-red-400">
<span class="material-symbols-outlined">sentiment_dissatisfied</span>
</div>
<div class="flex-1">
<div class="flex justify-between mb-1">
<span class="text-sm font-medium text-gray-900 dark:text-white">Negative Feedback</span>
<span class="text-sm text-gray-500">10%</span>
</div>
<div class="h-1.5 w-full bg-gray-100 dark:bg-gray-700 rounded-full">
<div class="h-full bg-red-500 rounded-full" style="width: 10%"></div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
</div>
<div
  x-data="{
    reviewModalOpen: false,
    selectedReview: null
  }"
>
<div
  x-show="activeView === 'reviews'"
  x-cloak
  x-transition.opacity.duration.300ms
  x-data="adminReviews()"
  x-init="loadReviews()"
  class="space-y-6 animate-fade-in"
>

  <!-- TABLE -->
  <div class="bg-accent/30 dark:bg-secondary/30 rounded-2xl border border-bronze/10 dark:border-primary/10 overflow-hidden shadow-xl">

    <div class="overflow-x-auto">
      <table class="w-full text-left border-collapse">

        <thead>
          <tr class="bg-bronze/5 dark:bg-primary/5 text-xs font-bold uppercase tracking-wider">
            <th class="px-6 py-4">User</th>
            <th class="px-6 py-4">Product</th>
            <th class="px-6 py-4">Rating</th>
            <th class="px-6 py-4">Review</th>
            <th class="px-6 py-4">Featured</th>
            <th class="px-6 py-4 text-center">Actions</th>
          </tr>
        </thead>

        <tbody class="divide-y divide-bronze/5 dark:divide-primary/5">

          <template x-for="item in reviews" :key="item.review._id">
            <tr class="glass-row group">

              <!-- USER -->
              <td class="px-6 py-4">
  <div class="flex items-center gap-3">
    <img
      :src="item.userAvatar"
      class="w-10 h-10 rounded-full object-cover border border-bronze/20"
    />
    <span class="font-semibold text-sm" x-text="item.userName"></span>
  </div>
</td>

              <!-- PRODUCT -->
              <td class="px-6 py-4 text-sm" x-text="item.product.name"></td>

              <!-- RATING -->
              <td class="px-6 py-4">
                <div class="flex text-primary">
                  <template x-for="i in 5">
  <span
    class="material-symbols-outlined text-sm"
    :class="item.review.rating >= i ? 'filled text-primary' : 'text-gray-400'"
  >star</span>
</template>

                </div>
              </td>

              <!-- COMMENT -->
              <td class="px-6 py-4 text-sm max-w-xs truncate"
                  x-text="item.review.comment || '(no comment)'">
              </td>

              <!-- FEATURED -->
              <td class="px-6 py-4 text-center">
  <button
    @click="toggleFeatured(item)"
    class="p-2 rounded-full transition-all
           hover:scale-110 active:scale-95"
    :title="item.review.featured ? 'Unfeature review' : 'Feature review'"
  >
    <span
      class="material-symbols-outlined text-xl"
      :class="item.review.featured
        ? 'text-primary filled drop-shadow-[0_0_8px_rgba(200,155,63,0.6)]'
        : 'text-gray-400'"
    >
      check_circle
    </span>
  </button>
</td>


              <!-- ACTIONS -->
              <td class="px-6 py-4">
                <div class="flex justify-center gap-2">

                  <button
                    @click="openModal(item)"
                    class="p-2 rounded-lg bg-bronze/10 dark:bg-primary/10
                           text-bronze dark:text-primary
                           hover:bg-bronze dark:hover:bg-primary
                           hover:text-white dark:hover:text-secondary
                           transition-colors"
                    title="Reply"
                  >
                    <span class="material-symbols-outlined text-lg">chat</span>
                  </button>
                  <button
  @click="deleteReview(item)"
  class="p-2 rounded-lg bg-danger/10
         text-danger
         hover:bg-danger hover:text-white
         transition-colors"
  title="Delete Review"
>
  <span class="material-symbols-outlined text-lg">delete</span>
</button>

                </div>
              </td>

            </tr>
          </template>

        </tbody>

      </table>
    </div>
  </div>

  <!-- REPLY MODAL -->
  <div
    x-show="modalOpen"
    x-cloak
    class="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm"
  >
    <div
      @click.outside="modalOpen = false"
      class="bg-light-bg dark:bg-dark-bg w-full max-w-lg max-h-[90vh]
             rounded-2xl shadow-2xl border border-bronze/20
             dark:border-primary/20 overflow-hidden flex flex-col"
    >

      <!-- HEADER -->
      <div class="p-6 border-b border-bronze/10 dark:border-primary/10
                  flex items-center justify-between bg-accent dark:bg-secondary">
        <h3 class="font-display font-bold text-xl text-bronze dark:text-primary">
          Review Details
        </h3>
        <button
          @click="modalOpen = false"
          class="text-light-text/60 dark:text-dark-text/60 hover:text-danger"
        >
          <span class="material-symbols-outlined">close</span>
        </button>
      </div>

      <!-- BODY -->
      <div class="p-8 space-y-6 overflow-y-auto">

        <div class="flex items-center gap-4">
          <img
  :src="selected?.userAvatar"
  alt="Reviewer"
  class="w-16 h-16 rounded-full object-cover border-2 border-primary shadow-lg"
/>

          <div>
            <h4 class="font-bold text-lg" x-text="selected?.userName"></h4>
            <div class="flex text-primary">
              <template x-for="i in [1,2,3,4,5]" :key="i">
  <span
    class="material-symbols-outlined"
    :class="Number(selected?.review?.rating) >= i 
      ? 'filled text-primary' 
      : 'text-primary/30'"
  >
    star
  </span>
</template>


            </div>
          </div>
        </div>

        <div>
          <span class="text-[10px] font-bold uppercase tracking-widest
                       text-bronze/60 dark:text-primary/60">
            Product Reviewed
          </span>
          <p class="font-medium" x-text="selected?.product.name"></p>
        </div>

        <div
          class="p-4 bg-bronze/5 dark:bg-primary/5 rounded-xl
                 italic text-light-text/80 dark:text-dark-text/80
                 text-sm leading-relaxed border-l-4 border-primary"
        >
          "<span x-text="selected?.review.comment"></span>"
        </div>

        <!-- ADMIN REPLY -->
        <div class="space-y-3 pt-4">
          <label
            class="text-xs font-bold uppercase tracking-wider
                   text-light-text/60 dark:text-dark-text/60"
          >
            Reply to User
          </label>

          <textarea
            x-model="replyText"
            class="w-full h-24 p-4 bg-accent/50 dark:bg-secondary/50
                   border border-bronze/20 dark:border-primary/20
                   rounded-xl text-sm focus:border-primary
                   outline-none transition-all"
            placeholder="Type your response here..."
          ></textarea>
        </div>

      </div>

      <!-- FOOTER -->
      <div
        class="px-8 py-5 bg-accent/80 dark:bg-secondary/80
               border-t border-bronze/10 dark:border-primary/10
               flex justify-end gap-3"
      >
        <button
          @click="modalOpen = false"
          class="px-6 py-2 text-sm font-bold
                 text-light-text/60 dark:text-dark-text/60
                 hover:text-danger transition-colors"
        >
          Dismiss
        </button>

        <button
          @click="saveReply()"
          class="px-8 py-2 rounded-full bg-bronze
                 dark:bg-primary text-white dark:text-secondary
                 text-sm font-bold shadow-lg hover:opacity-90 transition-all"
        >
          Send Reply &amp; Approve
        </button>
      </div>

    </div>
  </div>

</div>



<script>
function adminReviews() {
  return {
    reviews: [],
    modalOpen: false,
    selected: null,
    replyText: "",

    async loadReviews() {
      const token = localStorage.getItem("token");

      const res = await fetch(
        "https://perfume-store-production.up.railway.app/api/products/admin/reviews",
        {
          headers: { Authorization: `Bearer ${token}` }
        }
      );

      const data = await res.json();
      this.reviews = data.reviews || [];
    },

    openModal(item) {
      this.selected = item;
      this.replyText = item.review.adminReply || "";
      this.modalOpen = true;
    },
    async deleteReview(item) {
  if (!confirm("Are you sure you want to delete this review?")) return;

  const token = localStorage.getItem("token");

  const res = await fetch(
    `https://perfume-store-production.up.railway.app/api/products/${item.product._id}/reviews/${item.review._id}`,
    {
      method: "DELETE",
      headers: {
        Authorization: `Bearer ${token}`
      }
    }
  );

  if (!res.ok) {
    alert("Failed to delete review");
    return;
  }

  // 🔥 Remove from UI instantly
  this.reviews = this.reviews.filter(
    r => r.review._id !== item.review._id
  );
},
    async saveReply() {
      const token = localStorage.getItem("token");

      const res = await fetch(
        `https://perfume-store-production.up.railway.app/api/products/${this.selected.product._id}/reviews/${this.selected.review._id}/reply`,
        {
          method: "PATCH",
          headers: {
            "Content-Type": "application/json",
            Authorization: `Bearer ${token}`
          },
          body: JSON.stringify({
            adminReply: this.replyText,
            featured: this.selected.review.featured
          })
        }
      );

      if (!res.ok) {
        alert("Failed to save reply");
        return;
      }

      this.selected.review.adminReply = this.replyText;
      this.modalOpen = false;
    },

    async toggleFeatured(item) {
      const token = localStorage.getItem("token");

      await fetch(
        `https://perfume-store-production.up.railway.app/api/products/${item.product._id}/reviews/${item.review._id}/reply`,
        {
          method: "PATCH",
          headers: {
            "Content-Type": "application/json",
            Authorization: `Bearer ${token}`
          },
          body: JSON.stringify({
            adminReply: item.review.adminReply,
            featured: !item.review.featured
          })
        }
      );

      item.review.featured = !item.review.featured;
    }
  };
}
</script>




</div>



<!--chat-->

<div
  x-data="{
    chatFilter: 'all',
    selectedChat: 1
  }"
>
<div class="flex flex-1 overflow-hidden" x-show="activeView === 'messages'">
<div class="w-full md:w-80 xl:w-96 flex flex-col border-r border-bronze/10 dark:border-primary/10 bg-accent/30 dark:bg-secondary/20">
<div class="p-4 space-y-4">
<div class="relative">
<span class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-light-text/50 dark:text-dark-text/50">search</span>
<input class="w-full pl-10 pr-4 py-2.5 text-sm bg-white dark:bg-secondary border border-bronze/20 dark:border-primary/20 rounded-xl focus:ring-primary focus:border-primary" placeholder="Search inquiries..." type="text"/>
</div>
<div class="flex items-center justify-between p-1 bg-white dark:bg-secondary rounded-lg border border-bronze/10 dark:border-primary/10">
<button :class="chatFilter === 'all' ? 'bg-bronze/10 dark:bg-primary/10 text-bronze dark:text-primary' : 'text-light-text/60 dark:text-dark-text/60'" @click="chatFilter = 'all'" class="flex-1 py-1.5 text-xs font-semibold rounded-md transition-all">All</button>
<button :class="chatFilter === 'unread' ? 'bg-bronze/10 dark:bg-primary/10 text-bronze dark:text-primary' : 'text-light-text/60 dark:text-dark-text/60'" @click="chatFilter = 'unread'" class="flex-1 py-1.5 text-xs font-semibold rounded-md transition-all">Unread</button>
<button :class="chatFilter === 'replied' ? 'bg-bronze/10 dark:bg-primary/10 text-bronze dark:text-primary' : 'text-light-text/60 dark:text-dark-text/60'" @click="chatFilter = 'replied'" class="flex-1 py-1.5 text-xs font-semibold rounded-md transition-all">Replied</button>
<button :class="chatFilter === 'closed' ? 'bg-bronze/10 dark:bg-primary/10 text-bronze dark:text-primary' : 'text-light-text/60 dark:text-dark-text/60'" @click="chatFilter = 'closed'" class="flex-1 py-1.5 text-xs font-semibold rounded-md transition-all">Closed</button>
</div>
</div>
<div class="flex-1 overflow-y-auto custom-scrollbar">
  <div :class="selectedChat === 1 ? 'bg-bronze/5 dark:bg-primary/5 border-r-4 border-bronze dark:border-primary' : 'hover:bg-accent/50 dark:hover:bg-secondary/40'" @click="selectedChat = 1" class="p-4 cursor-pointer transition-all border-b border-bronze/5 dark:border-primary/5">
<div class="flex items-center space-x-3">
<div class="relative">
<img alt="User" class="h-12 w-12 rounded-full object-cover border border-bronze/20 dark:border-primary/20" src="https://lh3.googleusercontent.com/aida-public/AB6AXuA1tC8N7ojmPi4Y1HymLA5Qp3fIYVYoXM1oVJStvcNZfExzvN1dcDwc5UbYaiyAZB2xJS_NpTu12fBgT346KZ3BCKwWiQ05Tz0thHvNrJGZYkIoqAwxNKTJ0cTvt8TFvqV6AzF7Mry0vIaKW04cnbMAmy-Mz9URu6wnIIPLF7FVM-ucMcYEjPuyvOrwy4-t3WIFkUVjL81hArhjlDiNENZNiD66OtI17lI0-L-KkdghyiBSAnYvU4cEm59zglviwYJRWzhIv_FH2bam"/>
<span class="absolute top-0 right-0 h-3 w-3 rounded-full bg-primary ring-2 ring-light-bg dark:ring-dark-bg"></span>
</div>
<div class="flex-1 min-w-0">
<div class="flex items-center justify-between">
<h4 class="font-semibold text-sm truncate">Aaliyah Al-Farsi</h4>
<span class="text-[10px] text-light-text/50 dark:text-dark-text/50">12:45 PM</span>
</div>
<p class="text-xs text-light-text/70 dark:text-dark-text/70 truncate mt-0.5">I haven't received my order HA-91256 yet. Can you check?</p>
</div>
</div>
</div>
<div :class="selectedChat === 2 ? 'bg-bronze/5 dark:bg-primary/5 border-r-4 border-bronze dark:border-primary' : 'hover:bg-accent/50 dark:hover:bg-secondary/40'" @click="selectedChat = 2" class="p-4 cursor-pointer transition-all border-b border-bronze/5 dark:border-primary/5">
<div class="flex items-center space-x-3">
<img alt="User" class="h-12 w-12 rounded-full object-cover border border-bronze/20 dark:border-primary/20" src="https://lh3.googleusercontent.com/aida-public/AB6AXuAdyC713X5a0466GQ4sDDXvIOeEar5nf-DPKnEz7LpONE9RjMHLRaHXWtm_efnP6-MdfP6NGnY8qGcVFGOlJIWEf6gFr9clp-b_SulT3QC_IGrp4F0XRYX2c0z2XeHuTlLvornz10NbhSNClmHzIhG6Sh7He7XhzBS9OjEFhcYYRLaSYLi-36iKGfq_yfSqMv9PnKBPV7PV-jGizZExhe4pX4_teiQwlVnCxI5JyUibvm8CJ9iBHX54734Udh9-L-GPIGfZdZUtoIlv"/>
<div class="flex-1 min-w-0">
<div class="flex items-center justify-between">
<h4 class="font-semibold text-sm truncate">Yusuf Khan</h4>
<span class="text-[10px] text-light-text/50 dark:text-dark-text/50">Yesterday</span>
</div>
<p class="text-xs text-light-text/70 dark:text-dark-text/70 truncate mt-0.5">The Oud Al-Amir is spectacular. Do you have wholesale pricing?</p>
</div>
</div>
</div>
<div :class="selectedChat === 3 ? 'bg-bronze/5 dark:bg-primary/5 border-r-4 border-bronze dark:border-primary' : 'hover:bg-accent/50 dark:hover:bg-secondary/40'" @click="selectedChat = 3" class="p-4 cursor-pointer transition-all border-b border-bronze/5 dark:border-primary/5">
<div class="flex items-center space-x-3">
<img alt="User" class="h-12 w-12 rounded-full object-cover border border-bronze/20 dark:border-primary/20" src="https://lh3.googleusercontent.com/aida-public/AB6AXuDKkwSvPS8BAIG9ardblIa1qxwSU5Fll3PNT6wGHVDZtXumz6rfti_y-PNlm2cyuTAjhhBO2f6FZhBuZcLNK9dP5LdFBfXu2uE3HTYa8cpGHeTsBx2SeovQGo7XvdUuLcR4P2JSMcrvQGpHpdwG9S_KrR-Xl96hh7UC4p0lMm1l4Pfc4IHl2K8TxaiVLiXP1YS5_BpiSxFsre8KF1XeO-65QwMeD6EonUJ9Grf5u0gj0txreWONrpWjeiGXaSeQs-wG1_6VP7MURKJz"/>
<div class="flex-1 min-w-0">
<div class="flex items-center justify-between">
<h4 class="font-semibold text-sm truncate">Fatima Ahmed</h4>
<span class="text-[10px] text-light-text/50 dark:text-dark-text/50">May 22</span>
</div>
<p class="text-xs text-light-text/70 dark:text-dark-text/70 truncate mt-0.5">Thank you for the quick response. The issue is resolved.</p>
</div>
<span class="flex-shrink-0 h-2 w-2 rounded-full bg-success"></span>
</div>
</div>
</div>
</div>
<div class="flex-1 flex flex-col bg-white dark:bg-dark-bg">
  <div class="p-4 border-b border-bronze/10 dark:border-primary/10 flex items-center justify-between bg-accent/10 dark:bg-secondary/10">
    <div class="flex items-center space-x-4">
<img alt="Selected User" class="h-12 w-12 rounded-full object-cover border-2 border-bronze/20 dark:border-primary/20" src="https://lh3.googleusercontent.com/aida-public/AB6AXuA1tC8N7ojmPi4Y1HymLA5Qp3fIYVYoXM1oVJStvcNZfExzvN1dcDwc5UbYaiyAZB2xJS_NpTu12fBgT346KZ3BCKwWiQ05Tz0thHvNrJGZYkIoqAwxNKTJ0cTvt8TFvqV6AzF7Mry0vIaKW04cnbMAmy-Mz9URu6wnIIPLF7FVM-ucMcYEjPuyvOrwy4-t3WIFkUVjL81hArhjlDiNENZNiD66OtI17lI0-L-KkdghyiBSAnYvU4cEm59zglviwYJRWzhIv_FH2bam"/>
<div>
<h3 class="font-display font-bold text-lg leading-none">Aaliyah Al-Farsi</h3>
<p class="text-xs text-success flex items-center mt-1"><span class="h-1.5 w-1.5 rounded-full bg-success mr-1.5"></span> Online • MENA Region</p>
</div>
</div>
<div class="flex items-center space-x-2">
<button class="p-2 rounded-lg border border-bronze/20 dark:border-primary/20 hover:bg-bronze/10 dark:hover:bg-primary/10 text-light-text/70 dark:text-dark-text/70 transition-colors">
<span class="material-symbols-outlined">call</span>
</button>
<button class="p-2 rounded-lg border border-bronze/20 dark:border-primary/20 hover:bg-bronze/10 dark:hover:bg-primary/10 text-light-text/70 dark:text-dark-text/70 transition-colors">
<span class="material-symbols-outlined">info</span>
</button>
</div>
</div>
<div class="flex-1 overflow-y-auto p-6 space-y-6 custom-scrollbar">
  <div class="flex justify-center"><span class="px-3 py-1 rounded-full bg-accent dark:bg-secondary text-[10px] uppercase tracking-widest font-bold border border-bronze/10 dark:border-primary/10">Today</span></div>
<div class="flex flex-col items-start space-y-2 max-w-[80%]">
<div class="bg-chat-user text-white dark:text-dark-text p-4 rounded-2xl rounded-tl-none shadow-sm border border-white/5">
<p class="text-sm">Hello, I placed an order (HA-91256) three days ago and the tracking still shows "Label Created". Is there a delay in shipping?</p>
</div>
<span class="text-[10px] text-light-text/50 dark:text-dark-text/50 ml-1">12:30 PM</span>
</div>
<div class="flex flex-col items-end space-y-2 ml-auto max-w-[80%]">
<div class="bg-chat-admin text-white p-4 rounded-2xl rounded-tr-none shadow-sm border border-primary/20">
<p class="text-sm">Assalamu Alaikum Aaliyah, let me check that for you right away. One moment please.</p>
</div>
<span class="text-[10px] text-light-text/50 dark:text-dark-text/50 mr-1">12:32 PM • Read</span>
</div>
<div class="flex flex-col items-end space-y-2 ml-auto max-w-[80%]">
<div class="bg-chat-admin text-white p-4 rounded-2xl rounded-tr-none shadow-sm border border-primary/20">
<p class="text-sm">It seems there was a minor logistics delay at the Dubai hub. Your package has just been scanned and is now in transit. You should receive an update within 2 hours.</p>
</div>
<span class="text-[10px] text-light-text/50 dark:text-dark-text/50 mr-1">12:35 PM • Read</span>
</div>
<div class="flex flex-col items-start space-y-2 max-w-[80%]">
<div class="bg-chat-user text-white dark:text-dark-text p-4 rounded-2xl rounded-tl-none shadow-sm border border-white/5">
<p class="text-sm">Oh, I see. Thank you for the clarification! I was worried it got lost. I'll keep an eye out for the update.</p>
</div>
<span class="text-[10px] text-light-text/50 dark:text-dark-text/50 ml-1">12:45 PM</span>
</div>
</div>
<div class="p-4 bg-accent/20 dark:bg-secondary/20 border-t border-bronze/10 dark:border-primary/10">
  <div class="bg-white dark:bg-secondary rounded-2xl p-2 shadow-sm border border-bronze/20 dark:border-primary/20 flex flex-col">
<textarea class="w-full border-0 bg-transparent focus:ring-0 text-sm py-2 px-3 resize-none custom-scrollbar min-h-[44px]" placeholder="Type your reply here..." rows="1"></textarea>
<div class="flex items-center justify-between border-t border-bronze/5 dark:border-primary/5 pt-2 mt-2">
<div class="flex items-center space-x-1">
<button class="p-2 text-light-text/50 dark:text-dark-text/50 hover:text-bronze dark:hover:text-primary transition-colors">
<span class="material-symbols-outlined">attach_file</span>
</button>
<button class="p-2 text-light-text/50 dark:text-dark-text/50 hover:text-bronze dark:hover:text-primary transition-colors">
<span class="material-symbols-outlined">mood</span>
</button>
<button class="p-2 text-light-text/50 dark:text-dark-text/50 hover:text-bronze dark:hover:text-primary transition-colors">
<span class="material-symbols-outlined">image</span>
</button>
</div>
<button class="bg-bronze dark:bg-primary text-white dark:text-secondary px-5 py-2 rounded-xl text-sm font-bold flex items-center space-x-2 shadow-glow-gold hover:opacity-90 transition-all">
<span>Send Message</span>
<span class="material-symbols-outlined text-sm">send</span>
</button>
</div>
</div>
</div>
</div>
</div>


</div>

<div
  class="space-y-8"
  x-data="adminBlogs()"
  x-init="loadBlogs()"
  x-show="activeView === 'blog'"
  x-transition
>



<script>

document.addEventListener('alpine:init', () => {
  Alpine.data('adminBlogs', () => ({

    /* ================= STATE ================= */
    blogListView: 'grid',
    blogs: [],
    loading: false,
    secondaryImageFile: null,
secondaryImagePreview: null,

    editorOpen: false,
    editorMode: 'add',
    editingId: null,

    /* ================= FORM ================= */
    form: {
      title: '',
      content: '',
      tags: [],
      featured: false,
      status: 'draft'
    },

    coverFile: null,
    coverPreview: null,

    /* ================= HELPERS ================= */
    api(url, options = {}) {
      const token = localStorage.getItem('token');
      return fetch(`https://perfume-store-production.up.railway.app${url}`, {
        headers: { Authorization: `Bearer ${token}` },
        ...options
      });
    },
  
    handleSecondaryImage(e) {
  const file = e.target.files[0];
  if (!file) return;

  this.secondaryImageFile = file;
  this.secondaryImagePreview = URL.createObjectURL(file);
},

    imageUrl(path) {
      if (!path) return '/images/placeholder.jpg';
      return `https://perfume-store-production.up.railway.app/${path.replace(/^src\//, '')}`;
    },

    resetForm() {
      this.form = {
        title: '',
        content: '',
        tags: [],
        featured: false,
        status: 'draft'
      };
      this.coverFile = null;
      this.coverPreview = null;
      this.editingId = null;
    },

    /* ================= LOAD ================= */
    async loadBlogs() {
      this.loading = true;
      const res = await this.api('/api/blogs/admin/all');
      const data = await res.json();
      this.blogs = data.blogs || [];
      this.loading = false;
    },

    /* ================= EDITOR ================= */
    openAddEditor() {
      this.resetForm();
      this.editorMode = 'add';
      this.editorOpen = true;
    },
    wrapSelection(tag) {
  const sel = window.getSelection();
  if (!sel || sel.rangeCount === 0) return;

  const range = sel.getRangeAt(0);
  if (range.collapsed) return;

  const content = range.extractContents();
  const el = document.createElement(tag);
  el.appendChild(content);
  range.insertNode(el);

  sel.removeAllRanges();
},
    openEdit(blog) {
      this.resetForm();
      this.editorMode = 'edit';
      this.editingId = blog._id;

      this.form = {
        title: blog.title,
        content: blog.content,
        tags: [...blog.tags],
        featured: blog.featured,
        status: blog.status
      };

      this.coverPreview = this.imageUrl(blog.mainImage);
      this.editorOpen = true;

      this.$nextTick(() => {
        this.$refs.editor.innerHTML = blog.content;
      });
    },

    closeEditor() {
      this.editorOpen = false;
      this.resetForm();
    },
    focusEditor() {
  this.$refs.editor.focus();
},
    /* ================= IMAGE ================= */
    handleCoverUpload(e) {
      const file = e.target.files[0];
      if (!file) return;
      this.coverFile = file;
      this.coverPreview = URL.createObjectURL(file);
    },

    /* ================= TAGS ================= */
    addTag(tag) {
      tag = tag.trim();
      if (!tag || this.form.tags.includes(tag)) return;
      this.form.tags.push(tag);
    },

    removeTag(tag) {
      this.form.tags = this.form.tags.filter(t => t !== tag);
    },

    /* ================= SAVE ================= */
    async submit(status) {
      this.form.status = status;

      const fd = new FormData();
      Object.entries(this.form).forEach(([k, v]) => {
        if (k === 'tags') fd.append(k, JSON.stringify(v));
        else fd.append(k, v);
      });
      if (this.secondaryImageFile) {
  fd.append('secondaryImage', this.secondaryImageFile);
}

      if (this.coverFile) fd.append('mainImage', this.coverFile);

      const url = this.editorMode === 'add'
        ? '/api/blogs'
        : `/api/blogs/${this.editingId}`;

      const method = this.editorMode === 'add' ? 'POST' : 'PATCH';

      await this.api(url, { method, body: fd });

      await this.loadBlogs();
      this.closeEditor();
    },

    saveDraft() { this.submit('draft'); },
    publishArticle() { this.submit('published'); },
    saveChanges() { this.submit(this.form.status); },

    /* ================= DELETE ================= */
    async deleteBlog(id) {
      if (!confirm('Delete this article?')) return;
      await this.api(`/api/blogs/${id}`, { method: 'DELETE' });
      this.blogs = this.blogs.filter(b => b._id !== id);
    }

  }));
});
</script>





<div class="flex flex-col md:flex-row md:items-center justify-between gap-4 bg-accent/30 dark:bg-secondary/30 p-4 rounded-2xl border border-bronze/10 dark:border-primary/10">
<div class="flex items-center space-x-2 bg-light-bg dark:bg-dark-bg p-1 rounded-xl border border-bronze/20 dark:border-primary/20">
<button :class="blogListView === 'grid' ? 'bg-bronze dark:bg-primary text-white dark:text-secondary' : 'text-light-text/60 dark:text-dark-text/60'" @click="blogListView = 'grid'" class="flex items-center px-4 py-2 rounded-lg transition-all">
<span class="material-symbols-outlined mr-2">grid_view</span> Grid
                        </button>
<button :class="blogListView === 'list' ? 'bg-bronze dark:bg-primary text-white dark:text-secondary' : 'text-light-text/60 dark:text-dark-text/60'" @click="blogListView = 'list'" class="flex items-center px-4 py-2 rounded-lg transition-all">
<span class="material-symbols-outlined mr-2">view_list</span> List
                        </button>
</div>
<button @click="openAddEditor()" class="flex items-center justify-center px-6 py-3 bg-bronze dark:bg-primary text-white dark:text-secondary font-bold rounded-xl shadow-glow-gold hover:opacity-90 transition-all">
<span class="material-symbols-outlined mr-2">add_circle</span> Create New Article
                    </button>
</div>
<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6" x-show="blogListView === 'grid'">
  <template x-for="(blog, index) in blogs" :key="blog._id">
  <div
    class="article-card-stagger bg-accent dark:bg-secondary rounded-2xl
           overflow-hidden border border-bronze/10 dark:border-primary/10
           shadow-sm hover:shadow-card-lift transition-all group"
    :style="`animation-delay: ${(index + 1) * 100}ms`"
  >

    <!-- COVER IMAGE -->
    <div class="relative aspect-[16/10] overflow-hidden">
      <img
      :src="imageUrl(blog.mainImage)"

      alt="Cover"
        class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-700"
      />

      <!-- STATUS BADGE -->
      <div class="absolute top-3 right-3">
        <span
          class="px-3 py-1 text-xs font-bold rounded-full backdrop-blur-md border"
          :class="blog.status === 'published'
            ? 'bg-success/20 text-success border-success/30'
            : 'bg-warning/20 text-warning border-warning/30'"
          x-text="blog.status === 'published' ? 'Published' : 'Draft'"
        ></span>
      </div>
    </div>

    <!-- CONTENT -->
    <div class="p-5 space-y-3">

      <!-- TAGS -->
      <div class="flex flex-wrap gap-2">
        <template x-for="tag in blog.tags" :key="tag">
          <span
            class="text-[10px] uppercase tracking-widest font-bold
                   border border-bronze/40 dark:border-primary/40
                   px-2 py-0.5 rounded
                   text-bronze dark:text-primary"
            x-text="tag"
          ></span>
        </template>
      </div>

      <!-- TITLE -->
      <h3
        class="font-display font-bold text-xl leading-tight"
        x-text="blog.title"
      ></h3>

      <!-- FOOTER -->
      <div class="flex items-center justify-between pt-4
                  border-t border-bronze/5 dark:border-primary/5">

        <!-- DATE -->
        <span
          class="text-xs text-light-text/50 dark:text-dark-text/50"
          x-text="new Date(blog.createdAt).toLocaleDateString()"
        ></span>
        <span
  class="text-xs text-light-text/40 dark:text-dark-text/40"
  x-show="blog.readingTime"
  x-text="`${blog.readingTime} min read`"
></span>

        <!-- ACTIONS -->
        <div class="flex space-x-1">

          <!-- EDIT -->
          <button
            @click="openEdit(blog)"
            class="p-2 hover:bg-bronze/10 dark:hover:bg-primary/10
                   rounded-lg text-bronze dark:text-primary transition-colors"
          >
            <span class="material-symbols-outlined text-xl">edit</span>
          </button>

          <!-- DELETE -->
          <button
            @click="deleteBlog(blog._id)"
            class="p-2 hover:bg-danger/10 rounded-lg
                   text-danger transition-colors"
          >
            <span class="material-symbols-outlined text-xl">delete</span>
          </button>

        </div>
      </div>

    </div>
  </div>
</template>

</div>
<div class="bg-accent dark:bg-secondary rounded-2xl border border-bronze/10 dark:border-primary/10 overflow-hidden shadow-sm" x-show="blogListView === 'list'" x-transition="">
<table class="w-full text-left">
<thead class="bg-bronze/5 dark:bg-primary/5 border-b border-bronze/10 dark:border-primary/10 text-xs uppercase tracking-widest font-bold text-light-text/60 dark:text-dark-text/60">
<tr>
<th class="px-6 py-4">Article</th>
<th class="px-6 py-4">Status</th>
<th class="px-6 py-4">Tags</th>
<th class="px-6 py-4">Date Published</th>
<th class="px-6 py-4 text-right">Actions</th>
</tr>
</thead>
<tbody class="divide-y divide-bronze/5 dark:divide-primary/5">
  <template x-for="blog in blogs" :key="blog._id">
    <tr class="hover:bg-bronze/5 dark:hover:bg-primary/5 transition-colors">
      <td class="px-6 py-4">
        <div class="flex items-center space-x-4">
          <img :src="imageUrl(blog.mainImage)" class="w-16 h-10 rounded object-cover">
          <span class="font-bold" x-text="blog.title"></span>
        </div>
      </td>

      <td class="px-6 py-4">
        <span x-text="blog.status"></span>
      </td>

      <td class="px-6 py-4">
        <span x-text="blog.tags.join(', ')"></span>
      </td>

      <td class="px-6 py-4 text-xs" x-text="new Date(blog.createdAt).toLocaleDateString()"></td>

      <td class="px-6 py-4 text-right">
        <button @click="openEdit(blog)">✏️</button>
        <button @click="deleteBlog(blog._id)">🗑</button>
      </td>
    </tr>
  </template>
</tbody>

</table>
</div>




<!-- MODAL WRAPPER -->
<div
  class="fixed inset-0 z-50 flex"
  x-show="editorOpen"
  x-cloak
  x-transition.opacity
>
  <!-- BACKDROP -->
  <div
    class="absolute inset-0 bg-dark-bg/90 backdrop-blur-xl"
    @click="closeEditor()"
  ></div>

  <!-- PANEL -->
  <div
    class="relative ml-auto w-full max-w-5xl h-full
           bg-light-bg dark:bg-dark-bg
           shadow-2xl flex flex-col"
    x-transition:enter="transform transition ease-in-out duration-500"
    x-transition:enter-start="translate-x-full"
    x-transition:enter-end="translate-x-0"
    x-transition:leave="transform transition ease-in-out duration-500"
    x-transition:leave-start="translate-x-0"
    x-transition:leave-end="translate-x-full"
  >

    <!-- HEADER -->
    <div class="flex items-center justify-between px-8 h-20
                border-b border-bronze/10 dark:border-primary/10
                bg-accent/20 dark:bg-secondary/20 flex-shrink-0">
      <div class="flex items-center space-x-4">
        <button
          @click="closeEditor()"
          class="p-2 rounded-full hover:bg-bronze/10 dark:hover:bg-primary/10
                 text-bronze dark:text-primary">
          <span class="material-symbols-outlined text-3xl">close</span>
        </button>
        <h2 class="text-2xl font-display font-bold"
            x-text="editorMode === 'add' ? 'New Article' : 'Edit Article'">
        </h2>
      </div>

      <div class="hidden sm:flex items-center text-xs italic
                  text-light-text/50 dark:text-dark-text/50">
        <span class="material-symbols-outlined text-sm mr-2">cloud_done</span>
        All changes saved
      </div>
    </div>

    <!-- SCROLLABLE CONTENT -->
    <div class="flex-1 overflow-y-auto px-6 py-10 space-y-10">

      <!-- COVER IMAGE -->
      <label
        class="relative block w-full h-[280px]
               rounded-3xl overflow-hidden
               bg-accent/50 dark:bg-secondary/50
               border-2 border-dashed border-bronze/20 dark:border-primary/20
               cursor-pointer flex items-center justify-center"
      >
        <input type="file" class="hidden" accept="image" @change="handleCoverUpload">

        <template x-if="!coverPreview">
          <div class="text-center">
            <span class="material-symbols-outlined text-5xl text-bronze dark:text-primary mb-3">
              add_photo_alternate
            </span>
            <p class="font-bold text-lg">Click to upload cover image</p>
          </div>
        </template>

        <template x-if="coverPreview">
          <img :src="coverPreview"
               class="absolute inset-0 w-full h-full object-cover">
        </template>
      </label>

      <!-- TITLE -->
      <input
        x-model="form.title"
        type="text"
        placeholder="Enter article title here..."
        class="w-full bg-transparent border-none focus:ring-0
               text-5xl font-display font-bold
               placeholder:text-light-text/20 dark:placeholder:text-dark-text/20"
      />

      <!-- TAGS -->
      <div class="flex items-center gap-4 flex-wrap">
        <div class="flex items-center bg-accent dark:bg-secondary
                    border border-bronze/10 dark:border-primary/10
                    rounded-full px-4 py-1.5">
          <span class="material-symbols-outlined text-sm mr-2
                       text-bronze dark:text-primary">label</span>
          <input
            type="text"
            placeholder="Add tags..."
            @keydown.enter.prevent="
              addTag($event.target.value);
              $event.target.value = '';
            "
            class="bg-transparent border-none focus:ring-0 text-sm w-32"
          />
        </div>

        <template x-for="tag in form.tags" :key="tag">
          <span
            class="bg-bronze/10 dark:bg-primary/10
                   text-bronze dark:text-primary
                   px-3 py-1 rounded-full text-xs font-bold
                   border border-bronze/20 dark:border-primary/20
                   flex items-center">
            <span x-text="tag"></span>
            <button @click="removeTag(tag)" class="ml-2 hover:text-danger">×</button>
          </span>
        </template>
      </div>


      <!-- SECONDARY IMAGE -->
<div class="space-y-3">
  <label class="block font-bold text-sm text-light-text/60">
    Secondary Image
  </label>

  <input
    type="file"
    accept="image"
    @change="handleSecondaryImage"
  />

  <template x-if="secondaryImagePreview">
    <div class="relative w-full max-w-md rounded-xl overflow-hidden border">
      <img
        :src="secondaryImagePreview"
        class="w-full h-48 object-cover"
      />
      <button
        @click="secondaryImageFile=null; secondaryImagePreview=null"
        class="absolute top-2 right-2 bg-black/70 text-white w-6 h-6 rounded-full flex items-center justify-center"
      >
        ×
      </button>
    </div>
  </template>
</div>


    

<!-- EDITOR TOOLBAR -->
<div class="sticky top-0 z-10 bg-light-bg/80 dark:bg-dark-bg/80
            backdrop-blur-md p-2 rounded-2xl
            border border-bronze/10 dark:border-primary/10
            flex flex-wrap items-center gap-1 shadow-sm">

  <!-- BOLD -->
  <button
    type="button"
    @click="document.execCommand('bold')"
    class="p-2 hover:bg-bronze/10 dark:hover:bg-primary/10 rounded-lg transition-colors"
  >
    <span class="material-symbols-outlined">format_bold</span>
  </button>

  <!-- ITALIC -->
  <button
    type="button"
    @click="document.execCommand('italic')"
    class="p-2 hover:bg-bronze/10 dark:hover:bg-primary/10 rounded-lg transition-colors"
  >
    <span class="material-symbols-outlined">format_italic</span>
  </button>

  <!-- UNDERLINE -->
  <button
    type="button"
    @click="document.execCommand('underline')"
    class="p-2 hover:bg-bronze/10 dark:hover:bg-primary/10 rounded-lg transition-colors"
  >
    <span class="material-symbols-outlined">format_underlined</span>
  </button>

  <div class="w-px h-6 bg-bronze/10 dark:bg-primary/10 mx-2"></div>

  <!-- H1 -->
  <button
  type="button"
  @click="wrapSelection('h1')"
  class="p-2 hover:bg-bronze/10 rounded-lg"
>
  <span class="material-symbols-outlined">format_h1</span>
</button>


<button
  type="button"
  @click="wrapSelection('h2')"
  class="p-2 hover:bg-bronze/10 rounded-lg"
>
  <span class="material-symbols-outlined">format_h2</span>
</button>


  <div class="w-px h-6 bg-bronze/10 dark:bg-primary/10 mx-2"></div>

  <button
  type="button"
  @click="wrapSelection('blockquote')"
  class="p-2 hover:bg-bronze/10 rounded-lg"
>
  <span class="material-symbols-outlined">format_quote</span>
</button>



<button
  type="button"
  @click="wrapSelection('li')"
  class="p-2 hover:bg-bronze/10 rounded-lg"
>
  <span class="material-symbols-outlined">format_list_bulleted</span>
</button>



  <!-- LINK -->
  <button
    type="button"
    @click="
      const url = prompt('Enter URL');
      if (url) document.execCommand('createLink', false, url);
    "
    class="p-2 hover:bg-bronze/10 dark:hover:bg-primary/10 rounded-lg transition-colors"
  >
    <span class="material-symbols-outlined">link</span>
  </button>


</div>


      <!-- CONTENT EDITOR -->
      <div
  contenteditable="true"
  x-ref="editor"
  class="min-h-[500px] outline-none editor-content"
  @input="form.content = $event.target.innerHTML"
></div>



    </div>

    <!-- FOOTER (FIXED) -->
    <div
      class="flex items-center justify-between px-8 py-5
             border-t border-bronze/10 dark:border-primary/10
             bg-accent/40 dark:bg-secondary/40
             backdrop-blur-xl flex-shrink-0"
    >
      <label class="flex items-center space-x-3">
        <input type="checkbox" x-model="form.featured" class="hidden peer">
        <div class="w-10 h-6 bg-bronze/20 dark:bg-primary/20
                    rounded-full relative peer-checked:bg-success">
          <span class="absolute top-0.5 left-0.5 w-5 h-5 bg-white rounded-full
                       transition-all peer-checked:translate-x-4"></span>
        </div>
        <span class="text-sm font-bold text-light-text/60 dark:text-dark-text/60">
          Featured Article
        </span>
      </label>

      <template x-if="editorMode === 'add'">
        <div class="flex space-x-4">
          <button @click="saveDraft()" class="px-8 py-3 font-bold border rounded-xl">
            Save as Draft
          </button>
          <button @click="publishArticle()"
                  class="px-8 py-3 bg-bronze text-white font-bold rounded-xl">
            Publish Article
          </button>
        </div>
      </template>

      <template x-if="editorMode === 'edit'">
        <div class="flex space-x-4">
          <button @click="closeEditor()" class="px-8 py-3 font-bold border rounded-xl">
            Cancel
          </button>
          <button @click="saveChanges()"
                  class="px-8 py-3 bg-bronze text-white font-bold rounded-xl">
            Save Changes
          </button>
        </div>
      </template>
    </div>

  </div>
</div>

</div>

<style>
  .editor-content h1 {
  font-size: 2.25rem;
  font-weight: 700;
  margin: 1.5rem 0 1rem;
}

.editor-content h2 {
  font-size: 1.75rem;
  font-weight: 600;
  margin: 1.25rem 0 0.75rem;
}

.editor-content blockquote {
  border-left: 4px solid #c08457;
  padding-left: 1rem;
  color: #555;
  font-style: italic;
  margin: 1rem 0;
}

.editor-content ul {
  list-style: disc;
  padding-left: 1.5rem;
  margin: 1rem 0;
}

.editor-content li {
  margin: 0.25rem 0;
}

  </style>


</div>



<!-- ================= SETTINGS SECTION ================= -->
<div
  x-show="activeView === 'settings'"
  x-cloak
  x-transition:enter="transition ease-out duration-300"
  x-transition:enter-start="opacity-0"
  x-transition:enter-end="opacity-100"
  x-transition:leave="transition ease-in duration-200"
  x-transition:leave-start="opacity-100"
  x-transition:leave-end="opacity-0"
  class="space-y-6 animate-fade-in"
>

<main class="flex-1 w-full max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-8 animate-fade-in">
<div class="flex flex-col md:flex-row md:items-end justify-between gap-4 border-b border-border-light dark:border-border-dark pb-6">
<div class="space-y-1">
<h1 class="text-3xl font-display font-bold text-gray-900 dark:text-white">Admin Settings</h1>
<p class="text-gray-500 dark:text-gray-400 font-body text-sm">Manage system configuration, security protocols, and store preferences.</p>
</div>
<div class="flex items-center gap-3">
<span class="text-xs text-gray-400">Last synced: Just now</span>
</div>
</div>
<div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
<div class="lg:col-span-1 space-y-8">
<section class="bg-surface-light dark:bg-surface-dark rounded-xl border border-border-light dark:border-border-dark shadow-sm hover:shadow-md transition-shadow duration-300 overflow-hidden">
<div class="p-6 border-b border-border-light dark:border-border-dark bg-gray-50/50 dark:bg-surface-accent-dark/30 flex items-center gap-3">
<span class="material-symbols-outlined text-primary">account_circle</span>
<h3 class="font-display font-bold text-gray-900 dark:text-white text-lg">Profile &amp; Account</h3>
</div>
<div class="p-6 space-y-6">
<div class="flex items-center gap-4">
  <div class="relative w-20 h-20">
  <!-- Avatar -->
  <img
    id="avatarPreview"
    data-user-avatar
    alt="Admin Avatar"
    class="w-20 h-20 rounded-full border-4 border-primary/20 ring-2 ring-primary object-cover pointer-events-none"
  />

  <!-- Upload trigger -->
  <label
    class="absolute bottom-0 right-0 z-10 bg-primary text-white p-1 rounded-full shadow-lg cursor-pointer hover:bg-primary-dark transition-colors flex items-center justify-center"
  >
    <span class="material-symbols-outlined text-[16px]">edit</span>
    <input
      type="file"
      class="absolute inset-0 opacity-0 cursor-pointer"
      onchange="uploadAvatar(event)"
    />
  </label>
</div>

<div>
  <h4 class="font-bold text-gray-900 dark:text-white font-display" data-user-name></h4>
  <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary/10 text-primary border border-primary/20 mt-1">
                                    Super Admin
                                </span>
</div>
</div>
<div class="space-y-4">
<div>
<label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Full Name</label>
<input
  id="admin-name-input"
  class="w-full bg-transparent border-border-light dark:border-border-dark rounded-lg text-sm focus:border-primary focus:ring-primary dark:text-white dark:bg-surface-accent-dark/50"
  type="text"
/>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Email Address</label>
<div class="relative">
<input class="w-full bg-gray-50 dark:bg-surface-accent-dark border-border-light dark:border-border-dark rounded-lg text-sm text-gray-500 cursor-not-allowed pl-10" readonly="" type="email" value="admin@hirahattar.com"/>
<span class="material-symbols-outlined absolute left-3 top-2.5 text-gray-400 text-sm">lock</span>
</div>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Two-Factor Method</label>
<select class="w-full bg-transparent border-border-light dark:border-border-dark rounded-lg text-sm focus:border-primary focus:ring-primary dark:text-white dark:bg-surface-accent-dark/50">
<option>Authenticator App (Recommended)</option>
<option>SMS Message</option>
<option>Email Verification Code</option>
</select>
</div>
<div class="border-t border-border-light dark:border-border-dark pt-4">
<div class="flex items-center justify-between mb-2">
<label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Active Sessions</label>
<button class="text-xs text-red-500 hover:text-red-600 font-medium">End All Other Sessions</button>
</div>
<div class="space-y-2">
<div class="flex items-center gap-2 bg-gray-50 dark:bg-surface-accent-dark/30 p-2 rounded-lg border border-border-light dark:border-border-dark">
<span class="material-symbols-outlined text-green-500 text-lg">laptop_mac</span>
<div class="flex-1">
<p class="text-xs font-medium text-gray-900 dark:text-white">MacBook Pro <span class="text-primary ml-1">(Current)</span></p>
<p class="text-[10px] text-gray-500">Dubai, UAE • 2 mins ago</p>
</div>
</div>
<div class="flex items-center gap-2 bg-gray-50 dark:bg-surface-accent-dark/30 p-2 rounded-lg border border-border-light dark:border-border-dark opacity-75">
<span class="material-symbols-outlined text-gray-400 text-lg">smartphone</span>
<div class="flex-1">
<p class="text-xs font-medium text-gray-900 dark:text-white">iPhone 14 Pro</p>
<p class="text-[10px] text-gray-500">London, UK • 1 hr ago</p>
</div>
</div>
</div>
</div>
</div>
<div class="flex flex-col gap-3 pt-2">
  <button
  type="button"
  onclick="updateAdminProfile()"
  class="w-full bg-gradient-to-r from-primary to-primary-dark text-white font-medium py-2 px-4 rounded-lg hover:shadow-lg hover:shadow-primary/20 transition-all duration-300 text-sm"
>
  Update Profile
</button>
<script>
/* ================= USER HELPERS ================= */
function getUser() {
  const raw = localStorage.getItem("user");
  if (!raw) return null;
  return JSON.parse(raw);
}

function setUser(patch) {
  const current = getUser() || {};
  const updated = { ...current, ...patch };
  localStorage.setItem("user", JSON.stringify(updated));
}

/* ================= AVATAR FALLBACK ================= */
function getAvatarUrl(user) {
  if (user.avatar) return user.avatar;

  const base = user.name || user.email.split("@")[0];
  const initials = base
    .split(" ")
    .map(w => w[0])
    .join("")
    .substring(0, 2)
    .toUpperCase();

  return "https://ui-avatars.com/api/?name=" +
    initials +
    "&background=8B5A2B&color=fff";
}

/* ================= UI SYNC ================= */
function syncAvatarUI() {
  const user = getUser();
  if (!user) return;

  const avatarUrl = getAvatarUrl(user);

  document
    .querySelectorAll("[data-user-avatar], #avatarPreview")
    .forEach(img => {
      img.src = avatarUrl + "?v=" + Date.now();
    });
}

function syncUserTextUI() {
  const user = getUser();
  if (!user) return;

  document.querySelectorAll("[data-user-name]").forEach(el => {
    el.textContent = user.name || user.email.split("@")[0];
  });
}

/* ================= AVATAR UPLOAD ================= */
async function uploadAvatar(event) {
  const file = event.target.files[0];
  if (!file) return;

  // 🔒 HARD CHECK (no accept attribute needed)
  if (!file.type.startsWith("image/")) {
    alert("Only image files are allowed");
    event.target.value = "";
    return;
  }

  // Preview immediately
  const reader = new FileReader();
  reader.onload = e => {
    const preview = document.getElementById("avatarPreview");
    if (preview) preview.src = e.target.result;
  };
  reader.readAsDataURL(file);

  try {
    const token = localStorage.getItem("token");
    const formData = new FormData();
    formData.append("avatar", file);

    const res = await fetch("https://perfume-store-production.up.railway.app/api/users/avatar", {
      method: "PUT",
      headers: {
        Authorization: `Bearer ${token}`
      },
      body: formData
    });

    const data = await res.json();
    if (!res.ok) throw new Error(data.message);

    setUser({ avatar: data.user.avatar });
    syncAvatarUI();

  } catch (err) {
    console.error(err);
    alert("Avatar upload failed");
  } finally {
    event.target.value = "";
  }
}

/* ================= UPDATE ADMIN NAME ================= */
async function updateAdminProfile() {
  const input = document.getElementById("admin-name-input");
  if (!input) return;

  const newName = input.value.trim();
  if (!newName) {
    alert("Name cannot be empty");
    return;
  }

  try {
    const token = localStorage.getItem("token");

    const res = await fetch("https://perfume-store-production.up.railway.app/api/users/profile", {
      method: "PUT",
      headers: {
        "Content-Type": "application/json",
        Authorization: `Bearer ${token}`
      },
      body: JSON.stringify({ name: newName })
    });

    const data = await res.json();
    if (!res.ok) throw new Error(data.message);

    setUser({ name: data.user.name });
    syncUserTextUI();

    alert("Profile updated");

  } catch (err) {
    console.error(err);
    alert("Failed to update profile");
  }
}

/* ================= INIT ================= */
document.addEventListener("DOMContentLoaded", () => {
  const user = getUser();
  if (!user) return;

  const input = document.getElementById("admin-name-input");
  if (input) {
    input.value = user.name || user.email.split("@")[0];
  }

  syncAvatarUI();
  syncUserTextUI();
});

</script>

<div>
<label class="w-full block text-center border border-border-light dark:border-border-dark text-gray-700 dark:text-gray-300 font-medium py-2 px-4 rounded-lg hover:bg-gray-50 dark:hover:bg-surface-accent-dark transition-colors text-sm cursor-pointer select-none" for="password-modal-toggle">
                                    Change Password
                                </label>
<input class="peer hidden" id="password-modal-toggle" type="checkbox"/>
<div aria-labelledby="modal-title" aria-modal="true" class="fixed inset-0 z-[100] hidden peer-checked:flex items-center justify-center" role="dialog">
<label class="absolute inset-0 bg-gray-900/60 backdrop-blur-sm transition-opacity" for="password-modal-toggle"></label>
<div class="relative bg-surface-light dark:bg-surface-dark rounded-xl shadow-2xl w-full max-w-md m-4 border border-primary/20 overflow-hidden transform transition-all animate-in fade-in zoom-in-95 duration-200">
<div class="flex items-center justify-between p-5 border-b border-border-light dark:border-border-dark bg-gray-50/50 dark:bg-surface-accent-dark/30">
<h3 class="text-lg font-display font-bold text-gray-900 dark:text-white" id="modal-title">Change Password</h3>
<label class="text-gray-400 hover:text-gray-500 dark:hover:text-gray-300 cursor-pointer transition-colors p-1 rounded-md hover:bg-gray-100 dark:hover:bg-surface-accent-dark" for="password-modal-toggle">
<span class="material-symbols-outlined text-[20px]">close</span>
</label>
</div>
<div class="p-6 space-y-5">
<div>
<label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5">Current Password</label>
<div class="relative">
<input class="w-full bg-transparent border-border-light dark:border-border-dark rounded-lg text-sm focus:border-primary focus:ring-primary dark:text-white dark:bg-surface-accent-dark/50 py-2.5" placeholder="Enter current password" type="password"/>
<span class="material-symbols-outlined absolute right-3 top-2.5 text-gray-400 text-[20px]">lock</span>
</div>
<div class="mt-1.5 flex justify-end">
<a class="text-xs text-primary hover:text-primary-dark font-medium hover:underline" href="#">Forgot Password?</a>
</div>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5">New Password</label>
<div class="relative group">
<input class="w-full bg-transparent border-border-light dark:border-border-dark rounded-lg text-sm focus:border-primary focus:ring-primary dark:text-white dark:bg-surface-accent-dark/50 py-2.5 pr-10" placeholder="Minimum 8 characters" type="password"/>
<button class="absolute right-3 top-2.5 text-gray-400 hover:text-primary transition-colors focus:outline-none" type="button">
<span class="material-symbols-outlined text-[20px]">visibility</span>
</button>
</div>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5">Confirm Password</label>
<div class="relative group">
<input class="w-full bg-transparent border-border-light dark:border-border-dark rounded-lg text-sm focus:border-primary focus:ring-primary dark:text-white dark:bg-surface-accent-dark/50 py-2.5 pr-10" placeholder="Re-enter new password" type="password"/>
<button class="absolute right-3 top-2.5 text-gray-400 hover:text-primary transition-colors focus:outline-none" type="button">
<span class="material-symbols-outlined text-[20px]">visibility</span>
</button>
</div>
</div>
</div>
<div class="flex items-center justify-end gap-3 p-5 border-t border-border-light dark:border-border-dark bg-gray-50/30 dark:bg-surface-accent-dark/10">
<label class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-surface-accent-dark rounded-lg cursor-pointer transition-colors border border-transparent" for="password-modal-toggle">
                                            Cancel
                                        </label>
<button class="px-5 py-2 text-sm font-medium text-white bg-primary hover:bg-primary-dark rounded-lg shadow-md shadow-primary/20 hover:shadow-lg hover:shadow-primary/25 transition-all">
                                            Update Password
                                        </button>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section class="bg-surface-light dark:bg-surface-dark rounded-xl border border-border-light dark:border-border-dark shadow-sm hover:shadow-md transition-shadow duration-300 overflow-hidden">
<div class="p-6 border-b border-border-light dark:border-border-dark bg-gray-50/50 dark:bg-surface-accent-dark/30 flex items-center gap-3">
<span class="material-symbols-outlined text-primary">security</span>
<h3 class="font-display font-bold text-gray-900 dark:text-white text-lg">Security</h3>
</div>
<div class="p-6 space-y-6">
<div class="flex items-center justify-between">
<div class="flex items-start gap-3">
<span class="material-symbols-outlined text-gray-400 mt-1">phonelink_lock</span>
<div>
<p class="text-sm font-medium text-gray-900 dark:text-white">Two-Factor Auth</p>
<p class="text-xs text-gray-500">Secure sign-in via chosen method</p>
</div>
</div>
<label class="relative inline-flex items-center cursor-pointer">
<input checked="" class="sr-only peer" type="checkbox" value=""/>
<div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
</label>
</div>
<div class="flex items-center justify-between">
<div class="flex items-start gap-3">
<span class="material-symbols-outlined text-gray-400 mt-1">password</span>
<div>
<p class="text-sm font-medium text-gray-900 dark:text-white">Force Strong Passwords</p>
<p class="text-xs text-gray-500">Require special chars &amp; numbers</p>
</div>
</div>
<label class="relative inline-flex items-center cursor-pointer">
<input checked="" class="sr-only peer" type="checkbox" value=""/>
<div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
</label>
</div>
<div class="flex items-center justify-between">
<div class="flex items-start gap-3">
<span class="material-symbols-outlined text-gray-400 mt-1">timer_off</span>
<div>
<p class="text-sm font-medium text-gray-900 dark:text-white">Auto Logout</p>
<p class="text-xs text-gray-500">Log out inactive admins after 30m</p>
</div>
</div>
<label class="relative inline-flex items-center cursor-pointer">
<input class="sr-only peer" type="checkbox" value=""/>
<div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
</label>
</div>
<div class="pt-2 border-t border-border-light dark:border-border-dark mt-2">
<label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">IP Whitelisting</label>
<textarea class="w-full bg-transparent border-border-light dark:border-border-dark rounded-lg text-xs font-mono text-gray-600 dark:text-gray-400 focus:border-primary focus:ring-primary dark:bg-surface-accent-dark/50 p-2 h-20 resize-none" placeholder="Enter allowed IP addresses (one per line)"></textarea>
</div>
<div class="pt-2 flex flex-col gap-2">
<button class="w-full border border-border-light dark:border-border-dark text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-surface-accent-dark font-medium py-2 px-4 rounded-lg transition-colors text-sm flex items-center justify-center gap-2">
<span class="material-symbols-outlined text-lg">history</span>
                                View Audit Log
                            </button>
<button class="w-full border border-red-200 dark:border-red-900/50 text-red-600 dark:text-red-400 bg-red-50 dark:bg-red-900/10 hover:bg-red-100 dark:hover:bg-red-900/20 font-medium py-2 px-4 rounded-lg transition-colors text-sm flex items-center justify-center gap-2">
<span class="material-symbols-outlined text-lg">logout</span>
                                Logout from all devices
                            </button>
</div>
</div>
</section>
</div>
<div class="lg:col-span-2 space-y-8">
<section class="bg-surface-light dark:bg-surface-dark rounded-xl border border-border-light dark:border-border-dark shadow-sm hover:shadow-md transition-shadow duration-300 overflow-hidden">
<div class="p-6 border-b border-border-light dark:border-border-dark bg-gray-50/50 dark:bg-surface-accent-dark/30 flex items-center justify-between">
<div class="flex items-center gap-3">
<span class="material-symbols-outlined text-primary">storefront</span>
<h3 class="font-display font-bold text-gray-900 dark:text-white text-lg">Store Configuration</h3>
</div>
<div class="flex items-center gap-3">
<span class="text-sm font-medium text-gray-600 dark:text-gray-400">Store Status</span>
<label class="relative inline-flex items-center cursor-pointer">
<input checked="" class="sr-only peer" type="checkbox" value=""/>
<div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-500"></div>
</label>
</div>
</div>
<div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-6">
<div class="md:col-span-2">
<label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Store Name</label>
<div class="relative">
<input class="w-full bg-transparent border-border-light dark:border-border-dark rounded-lg text-sm focus:border-primary focus:ring-primary dark:text-white dark:bg-surface-accent-dark/50 pl-10 font-display font-semibold tracking-wide" type="text" value="Hirah Attar"/>
<span class="material-symbols-outlined absolute left-3 top-2.5 text-primary text-sm">diamond</span>
</div>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Support Email</label>
<input class="w-full bg-transparent border-border-light dark:border-border-dark rounded-lg text-sm focus:border-primary focus:ring-primary dark:text-white dark:bg-surface-accent-dark/50" type="email" value="concierge@hirahattar.com"/>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Default Language</label>
<select class="w-full bg-transparent border-border-light dark:border-border-dark rounded-lg text-sm focus:border-primary focus:ring-primary dark:text-white dark:bg-surface-accent-dark/50">
<option>English (UK)</option>
<option>Arabic</option>
<option>French</option>
</select>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Currency</label>
<div class="relative">
<select class="w-full bg-transparent border-border-light dark:border-border-dark rounded-lg text-sm focus:border-primary focus:ring-primary dark:text-white dark:bg-surface-accent-dark/50 pl-10 appearance-none">
<option>USD ($)</option>
<option>AED (د.إ)</option>
<option>LKR (Rs)</option>
</select>
<span class="material-symbols-outlined absolute left-3 top-2.5 text-gray-400 text-sm">payments</span>
<span class="material-symbols-outlined absolute right-3 top-2.5 text-gray-400 text-sm pointer-events-none">expand_more</span>
</div>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">System Timezone</label>
<select class="w-full bg-transparent border-border-light dark:border-border-dark rounded-lg text-sm focus:border-primary focus:ring-primary dark:text-white dark:bg-surface-accent-dark/50">
<option>(GMT+04:00) Dubai</option>
<option>(GMT+00:00) London</option>
<option>(GMT-05:00) New York</option>
</select>
</div>
<div class="md:col-span-2 pt-4 border-t border-border-light dark:border-border-dark">
<h4 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-3 flex items-center gap-2">
<span class="material-symbols-outlined text-gray-400">campaign</span> Marketing Integrations
                            </h4>
<div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
<label class="flex items-center justify-between p-3 border border-border-light dark:border-border-dark rounded-lg bg-gray-50 dark:bg-surface-accent-dark/20 cursor-pointer hover:border-primary/50 transition-colors">
<span class="text-sm font-medium text-gray-700 dark:text-gray-300">Enable Mailchimp Sync</span>
<div class="relative inline-flex items-center cursor-pointer">
<input class="sr-only peer" type="checkbox" value=""/>
<div class="w-9 h-5 bg-gray-200 peer-focus:outline-none rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-primary"></div>
</div>
</label>
<label class="flex items-center justify-between p-3 border border-border-light dark:border-border-dark rounded-lg bg-gray-50 dark:bg-surface-accent-dark/20 cursor-pointer hover:border-primary/50 transition-colors">
<span class="text-sm font-medium text-gray-700 dark:text-gray-300">Enable Google Analytics</span>
<div class="relative inline-flex items-center cursor-pointer">
<input checked="" class="sr-only peer" type="checkbox" value=""/>
<div class="w-9 h-5 bg-gray-200 peer-focus:outline-none rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-primary"></div>
</div>
</label>
</div>
</div>
<div class="md:col-span-2 pt-2">
<h4 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-3 flex items-center gap-2">
<span class="material-symbols-outlined text-gray-400">search_check</span> SEO Defaults
                            </h4>
<div class="space-y-3">
<div>
<label class="block text-xs text-gray-500 mb-1">Default Meta Title</label>
<input class="w-full bg-transparent border-border-light dark:border-border-dark rounded-lg text-sm focus:border-primary focus:ring-primary dark:text-white dark:bg-surface-accent-dark/50" placeholder="e.g. Luxury Attar &amp; Perfumes | Hirah Attar" type="text"/>
</div>
<div>
<label class="block text-xs text-gray-500 mb-1">Default Meta Description</label>
<textarea class="w-full bg-transparent border-border-light dark:border-border-dark rounded-lg text-sm focus:border-primary focus:ring-primary dark:text-white dark:bg-surface-accent-dark/50 resize-none h-20" placeholder="Brief description for search engines..."></textarea>
</div>
</div>
</div>
<div class="md:col-span-2 flex justify-end pt-4 border-t border-border-light dark:border-border-dark mt-2">
<button class="bg-primary text-white font-medium py-2 px-6 rounded-lg hover:bg-primary-dark transition-colors text-sm shadow-md shadow-primary/20 flex items-center gap-2">
<span class="material-symbols-outlined text-[18px]">save</span>
                                Save Changes
                            </button>
</div>
</div>
</section>
<section class="bg-surface-light dark:bg-surface-dark rounded-xl border border-border-light dark:border-border-dark shadow-sm hover:shadow-md transition-shadow duration-300 overflow-hidden">
<div class="p-6 border-b border-border-light dark:border-border-dark bg-gray-50/50 dark:bg-surface-accent-dark/30 flex items-center gap-3">
<span class="material-symbols-outlined text-primary">settings_system_daydream</span>
<h3 class="font-display font-bold text-gray-900 dark:text-white text-lg">System Preferences</h3>
</div>
<div class="p-6 space-y-6">
<div>
<h4 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">Interface Theme</h4>
<div class="grid grid-cols-3 gap-4">
<label class="cursor-pointer">
<input class="peer sr-only" name="theme" type="radio"/>
<div class="flex flex-col items-center justify-center p-3 rounded-lg border border-border-light dark:border-border-dark peer-checked:border-primary peer-checked:bg-primary/5 hover:bg-gray-50 dark:hover:bg-surface-accent-dark transition-all">
<span class="material-symbols-outlined mb-1 text-gray-500 peer-checked:text-primary">light_mode</span>
<span class="text-xs font-medium text-gray-600 dark:text-gray-400 peer-checked:text-primary">Light</span>
</div>
</label>
<label class="cursor-pointer">
<input checked="" class="peer sr-only" name="theme" type="radio"/>
<div class="flex flex-col items-center justify-center p-3 rounded-lg border border-border-light dark:border-border-dark peer-checked:border-primary peer-checked:bg-primary/5 hover:bg-gray-50 dark:hover:bg-surface-accent-dark transition-all">
<span class="material-symbols-outlined mb-1 text-gray-500 peer-checked:text-primary">dark_mode</span>
<span class="text-xs font-medium text-gray-600 dark:text-gray-400 peer-checked:text-primary">Dark</span>
</div>
</label>
<label class="cursor-pointer">
<input class="peer sr-only" name="theme" type="radio"/>
<div class="flex flex-col items-center justify-center p-3 rounded-lg border border-border-light dark:border-border-dark peer-checked:border-primary peer-checked:bg-primary/5 hover:bg-gray-50 dark:hover:bg-surface-accent-dark transition-all">
<span class="material-symbols-outlined mb-1 text-gray-500 peer-checked:text-primary">settings_brightness</span>
<span class="text-xs font-medium text-gray-600 dark:text-gray-400 peer-checked:text-primary">System</span>
</div>
</label>
</div>
</div>
<div class="border-t border-border-light dark:border-border-dark pt-6">
<h4 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">Notification Alerts</h4>
<div
  class="space-y-4"
  x-data="adminNotificationSettings()"
  x-init="loadSettings()"
>

  <!-- Notification Email -->
  <div>
    <label class="block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1">
      Notification Email
    </label>
    <input
      type="email"
      x-model="form.notificationEmail"
      class="w-full rounded-lg border border-border-light dark:border-border-dark bg-transparent px-3 py-2 text-sm focus:border-primary focus:ring-primary"
      placeholder="admin@example.com"
    />
  </div>

  <!-- WhatsApp Number -->
  <label class="block text-sm font-semibold mb-1">
    WhatsApp Number (Meta-managed)
  </label>
  
  <input
    type="text"
    x-model="settings.whatsappNumber"
    disabled
    class="w-full bg-gray-100 dark:bg-gray-700 cursor-not-allowed opacity-70 rounded-lg"
  />
  
  <p class="text-xs mt-1 opacity-60">
    This number is managed via Meta WhatsApp Business and cannot be edited here.
  </p>



  <!-- Channel Toggles -->
  <div class="space-y-2 pt-2">
    <label class="flex items-center gap-3">
      <input type="checkbox" x-model="form.channels.email" />
      <span class="text-sm">Email Notifications</span>
    </label>

    <label class="flex items-center gap-3">
      <input type="checkbox" x-model="form.channels.whatsapp" />
      <span class="text-sm">WhatsApp Notifications</span>
    </label>

  
  </div>

  <!-- Save Button -->
  <div class="pt-4">
    <button
      @click="saveSettings"
      class="px-4 py-2 rounded-lg bg-primary text-white text-sm font-medium hover:bg-primary/90 transition"
    >
      Save Notification Settings
    </button>
  </div>

</div>
<script>
  function adminNotificationSettings() {
    return {
      form: {
        notificationEmail: "",
        whatsappNumber: "",
        smsNumber: "",
        channels: {
          email: true,
          whatsapp: true,
          sms: false
        }
      },
  
      async loadSettings() {
        try {
          const token = localStorage.getItem("token");
  
          const res = await fetch(
            "https://perfume-store-production.up.railway.app/api/admin/settings",
            {
              headers: {
                Authorization: `Bearer ${token}`
              }
            }
          );
  
          const data = await res.json();
          if (data.success) {
            this.form = data.settings;
          }
        } catch (e) {
          console.error("Failed to load admin settings", e);
        }
      },
  
      async saveSettings() {
        try {
          const token = localStorage.getItem("token");
  
          const res = await fetch(
            "https://perfume-store-production.up.railway.app/api/admin/settings",
            {
              method: "PUT",
              headers: {
                "Content-Type": "application/json",
                Authorization: `Bearer ${token}`
              },
              body: JSON.stringify(this.form)
            }
          );
  
          const data = await res.json();
          if (!data.success) throw new Error();
  
          window.dispatchEvent(new CustomEvent("modal", {
            detail: {
              title: "Success",
              message: "Notification settings updated successfully",
              type: "success"
            }
          }));
        } catch (e) {
          window.dispatchEvent(new CustomEvent("modal", {
            detail: {
              title: "Error",
              message: "Failed to update notification settings",
              type: "error"
            }
          }));
        }
      }
    };
  }
  </script>
</div>
<div class="border-t border-border-light dark:border-border-dark pt-6">
<h4 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">Data Export Automation</h4>
<div class="flex items-center justify-between gap-4 p-4 border border-border-light dark:border-border-dark rounded-lg bg-gray-50/50 dark:bg-surface-accent-dark/20">
<div class="flex items-center gap-3">
<div class="relative inline-flex items-center cursor-pointer">
<input class="sr-only peer" type="checkbox" value=""/>
<div class="w-9 h-5 bg-gray-200 peer-focus:outline-none rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-primary"></div>
</div>
<div class="text-sm">
<p class="font-medium text-gray-900 dark:text-white">Schedule Daily Reports</p>
<p class="text-xs text-gray-500">Auto-email CSV exports</p>
</div>
</div>
<select class="bg-transparent border-border-light dark:border-border-dark rounded-md text-xs focus:border-primary focus:ring-primary dark:text-gray-300 dark:bg-surface-accent-dark">
<option>Daily</option>
<option>Weekly</option>
<option>Monthly</option>
</select>
</div>
</div>
<div class="border-t border-border-light dark:border-border-dark pt-6">
<div class="flex items-center justify-between">
<div>
<h4 class="text-sm font-medium text-gray-700 dark:text-gray-300">API Access</h4>
<p class="text-xs text-gray-500 mt-1">Manage keys for external integrations</p>
</div>
<button class="px-3 py-2 text-xs font-medium text-primary border border-primary rounded-lg hover:bg-primary/5 transition-colors flex items-center gap-2">
<span class="material-symbols-outlined text-[16px]">key</span>
                                Manage API Keys
                            </button>
</div>
</div>
</div>
</section>
<section class="rounded-xl border border-red-200 dark:border-red-900/50 bg-red-50/30 dark:bg-red-900/10 overflow-hidden">
<div class="p-6 border-b border-red-100 dark:border-red-900/30 flex items-center gap-3">
<span class="material-symbols-outlined text-red-500">warning</span>
<h3 class="font-display font-bold text-red-700 dark:text-red-400 text-lg">Danger Zone</h3>
</div>
<div class="p-6 space-y-6">
<div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-4">
<div class="text-sm text-gray-600 dark:text-gray-400">
<p><strong>Reset Admin Preferences:</strong> Revert all settings to default factory values.</p>
<p class="mt-1"><strong>Disable Account:</strong> Temporarily suspend this admin access.</p>
</div>
<div class="flex flex-col sm:flex-row gap-3 w-full md:w-auto">
<button class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-transparent border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-surface-accent-dark transition-colors">
                                    Reset Prefs
                                </button>
<button class="px-4 py-2 text-sm font-medium text-white bg-red-600 hover:bg-red-700 rounded-lg shadow-sm transition-colors">
                                    Disable Account
                                </button>
</div>
</div>
<div class="border-t border-red-200 dark:border-red-900/30 pt-6">
<h4 class="font-bold text-red-700 dark:text-red-400 text-sm mb-2">Database Operations</h4>
<p class="text-xs text-gray-600 dark:text-gray-400 mb-4">Create a full snapshot of your data or restore from a previous point. Restoring will overwrite current data.</p>
<div class="flex gap-3">
<button class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-surface-accent-dark/50 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-surface-accent-dark transition-colors flex items-center gap-2">
<span class="material-symbols-outlined text-[18px]">backup</span>
                                    Initiate Backup
                                </button>
<button class="px-4 py-2 text-sm font-medium text-red-600 dark:text-red-400 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-900/50 rounded-lg hover:bg-red-100 dark:hover:bg-red-900/30 transition-colors flex items-center gap-2">
<span class="material-symbols-outlined text-[18px]">restore</span>
                                    Restore from Backup
                                </button>
</div>
</div>
</div>
</section>
</div>
</div>
</main>
</div>




  </div>
</main>





<!-- ORDER DETAILS – ADVANCED VIEW (READ ONLY) -->
<div x-show="$store.orders.orderDetailsModalOpen" x-cloak>

  <!-- Overlay -->
  <div
    class="fixed inset-0 bg-black/60 z-40"
    @click="$store.orders.closeDetails()">
  </div>

  <!-- Drawer -->
  <div
    class="fixed inset-y-0 right-0 w-full max-w-4xl bg-white dark:bg-[#1a2632] border-l border-gray-200 dark:border-[#3b4754] shadow-2xl z-50 overflow-y-auto">

    <!-- Header -->
    <div class="flex items-center justify-between p-6 border-b border-gray-200 dark:border-[#3b4754]">
      <div>
        <h2 class="text-2xl font-bold text-gray-900 dark:text-white">
          Order Overview
        </h2>
        <p class="text-sm text-gray-500">
          <span x-text="$store.orders.selectedOrder?.id"></span>
        </p>
      </div>

      <button @click="$store.orders.closeDetails()">
        <span class="material-symbols-outlined text-2xl">close</span>
      </button>
    </div>

    <!-- Content -->
    <div
      class="p-6 space-y-10"
      x-show="$store.orders.selectedOrder"
    >

<!-- STATUS BAR -->
<div class="flex flex-wrap gap-3">

 <!-- ORDER STATUS -->
<span
class="px-4 py-1 rounded-full text-xs font-bold uppercase"
:class="{
  'bg-yellow-100 text-yellow-800': $store.orders.selectedOrder.orderStatus === 'pending',
  'bg-teal-100 text-teal-800': $store.orders.selectedOrder.orderStatus === 'confirmed',
  'bg-blue-100 text-blue-800': $store.orders.selectedOrder.orderStatus === 'shipped',
  'bg-green-100 text-green-800': $store.orders.selectedOrder.orderStatus === 'delivered',
  'bg-red-100 text-red-800': ['cancelled','returned'].includes(
    $store.orders.selectedOrder.orderStatus
  )
}"
x-text="$store.orders.selectedOrder.orderStatus">
</span>


<!-- PAYMENT METHOD -->
<span
  class="px-4 py-1 rounded-full text-xs font-bold uppercase"
  :class="{
    'bg-gray-100 text-gray-700': $store.orders.selectedOrder.paymentMethod === null,
    'bg-purple-100 text-purple-800': $store.orders.selectedOrder.paymentMethod === 'cash',
    'bg-indigo-100 text-indigo-800': $store.orders.selectedOrder.paymentMethod === 'online'
  }"
  x-text="
    $store.orders.selectedOrder.paymentMethod === null
      ? 'WAITING'
      : $store.orders.selectedOrder.paymentMethod === 'cash'
      ? 'COD'
      : 'ONLINE'
  ">
</span>



  <!-- PAYMENT STATUS -->
  <span class="px-4 py-1 rounded-full text-xs font-semibold bg-gray-100 text-gray-700">
    Payment:
    <span x-text="$store.orders.selectedOrder.paymentStatus"></span>
  </span>

</div>


      <!-- CUSTOMER PROFILE -->
<!-- CUSTOMER PROFILE -->
<section class="bg-gray-50 dark:bg-[#283039] rounded-xl p-6">
  <h3 class="text-lg font-semibold mb-4">Customer Information</h3>

  <!-- ================= HEADER ROW ================= -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-6 items-start">

    <!-- Avatar -->
    <div class="flex items-center gap-4">
      <div class="relative">

        <!-- REAL AVATAR -->
        <template x-if="
          $store.orders.selectedOrder.customer.avatar &&
          $store.orders.selectedOrder.customer.avatar.trim() !== ''
        ">
          <img
            :src="$store.orders.selectedOrder.customer.avatar"
            class="w-14 h-14 rounded-full object-cover border"
            alt="User Avatar"
            @error="$event.target.remove()"
          />
        </template>

        <!-- ACCOUNT NAME LETTER -->
        <template
          x-if="!$store.orders.selectedOrder.customer.avatar &&
                $store.orders.selectedOrder.customer.accountName">
          <div
            class="w-14 h-14 rounded-full bg-gray-200 flex items-center justify-center
                   text-xl font-bold uppercase text-gray-700 border"
            x-text="$store.orders.selectedOrder.customer.accountName.trim()[0]">
          </div>
        </template>

        <!-- EMAIL LETTER -->
        <template
          x-if="!$store.orders.selectedOrder.customer.avatar &&
                !$store.orders.selectedOrder.customer.accountName &&
                $store.orders.selectedOrder.customer.email">
          <div
            class="w-14 h-14 rounded-full bg-gray-200 flex items-center justify-center
                   text-xl font-bold uppercase text-gray-700 border"
            x-text="$store.orders.selectedOrder.customer.email[0]">
          </div>
        </template>

        <!-- GUEST -->
        <template
          x-if="!$store.orders.selectedOrder.customer.avatar &&
                !$store.orders.selectedOrder.customer.accountName &&
                !$store.orders.selectedOrder.customer.email">
          <div class="w-14 h-14 rounded-full bg-gray-200 flex items-center justify-center border">
            <span class="material-symbols-outlined text-gray-600 text-3xl">
              person_off
            </span>
          </div>
        </template>

        <!-- USER / GUEST BADGE -->
        <span
          class="absolute -bottom-1 -right-1 px-2 py-0.5 rounded-full
                 text-[10px] font-bold"
          :class="$store.orders.selectedOrder.customer.email
            ? 'bg-green-100 text-green-700'
            : 'bg-yellow-100 text-yellow-700'"
          x-text="$store.orders.selectedOrder.customer.email ? 'USER' : 'GUEST'">
        </span>
      </div>

      <div class="text-sm">
        <p class="font-semibold"
           x-text="$store.orders.selectedOrder.customer.accountName || 'Guest User'">
        </p>
        <p class="text-xs opacity-60">Account Name</p>
      </div>
    </div>

    <!-- Name + Email -->
    <div class="text-sm space-y-2">
      <div>
        <p class="font-semibold"
           x-text="$store.orders.selectedOrder.customer.name">
        </p>
        <p class="text-xs opacity-60">Customer Entered Name</p>
      </div>

      <div>
        <p class="opacity-80"
           x-text="$store.orders.selectedOrder.customer.email || 'Guest Checkout'">
        </p>
        <p class="text-xs opacity-60">Email</p>
      </div>
    </div>

    <!-- Phone -->
    <div class="text-sm space-y-2">
      <div>
        <p x-text="$store.orders.selectedOrder.customer.phone"></p>
        <p class="text-xs opacity-60">Phone</p>
      </div>
    </div>

  </div>

  <!-- ================= ADDRESS BLOCK (CLEARLY LOWER) ================= -->
  <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-4 text-sm border-t pt-6">

    <!-- Province -->
    <div>
      <p class="font-medium">Province</p>
      <p class="opacity-70"
         x-text="$store.orders.selectedOrder.customer.province || '-'">
      </p>
    </div>

    <!-- Postal Code -->
    <div>
      <p class="font-medium">Postal Code</p>
      <p class="opacity-70"
         x-text="$store.orders.selectedOrder.customer.postalCode || '-'">
      </p>
    </div>

    <!-- District -->
    <div>
      <p class="font-medium">District</p>
      <p class="opacity-70"
         x-text="$store.orders.selectedOrder.customer.district || '-'">
      </p>
    </div>

    <!-- City -->
    <div>
      <p class="font-medium">City</p>
      <p class="opacity-70"
         x-text="$store.orders.selectedOrder.customer.city || '-'">
      </p>
    </div>

    <!-- Address (full width bottom) -->
    <div class="md:col-span-2">
      <p class="font-medium">Address</p>
      <p class="opacity-70"
         x-text="$store.orders.selectedOrder.customer.address || '-'">
      </p>
    </div>

  </div>
</section>

      <!-- ORDER META -->
      <section class="grid grid-cols-1 md:grid-cols-3 gap-4">

     

        <div class="bg-gray-50 dark:bg-[#283039] p-5 rounded-xl">
          <p class="text-xs uppercase opacity-60">Created At</p>
          <p class="font-semibold"
             x-text="$store.orders.selectedOrder.createdAt">
          </p>
        </div>

        <div class="bg-gray-50 dark:bg-[#283039] p-5 rounded-xl">
          <p class="text-xs uppercase opacity-60">Order Total</p>
          <p class="text-xl font-bold">
            LKR
            <span x-text="$store.orders.selectedOrder.total.toFixed(2)"></span>
          </p>
        </div>

      </section>

      <!-- ITEMS -->
      <section>
        <h3 class="text-lg font-semibold mb-3">Items</h3>

        <div class="overflow-x-auto rounded-xl border">
          <table class="w-full text-sm">
            <thead class="bg-gray-100 dark:bg-[#283039]">
              <tr>
                <th class="p-3 text-left">Product</th>
                <th class="p-3 text-center">Size</th>
                <th class="p-3 text-center">Qty</th>
                <th class="p-3 text-right">Price</th>
              </tr>
            </thead>
            <tbody>
              <template
                x-for="item in $store.orders.selectedOrder.items"
                :key="item.name"
              >
                <tr class="border-t">
                  <td class="p-3 font-medium" x-text="item.name"></td>
                  <td class="p-3 text-center" x-text="item.size"></td>
                  <td class="p-3 text-center" x-text="item.qty"></td>
                  <td class="p-3 text-right">
                    LKR
                    <span x-text="(item.unitPrice * item.qty).toFixed(2)"></span>
                  </td>
                </tr>
              </template>
            </tbody>
          </table>
        </div>
      </section>

      <!-- TOTALS -->
     <!-- TOTALS -->
<section class="flex justify-end">
  <div class="w-full md:w-1/3 space-y-2 text-sm">

    <!-- SUBTOTAL -->
    <div class="flex justify-between">
      <span>Subtotal</span>
      <span>
        LKR
        <span x-text="$store.orders.selectedOrder.subtotal.toFixed(2)"></span>
      </span>
    </div>

    <!-- DELIVERY CHARGE -->
    <div class="flex justify-between">
      <span>Delivery Charge</span>
      <span>
        LKR
        <span x-text="$store.orders.selectedOrder.deliveryCharge.toFixed(2)"></span>
      </span>
    </div>

    <!-- LOYALTY DISCOUNT -->
    <div class="flex justify-between text-red-600">
      <span>Loyalty Discount</span>

      <!-- IF DISCOUNT EXISTS -->
      <template
        x-if="
          $store.orders.selectedOrder.loyalty &&
          $store.orders.selectedOrder.loyalty.discount > 0
        "
      >
        <span>
          − LKR
          <span
            x-text="$store.orders.selectedOrder.loyalty.discount.toFixed(2)">
          </span>
        </span>
      </template>

      <!-- IF NO DISCOUNT -->
      <template
        x-if="
          !$store.orders.selectedOrder.loyalty ||
          $store.orders.selectedOrder.loyalty.discount === 0
        "
      >
        <span class="opacity-50">—</span>
      </template>
    </div>

    <!-- TOTAL -->
    <div class="flex justify-between text-lg font-bold border-t pt-2">
      <span>Total</span>
      <span>
        LKR
        <span x-text="$store.orders.selectedOrder.total.toFixed(2)"></span>
      </span>
    </div>

  </div>
</section>


    </div>

    <!-- Footer -->
    <div class="p-6 border-t border-gray-200 dark:border-[#3b4754] flex justify-end">
      <button
        @click="$store.orders.closeDetails()"
        class="px-6 py-2 rounded-lg bg-gray-200 dark:bg-[#283039] text-sm font-medium">
        Close
      </button>
    </div>

  </div>
</div>


<!-- NEW ORDER – CLEAN ADMIN VERSION -->
<div x-show="$store.orders.newOrderModalOpen" x-cloak>

  <!-- Overlay -->
  <div class="fixed inset-0 bg-black/60 z-40"
       @click="$store.orders.closeNewOrder()"></div>

  <!-- Drawer -->
  <div class="fixed inset-y-0 right-0 w-full max-w-2xl
              bg-white dark:bg-[#1a2632]
              border-l border-gray-200 dark:border-[#3b4754]
              shadow-xl z-50 overflow-y-auto">

    <!-- Header -->
    <div class="p-6 border-b flex justify-between items-center">
      <h2 class="text-xl font-bold">Create Manual Order</h2>
      <button @click="$store.orders.closeNewOrder()">
        <span class="material-symbols-outlined">close</span>
      </button>
    </div>

    <div class="p-6 space-y-8">

      <!-- CUSTOMER -->
      <section>
        <h3 class="font-semibold mb-3">Customer Information</h3>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="label">Customer Name</label>
            <input class="input"
              x-model="$store.orders.newOrder.customer.name" />
          </div>

          <div>
            <label class="label">Phone Number</label>
            <input class="input"
              x-model="$store.orders.newOrder.customer.phone" />
          </div>

          <div class="md:col-span-2">
            <label class="label">Shipping Address</label>
            <textarea class="input"
              x-model="$store.orders.newOrder.customer.address"></textarea>
          </div>
        </div>
      </section>

      <!-- ITEMS -->
      <section>
        <h3 class="font-semibold mb-3">Order Items</h3>

        <template x-for="(item, i) in $store.orders.newOrder.items" :key="i">
          <div class="grid grid-cols-1 md:grid-cols-4 gap-3 mb-3">
            <div>
              <label class="label">Product</label>
              <input class="input" x-model="item.name">
            </div>

            <div>
              <label class="label">Qty</label>
              <input type="number" class="input" x-model.number="item.qty">
            </div>

            <div>
              <label class="label">Unit Price</label>
              <input type="number" class="input" x-model.number="item.unitPrice">
            </div>

            <div class="flex items-end">
              <button
                x-show="$store.orders.newOrder.items.length > 1"
                @click="$store.orders.removeItem(i)"
                class="text-danger text-sm">
                Remove
              </button>
            </div>
          </div>
        </template>

        <button
          @click="$store.orders.addItem()"
          class="px-4 py-2 text-sm bg-primary text-white rounded">
          + Add Item
        </button>
      </section>

      <!-- PAYMENT -->
      <section>
        <h3 class="font-semibold mb-3">Payment & Delivery</h3>

        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="label">Payment</label>
            <input class="input" value="Cash on Delivery" disabled>
          </div>

          <div>
            <label class="label">Delivery</label>
            <input class="input" value="Standard Shipping" disabled>
          </div>
        </div>
      </section>

      <!-- NOTES -->
      <section>
        <label class="label">Notes</label>
        <textarea class="input"
          x-model="$store.orders.newOrder.notes"></textarea>
      </section>

    </div>

    <!-- Footer -->
    <div class="p-6 border-t flex justify-end gap-3">
      <button class="btn-secondary"
        @click="$store.orders.closeNewOrder()">Cancel</button>

      <button class="btn-primary"
        @click="$store.orders.saveNewOrder()">Save Order</button>
    </div>

  </div>
</div>
<style>
.label { font-size: 0.875rem; font-weight: 600; margin-bottom: 4px; display: block; }
.input {
  width: 100%;
  padding: 0.5rem 0.75rem;
  border-radius: 0.5rem;
  border: 1px solid #ccc;
}
.btn-primary { background:#c89b3f;color:#fff;padding:.5rem 1rem;border-radius:.5rem }
.btn-secondary { background:#eee;padding:.5rem 1rem;border-radius:.5rem }
</style>




  <!-- CANCEL CONFIRMATION CENTERED MODAL -->
<div x-show="$store.orders.cancelConfirmOpen" x-cloak>

  <!-- Overlay -->
  <div
  x-show="cancelConfirmOpen"
  x-transition.opacity
  x-cloak
  :class="cancelConfirmOpen ? 'pointer-events-auto' : 'pointer-events-none'"
  class="fixed inset-0 bg-black/60 z-40"
  @click="closeDetails()">
</div>


  <!-- Popup -->
  <div
    x-show="$store.orders.cancelConfirmOpen"
    x-transition:enter="transform transition ease-out duration-200"
    x-transition:enter-start="opacity-0 scale-95"
    x-transition:enter-end="opacity-100 scale-100"
    x-transition:leave="transform transition ease-in duration-150"
    x-transition:leave-start="opacity-100 scale-100"
    x-transition:leave-end="opacity-0 scale-95"
    class="fixed z-[300] w-full max-w-md p-6 bg-white dark:bg-[#1a2632] rounded-xl shadow-xl mx-auto left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2"
    @click.outside="$store.orders.closeCancel()"
  >
    <div class="text-center">
      <span class="material-symbols-outlined text-5xl text-yellow-500">warning</span>
      <h3 class="mt-4 text-lg font-medium text-gray-900 dark:text-white">Are you sure?</h3>
      <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">
        You are about to cancel this order.
      </p>
    </div>

    <div class="mt-6 flex justify-center gap-4">
      <button
        @click="$store.orders.closeCancel()"
        class="px-5 py-2.5 text-sm font-medium text-gray-900 bg-white border border-gray-200 rounded-lg hover:bg-gray-100 dark:bg-[#283039] dark:text-gray-300 dark:border-[#3b4754]"
      >
        No, keep order
      </button>

      <button
        @click="$store.orders.cancelOrder()"
        class="px-5 py-2.5 text-sm font-medium text-white bg-red-600 rounded-lg hover:bg-red-700"
      >
        Yes, cancel it
      </button>
    </div>
  </div>

</div>

<div
    x-show="cancelConfirmOpen"
    x-cloak
    class="fixed inset-0 z-[70] flex items-center justify-center bg-black/60"
    x-transition.opacity
>
    <div @click.outside="cancelConfirmOpen = false" class="w-full max-w-md bg-white dark:bg-[#1a2632] rounded-xl p-6 shadow-lg">

        <div class="text-center">
            <span class="material-symbols-outlined text-5xl text-yellow-500">warning</span>

            <h3 class="mt-4 text-lg font-semibold text-gray-900 dark:text-white">Discard changes?</h3>

            <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">
                You have unsaved changes. Closing this will discard them.
            </p>
        </div>

        <div class="mt-6 flex justify-center gap-4">
            <button 
                @click="cancelConfirmOpen = false"
                class="px-5 py-2 text-sm bg-white border border-gray-200 rounded-lg dark:bg-[#283039] dark:border-[#3b4754]"
            >
                Continue Editing
            </button>

            <button 
                @click="addUserOpen = false; userPanelOpen = false; cancelConfirmOpen=false"
                class="px-5 py-2 text-sm bg-red-600 text-white rounded-lg"
            >
                Discard
            </button>
        </div>

    </div>
</div>

<div
  x-show="$store.userModals.viewOpen"
  x-cloak
  class="fixed inset-0 z-[90] flex"
>
  <!-- Overlay -->
  <div
  class="absolute inset-0 bg-black/20 "
  @click="$store.userModals.viewOpen = false">
</div>


  <!-- Panel -->
  <div
    class="ml-auto w-full max-w-lg h-full bg-white dark:bg-[#111827]
           border-l border-gray-200 dark:border-[#1f2937]
           p-6 overflow-y-auto">

    <!-- Header -->
    <div class="flex items-center justify-between mb-6">
      <h2 class="text-xl font-semibold text-gray-900 dark:text-white">
        User Details
      </h2>

      <button
        @click="$store.userModals.viewOpen = false"
        class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-[#1f2937]">
        <span class="material-symbols-outlined text-gray-500 dark:text-gray-400">
          close
        </span>
      </button>
    </div>

    <!-- Content -->
    <template x-if="$store.userModals.activeUser">
      <div class="space-y-6">

        <!-- Avatar + Name -->
        <div class="flex items-center gap-4">
          <div
            class="h-16 w-16 rounded-full bg-cover bg-center"
            :style="`background-image:url(${$store.userModals.activeUser.avatar || ''})`">
          </div>

          <div>
            <p class="text-lg font-semibold text-gray-900 dark:text-white"
               x-text="$store.userModals.activeUser.name">
            </p>
            <p class="text-sm text-gray-500 dark:text-gray-400"
               x-text="$store.userModals.activeUser.email">
            </p>
          </div>
        </div>

        <!-- Info Grid -->
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">

          <div>
            <p class="text-xs uppercase tracking-wide text-gray-500">
              Phone
            </p>
            <p class="mt-1 text-sm text-gray-900 dark:text-gray-100"
               x-text="$store.userModals.activeUser.phone || '—'">
            </p>
          </div>

          <div>
            <p class="text-xs uppercase tracking-wide text-gray-500">
              Address
            </p>
            <p class="mt-1 text-sm text-gray-900 dark:text-gray-100"
               x-text="$store.userModals.activeUser.address || '—'">
            </p>
          </div>
<!-- User Entered Details -->
<div class="grid grid-cols-1 sm:grid-cols-2 gap-6">

  <div>
    <p class="text-xs uppercase tracking-wide text-gray-500">
      Province
    </p>
    <p class="mt-1 text-sm text-gray-900 dark:text-gray-100"
       x-text="$store.userModals.activeUser.profileDetails?.province || '—'">
    </p>
  </div>

  <div>
    <p class="text-xs uppercase tracking-wide text-gray-500">
      District
    </p>
    <p class="mt-1 text-sm text-gray-900 dark:text-gray-100"
       x-text="$store.userModals.activeUser.profileDetails?.district || '—'">
    </p>
  </div>

  <div>
    <p class="text-xs uppercase tracking-wide text-gray-500">
      City
    </p>
    <p class="mt-1 text-sm text-gray-900 dark:text-gray-100"
       x-text="$store.userModals.activeUser.profileDetails?.city || '—'">
    </p>
  </div>

  <div>
    <p class="text-xs uppercase tracking-wide text-gray-500">
      Postal Code
    </p>
    <p class="mt-1 text-sm text-gray-900 dark:text-gray-100"
       x-text="$store.userModals.activeUser.profileDetails?.postalCode || '—'">
    </p>
  </div>

</div>

        </div>

        <!-- Role + Status -->
        <div class="flex flex-wrap gap-3 pt-2">

          <!-- ROLE BADGE -->
          <span
            class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold"
            :class="{
              'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300':
                $store.userModals.activeUser.role === 'admin',


              'bg-gray-200 text-gray-800 dark:bg-gray-700 dark:text-gray-300':
                $store.userModals.activeUser.role === 'user'
            }"
            x-text="$store.userModals.activeUser.role.charAt(0).toUpperCase() +
                    $store.userModals.activeUser.role.slice(1)">
          </span>

          <!-- STATUS BADGE -->
          <span
            class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold"
            :class="{
              'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300':
                $store.userModals.activeUser.status === 'active',

              'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300':
                $store.userModals.activeUser.status === 'suspended'
            }"
            x-text="$store.userModals.activeUser.status === 'active'
              ? 'Active'
              : 'Suspended'">
          </span>
<!-- LOYALTY BADGE -->
<span
  class="inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold"
  :class="window.loyaltyBadgeConfig($store.userModals.activeUser.loyaltyTier).color"
  >
  <span
    class="material-symbols-outlined text-[14px]"
    x-text="loyaltyBadgeConfig($store.userModals.activeUser.loyaltyTier).icon">
  </span>

  <span
    x-text="loyaltyBadgeConfig($store.userModals.activeUser.loyaltyTier).label">
  </span>
</span>

        </div>

        <!-- Notes -->
        <div>
          <p class="text-xs uppercase tracking-wide text-gray-500 mb-1">
            Admin Notes
          </p>
          <div
            class="rounded-lg border border-gray-200 dark:border-[#1f2937]
                   bg-gray-50 dark:bg-[#0f172a]
                   p-3 text-sm text-gray-800 dark:text-gray-200"
            x-text="$store.userModals.activeUser.notes || 'No notes added.'">
          </div>
        </div>

      </div>
    </template>

  </div>
</div>



<div 
    x-show="$store.userModals.deleteOpen"
    x-cloak
    class="fixed inset-0 z-[99] flex items-center justify-center bg-black/60 backdrop-blur-sm"
    x-transition.opacity
>
    <div class="w-full max-w-md rounded-xl bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-800 shadow-xl p-6">

        <div class="flex gap-4 items-start">
            <div class="h-12 w-12 flex items-center justify-center rounded-full bg-red-100 dark:bg-red-900/50">
                <span class="material-symbols-outlined text-red-600 dark:text-red-400">warning</span>
            </div>

            <div>
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Delete user?</h3>
                <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">
                    This action cannot be undone.
                </p>
            </div>
        </div>

        <div class="flex justify-end gap-4 mt-6">
            <button @click="$store.userModals.deleteOpen=false"
                    class="px-4 py-2 border rounded-lg dark:border-gray-700">Cancel</button>

            <button @click="$store.userModals.confirmDelete()"
                    class="px-4 py-2 bg-red-600 text-white rounded-lg">Delete</button>
        </div>

    </div>
</div>


<div 
    x-show="$store.userModals.addOpen"
    x-cloak
    class="fixed inset-0 z-[90] flex"
>
    <div class="absolute inset-0 bg-black/60"
         @click="$store.userModals.addOpen = false"
         x-transition.opacity></div>

    <div 
    class="relative ml-auto w-full max-w-lg h-full flex flex-col min-h-0 bg-white dark:bg-gray-900/95 
    border-l border-gray-200 dark:border-gray-800 shadow-xl backdrop-blur-sm
             transition-transform duration-300 ease-in-out"
      x-transition:enter="translate-x-0"
      x-transition:enter-start="translate-x-full"
      x-transition:leave="translate-x-full"
    >

        <div class="flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-800">
            <h2 class="text-xl font-semibold text-gray-900 dark:text-white">Add New User</h2>
            <button @click="$store.userModals.addOpen = false" class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800">
                <span class="material-symbols-outlined text-gray-500 dark:text-gray-300">close</span>
            </button>
        </div>

        <!-- BODY (SCROLL AREA) -->
        <div class="flex-1min-h-0 overflow-y-auto p-6 space-y-6">
            
            <div>
                <label class="text-sm font-medium text-gray-700 dark:text-gray-300">Full Name</label>
                <input class="mt-1 w-full rounded-md bg-white dark:bg-gray-800/50 border-gray-300 dark:border-gray-700"
                       type="text"
                       x-model="$store.userModals.newUser.name">
            </div>

            <div>
                <label class="text-sm font-medium text-gray-700 dark:text-gray-300">Email</label>
                <input class="mt-1 w-full rounded-md bg-white dark:bg-gray-800/50 border-gray-300 dark:border-gray-700"
                       type="email"
                       x-model="$store.userModals.newUser.email">
            </div>

            <div>
                <label class="text-sm font-medium text-gray-700 dark:text-gray-300">Phone</label>
                <input class="mt-1 w-full rounded-md bg-white dark:bg-gray-800/50 border-gray-300 dark:border-gray-700"
                       type="tel"
                       x-model="$store.userModals.newUser.phone">
            </div>

            <div>
                <label class="text-sm font-medium text-gray-700 dark:text-gray-300">Password</label>
                <input class="mt-1 w-full rounded-md bg-white dark:bg-gray-800/50 border-gray-300 dark:border-gray-700"
                       type="password"
                       x-model="$store.userModals.newUser.password">
            </div>

            <div>
  <label class="text-sm font-medium text-gray-700 dark:text-gray-300">Address</label>
  <input
    class="mt-1 w-full rounded-md bg-white dark:bg-gray-800/50 border-gray-300 dark:border-gray-700"
    type="text"
    x-model="$store.userModals.newUser.address"
  >
</div>

<div>
  <label class="text-sm font-medium text-gray-700 dark:text-gray-300">Admin Notes</label>
  <textarea
    class="mt-1 w-full rounded-md bg-white dark:bg-gray-800/50 border-gray-300 dark:border-gray-700"
    rows="3"
    x-model="$store.userModals.newUser.notes"
  ></textarea>
</div>



            <div>
                <label class="text-sm font-medium text-gray-700 dark:text-gray-300">Role</label>
                <select class="mt-1 w-full rounded-md bg-white dark:bg-gray-800/50 border-gray-300 dark:border-gray-700"
                        x-model="$store.userModals.newUser.role">
                    <option>User</option>
                    <option>Admin</option>
                </select>
            </div>

            <div>
                <label class="text-sm font-medium text-gray-700 dark:text-gray-300">Status</label>
                <select class="mt-1 w-full rounded-md bg-white dark:bg-gray-800/50 border-gray-300 dark:border-gray-700"
                        x-model="$store.userModals.newUser.status">
                    <option>Active</option>
                    <option>Suspended</option>
                </select>
            </div>

        </div>
        <div>
  <label class="text-sm font-medium text-gray-700 dark:text-gray-300">Admin Notes</label>
  <textarea
    class="mt-1 w-full rounded-md bg-white dark:bg-gray-800/50 border-gray-300 dark:border-gray-700"
    rows="3"
    x-model="$store.userModals.newUser.notes"
  ></textarea>
</div>
        <!-- FOOTER -->
        <div class="p-6 border-t border-gray-200 dark:border-gray-800 flex justify-end gap-4">
            <button @click="$store.userModals.addOpen=false"
                    class="px-4 py-2 border rounded-lg dark:border-gray-700">Cancel</button>

            <button @click="$store.userModals.saveNewUser()"
                    class="px-4 py-2 bg-primary text-white rounded-lg">Save</button>
        </div>

    </div>
</div>

<div
  x-show="$store.userModals.editOpen"
  x-cloak
  class="fixed inset-0 z-[90] flex"
>
  <!-- Overlay -->
  <div class="absolute inset-0 bg-black/60"
       @click="$store.userModals.editOpen = false">
  </div>

  <!-- Panel -->
  <div
    class="relative ml-auto w-full max-w-lg h-full flex flex-col bg-white dark:bg-gray-900
           border-l border-gray-200 dark:border-gray-800 shadow-xl">

    <!-- Header -->
    <div class="flex items-center justify-between p-6 border-b">
      <h2 class="text-xl font-semibold">Edit User</h2>
      <button @click="$store.userModals.editOpen=false"
              class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800">
        ✕
      </button>
    </div>

    <!-- Body -->
    <div class="flex-1 overflow-y-auto p-6 space-y-6">

      <!-- Avatar -->
      <div class="flex items-center gap-4">
        <div class="relative">
          <div class="h-20 w-20 rounded-full bg-cover bg-center"
               :style="`background-image:url(${$store.userModals.activeUser.avatar || ''})`">
          </div>

     
        </div>

        <div>
          <input class="text-xl font-bold bg-transparent border-0 focus:ring-0"
                 x-model="$store.userModals.activeUser.name">
          <p class="text-sm text-gray-500"
             x-text="$store.userModals.activeUser.email"></p>
        </div>
      </div>

      <!-- Name / Phone -->
      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="text-sm">Full Name</label>
          <input class="w-full rounded-md border p-2"
                 x-model="$store.userModals.activeUser.name">
        </div>

        <div>
          <label class="text-sm">Phone</label>
          <input class="w-full rounded-md border p-2"
                 x-model="$store.userModals.activeUser.phone">
        </div>
      </div>

      <!-- Address -->
      <div>
        <label class="text-sm">Address</label>
        <input class="w-full rounded-md border p-2"
               x-model="$store.userModals.activeUser.address">
      </div>

      <!-- Role + Status -->
      <div class="grid grid-cols-2 gap-4">

        <!-- ROLE -->
        <div>
          <label class="text-sm">Role</label>

          <template x-if="$store.userModals.activeUser.role === 'admin'">
            <span class="inline-block mt-2 px-3 py-1 rounded-full text-xs bg-blue-100 text-blue-800">
              Admin (locked)
            </span>
          </template>

          <template x-if="$store.userModals.activeUser.role !== 'admin'">
            <select class="w-full rounded-md border p-2"
                    x-model="$store.userModals.activeUser.role">
              <option value="user">User</option>
            </select>
          </template>
        </div>

        <!-- STATUS -->
<div>
  <label class="text-sm">Status</label>

  <button
  type="button"
  :disabled="$store.userModals.activeUser.status === 'pending'"
  class="mt-2 relative inline-flex h-6 w-11 rounded-full transition"
  :class="
    $store.userModals.activeUser.status === 'pending'
      ? 'bg-gray-300 cursor-not-allowed'
      : $store.userModals.activeUser.status === 'active'
        ? 'bg-green-500'
        : 'bg-yellow-500'
  "
  @click="
    if ($store.userModals.activeUser.status !== 'pending') {
      $store.userModals.activeUser.status =
        $store.userModals.activeUser.status === 'active'
          ? 'suspended'
          : 'active'
    }
  "
>
<p
  class="text-xs mt-1 text-gray-500"
  x-show="$store.userModals.activeUser.status === 'pending'"
>
  Pending users cannot be modified until verified.
</p>

    <span
      class="inline-block h-5 w-5 bg-white rounded-full transform transition"
      :class="$store.userModals.activeUser.status === 'active'
        ? 'translate-x-5'
        : 'translate-x-0'"
    ></span>
  </button>

  <p class="text-xs mt-1"
     x-text="$store.userModals.activeUser.status === 'active'
       ? 'Active'
       : 'Suspended'">
  </p>
</div>


      </div>
<!-- Loyalty Settings -->
<div class="border-t pt-4 space-y-4">

  <p class="text-sm font-semibold text-gray-700 dark:text-gray-300">
    Loyalty Settings
  </p>

  <!-- Loyalty Mode -->
  <div>
    <label class="text-sm">Loyalty Mode</label>
    <select
      class="w-full rounded-md border p-2 mt-1"
      x-model="$store.userModals.activeUser.loyaltyMode"
    >
      <option value="auto">Auto (System)</option>
      <option value="manual">Manual (Admin)</option>
    </select>
  </div>

  <!-- Loyalty Tier -->
  <div>
    <label class="text-sm">Loyalty Tier</label>
    <select
      class="w-full rounded-md border p-2 mt-1"
      x-model="$store.userModals.activeUser.loyaltyTier"
      :disabled="$store.userModals.activeUser.loyaltyMode !== 'manual'"
      :class="$store.userModals.activeUser.loyaltyMode !== 'manual'
        ? 'bg-gray-100 text-gray-400 cursor-not-allowed'
        : ''"
    >
      <option value="bronze">Bronze</option>
      <option value="silver">Silver</option>
      <option value="gold">Gold</option>
      <option value="platinum">Platinum</option>
      <option value="diamond">Diamond</option>
    </select>

    <p
      class="text-xs text-gray-500 mt-1"
      x-show="$store.userModals.activeUser.loyaltyMode !== 'manual'"
    >
      Tier is automatically calculated by total spending.
    </p>
  </div>

</div>

      <!-- Notes -->
      <div>
        <label class="text-sm">Admin Notes</label>
        <textarea class="w-full rounded-md border p-2"
                  rows="3"
                  x-model="$store.userModals.activeUser.notes"></textarea>
      </div>

    </div>

    <!-- Footer -->
    <div class="p-6 border-t flex justify-end gap-4">
      <button @click="$store.userModals.editOpen=false"
              class="px-4 py-2 border rounded">
        Cancel
      </button>

      <button @click="$store.userModals.saveEdit()"
              class="px-4 py-2 bg-primary text-white rounded">
        Save Changes
      </button>
    </div>

  </div>
</div>




<script>
document.addEventListener('alpine:init', () => {
  Alpine.store('userModals', {
    viewOpen: false,
    editOpen: false,
    addOpen: false,
    deleteOpen: false,

    activeUser: null,
    newUser: null,

    /* ---------- OPENERS ---------- */

    openView(user) {
  this.activeUser = {
    _id: user._id || user.id,

    name: user.name,
    email: user.email,

    phone: user.phone || '',
    address: user.address || '',
    notes: user.notes || '',

    role: user.role || 'user',
    status: user.status || 'active',

    avatar: user.avatar || '',
    profileDetails: {
      province: user.profileDetails?.province || "",
      district: user.profileDetails?.district || "",
      city: user.profileDetails?.city || "",
      postalCode: user.profileDetails?.postalCode || ""
    }
  };

  this.viewOpen = true;
}
,

openEdit(user) {
  this.activeUser = {
    ...user,
    _id: user._id || user.id,
    role: user.role || 'user',
    status: user.status || 'active'
  };
  this.editOpen = true;
}
,
    openDelete(user) {
      this.activeUser = {
        ...user,
        _id: user._id || user.id
      };
      this.deleteOpen = true;
    },

    openAdd() {
  this.newUser = {
    name: '',
    email: '',
    phone: '',
    address: '',
    notes: '',
    password: '',
    role: 'user',
    status: 'active'
  };
  this.addOpen = true;
},

    /* ---------- ACTIONS ---------- */

    async saveEdit() {
  const u = this.activeUser;

  const res = await fetch(
    `https://perfume-store-production.up.railway.app/api/users/${u._id}`,
    {
      method: "PUT",
      headers: {
        "Content-Type": "application/json",
        Authorization: `Bearer ${localStorage.getItem("token")}`
      },
      body: JSON.stringify({
        name: u.name,
        phone: u.phone,
        address: u.address,
        role: u.role,
        status: u.status, // ✅ active | suspended
        notes: u.notes,
          // 🔹 ADD THESE (REQUIRED)
  loyaltyMode: u.loyaltyMode,
  loyaltyTier: u.loyaltyTier
      })
    }
  );

  const data = await res.json();
  if (!res.ok) {
    alert(data.message || "Update failed");
    return;
  }

  this.editOpen = false;
  location.reload();
}
,
    async confirmDelete() {
      if (!this.activeUser?._id) return;

      const res = await fetch(
        `https://perfume-store-production.up.railway.app/api/users/${this.activeUser._id}`,
        {
          method: "DELETE",
          headers: {
            Authorization: `Bearer ${localStorage.getItem("token")}`
          }
        }
      );

      if (!res.ok) {
        alert("Failed to delete user");
        return;
      }

      this.deleteOpen = false;
      this.activeUser = null;
      location.reload(); // simple & safe for now
    },

    async saveNewUser() {
      const res = await fetch(
        "https://perfume-store-production.up.railway.app/api/admin/users",
        {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            Authorization: `Bearer ${localStorage.getItem("token")}`
          },
          body: JSON.stringify(this.newUser)
        }
      );

      const data = await res.json();
      if (!res.ok) {
        alert(data.message || "Failed to add user");
        return;
      }

      this.addOpen = false;
      location.reload();
    }
  });
});
</script>

<!-- ================= END SETTINGS SECTION ================= -->



<script>
document.addEventListener('alpine:init', () => {
  Alpine.store('orders', {
    /* ================= EXISTING ================= */
    orderDetailsModalOpen: false,
    newOrderModalOpen: false,
    cancelConfirmOpen: false,
    selectedOrder: null,

    /* ================= NEW ORDER STATE ================= */
    newOrder: {
      customer: {
        name: "",
        phone: "",
        address: ""
      },
      items: [
        { name: "", size: "6ml", qty: 1, unitPrice: 0 }
      ],
      notes: ""
    },

    /* ================= ORDER DETAILS ================= */
    openDetails(order) {
      this.selectedOrder = null;
      this.orderDetailsModalOpen = true;
      this.fetchOrderDetails(order._id);
    },

    async fetchOrderDetails(orderId) {
  try {
    const token = localStorage.getItem("token");

    const res = await fetch(
      `https://perfume-store-production.up.railway.app/api/orders/admin/orders/${orderId}`,
      { headers: { Authorization: `Bearer ${token}` } }
    );

    const data = await res.json();
    if (!res.ok) throw new Error(data.message);

    // 🔥 FORCE paymentMethod to exist
    this.selectedOrder = {
      ...data.order,
      paymentMethod: data.order.paymentMethod ?? null
    };

  } catch (err) {
    console.error("LOAD ORDER DETAILS FAILED", err);
    alert("Failed to load order details");
    this.orderDetailsModalOpen = false;
  }
},

    closeDetails() {
      this.orderDetailsModalOpen = false;
      this.selectedOrder = null;
    },

    /* ================= NEW ORDER ================= */
    openNewOrder() {
      this.newOrderModalOpen = true;
    },

    closeNewOrder() {
      this.newOrderModalOpen = false;
      this.resetNewOrder();
    },

    addItem() {
      this.newOrder.items.push({
        name: "",
        size: "6ml",
        qty: 1,
        unitPrice: 0
      });
    },

    removeItem(index) {
      this.newOrder.items.splice(index, 1);
    },

    async saveNewOrder() {
      try {
        const token = localStorage.getItem("token");

        const res = await fetch(
          "https://perfume-store-production.up.railway.app/api/orders/admin/orders",
          {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${token}`
            },
            body: JSON.stringify(this.newOrder)
          }
        );

        const data = await res.json();
        if (!res.ok) throw new Error(data.message);

        alert("Order created successfully");
        this.closeNewOrder();

        const admin = document.querySelector('[x-data="adminOrders()"]');
        admin?.__x?.$data?.loadOrders();

      } catch (err) {
        console.error("ADMIN CREATE ORDER FAILED", err);
        alert("Failed to create order");
      }
    },

    resetNewOrder() {
      this.newOrder = {
        customer: { name: "", phone: "", address: "" },
        items: [{ name: "", size: "6ml", qty: 1, unitPrice: 0 }],
        notes: ""
      };
    },

    /* ================= CANCEL ================= */
    openCancel(order) {
      this.selectedOrder = order;
      this.cancelConfirmOpen = true;
    },

    closeCancel() {
      this.cancelConfirmOpen = false;
    },

    async cancelOrder() {
      try {
        const token = localStorage.getItem("token");
        const res = await fetch(
          `https://perfume-store-production.up.railway.app/api/orders/admin/orders/${this.selectedOrder._id}/cancel`,
          { method: "PUT", headers: { Authorization: `Bearer ${token}` } }
        );
        if (!res.ok) return alert("Failed to cancel order");

        this.selectedOrder.orderStatus = "cancelled";
        this.selectedOrder.paymentStatus = "refunded";
        this.cancelConfirmOpen = false;

      } catch (err) {
        console.error("CANCEL ORDER ERROR:", err);
        alert("Server error while cancelling order");
      }
    }
  });
});
</script>

<script>
function adminOrders() {
  return {
    orders: [],
    filterStatus: '',
    filterDate: '',
    currentPage: 1,
    perPage: 5,

    $watch: {
  filterStatus() {
    this.currentPage = 1;
  },
  filterDate() {
    this.currentPage = 1;
  }
},
async markDelivered(order) {
  if (!order || !order._id) {
    window.modal.show({
      title: "Error",
      message: "Invalid order",
      type: "error"
    });
    return;
  }

  if (!confirm("Mark this order as delivered?")) return;

  const token = localStorage.getItem("token");

  try {
    const res = await fetch(
      `https://perfume-store-production.up.railway.app/api/orders/${order._id}/received`,
      {
        method: "PUT",
        headers: {
          Authorization: `Bearer ${token}`
        }
      }
    );

    const data = await res.json();
    if (!res.ok || !data.success) {
      throw new Error(data.message || "Failed");
    }

    // 🔥 UPDATE UI IMMEDIATELY
    order.orderStatus = "delivered";

    window.modal.show({
      title: "Success",
      message: "Order marked as delivered",
      type: "success"
    });

  } catch (err) {
    console.error("DELIVER ERROR:", err);
    window.modal.show({
      title: "Error",
      message: err.message || "Server error",
      type: "error"
    });
  }
},

goToPage(page) {
  this.currentPage = page;
},
async returnOrder(order) {
  if (!confirm("Mark this order as RETURNED?")) return;

  const token = localStorage.getItem("token");

  try {
    const res = await fetch(
      `https://perfume-store-production.up.railway.app/api/orders/admin/orders/${order._id}/return`,
      {
        method: "PUT",
        headers: { Authorization: `Bearer ${token}` }
      }
    );

    // TEMP: backend may not exist yet
    if (!res.ok) {
      // fallback for now
      console.warn("Return API not ready yet, simulating UI update");
    }

    order.orderStatus = "returned";

    // Payment logic (IMPORTANT for analytics later)
    if (order.paymentMethod === "online" && order.paymentStatus === "paid") {
      order.paymentStatus = "refunded"; // 🔥 placeholder
    }

  } catch (err) {
    console.error("RETURN ORDER FAILED", err);
    alert("Failed to mark order as returned");
  }
},
    filteredOrders() {
  return this.orders.filter(o => {
    // STATUS FILTER
    if (this.filterStatus) {
      const map = {
        pending: "pending",
        approved: "confirmed",
        shipped: "shipped",
        delivered: "delivered",
        cancelled: "cancelled"
      };

      const selected = map[this.filterStatus.toLowerCase()];
      if (o.orderStatus !== selected) return false;
    }

    // DATE FILTER
    if (this.filterDate && o.date !== this.filterDate) return false;

    return true;
  });
},
stats() {
  return {
    total: this.orders.length,
    pending: this.orders.filter(o => o.orderStatus === "pending").length,
    approved: this.orders.filter(o => o.orderStatus === "confirmed").length,
    shipped: this.orders.filter(o => o.orderStatus === "shipped").length,
    delivered: this.orders.filter(o => o.orderStatus === "delivered").length,
    cancelled: this.orders.filter(o => o.orderStatus === "cancelled").length
  };
},
    async loadOrders() {
      try {
        const token = localStorage.getItem("token");

        const res = await fetch("https://perfume-store-production.up.railway.app/api/orders/admin/orders", {
          headers: { Authorization: `Bearer ${token}` }
        });

        const data = await res.json();
        if (!res.ok) throw new Error(data.message);

        this.orders = data.orders.map(o => ({
  _id: o._id,
  id: "#ORD-" + o._id.slice(-6).toUpperCase(),
  customer: o.customer.name,
  amount: o.total,
  date: new Date(o.createdAt).toISOString().split("T")[0],

  paymentMethod: o.paymentMethod, // ✅ ADD THIS LINE

  paymentStatus: o.paymentStatus,
  orderStatus: o.orderStatus
}));

      } catch (err) {
        console.error("LOAD ORDERS FAILED", err);
        alert("Failed to load orders");
      }
    },
    pagedOrders() {
  this.normalizePage();
  const start = (this.currentPage - 1) * this.perPage;
  return this.filteredOrders().slice(start, start + this.perPage);
},

normalizePage() {
  if (this.currentPage > this.totalPages()) {
    this.currentPage = this.totalPages();
  }
  if (this.currentPage < 1) {
    this.currentPage = 1;
  }
},


totalPages() {
  return Math.max(1, Math.ceil(this.filteredOrders().length / this.perPage));
},
    async confirmOrder(order) {
      if (!confirm("Confirm this order? Stock will be deducted.")) return;

      const token = localStorage.getItem("token");

      const res = await fetch(
        `https://perfume-store-production.up.railway.app/api/orders/admin/orders/${order._id}/confirm`,
        {
          method: "PUT",
          headers: { Authorization: `Bearer ${token}` }
        }
      );

      if (!res.ok) return alert("Failed to confirm order");

      order.orderStatus = "confirmed";
    },

    async shipOrder(order) {
      if (!confirm("Mark this order as shipped?")) return;

      const token = localStorage.getItem("token");

      const res = await fetch(
        `https://perfume-store-production.up.railway.app/api/orders/admin/orders/${order._id}/ship`,
        {
          method: "PUT",
          headers: { Authorization: `Bearer ${token}` }
        }
      );

      if (!res.ok) return alert("Failed to ship order");

      order.orderStatus = "shipped";
    }
  };
}
</script>
<script>
  function getVisiblePages(currentPage, totalPages) {
  if (totalPages <= 3) {
    return Array.from({ length: totalPages }, (_, i) => i + 1);
  }

  if (currentPage <= 2) {
    return [1, 2, 3];
  }

  if (currentPage >= totalPages - 1) {
    return [totalPages - 2, totalPages - 1, totalPages];
  }

  return [currentPage - 1, currentPage, currentPage + 1];
}

</script>

<!-- UPDATE STOCK MODAL -->
<div
  x-show="$store.stock.updateOpen"
  x-cloak
  class="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4"
>
<div
  @click.outside="$store.stock.updateOpen = false"
  class="bg-white dark:bg-gray-900
         w-full max-w-lg
         rounded-2xl shadow-xl border
         max-h-[90vh]
         flex flex-col"
>

  <!-- HEADER (FIXED) -->
  <div class="flex justify-between items-center px-6 py-4 border-b border-gray-200 dark:border-gray-800">
    <h2 class="text-xl font-bold">
      Stock Control — <span x-text="$store.stock.editItem?.name"></span>
    </h2>
    <button @click="$store.stock.updateOpen = false">
      <span class="material-symbols-outlined">close</span>
    </button>
  </div>

  <!-- BODY (SCROLLABLE) -->
  <div class="flex-1 overflow-y-auto px-6 py-4">

    <!-- REORDER LEVEL -->
    <div class="mb-6">
      <label class="text-sm font-semibold">Reorder Level</label>
      <input
        type="number"
        class="mt-1 w-full border rounded-lg p-2"
        x-model.number="$store.stock.editItem.reorder"
      />
    </div>

    <!-- BOTTLE SIZES -->
    <div class="mb-6">
      <label class="text-sm font-semibold mb-2 block">Bottle Sizes</label>

      <div class="grid grid-cols-2 sm:grid-cols-3 gap-4">        <template x-for="size in $store.stock.editItem.bottleSizes" :key="size.sizeMl">
          <div
            class="rounded-xl border p-4 transition"
            :class="{
              'ring-2 ring-primary bg-primary/5':
                $store.stock.selectedSize?.sizeMl === size.sizeMl
            }"
          >
            <button class="w-full text-center" @click="$store.stock.selectSize(size)">
              <div class="font-semibold" x-text="size.sizeMl + ' ml'"></div>
              <div class="text-lg font-bold" x-text="size.stock"></div>
            </button>

            <div class="flex justify-center mt-3">
              <label class="relative inline-flex items-center cursor-pointer">
                <input
                  type="checkbox"
                  class="sr-only peer"
                  :checked="size.enabled"
                  :disabled="size.stock === 0 && size.enabled === false"
                  @change="$store.stock.toggleAvailability(size)"
                >
                <div
                  class="w-11 h-6 bg-gray-300 rounded-full peer peer-checked:bg-primary
                         after:content-[''] after:absolute after:top-0.5 after:left-[2px]
                         after:bg-white after:rounded-full after:h-5 after:w-5
                         after:transition-all peer-checked:after:translate-x-full">
                </div>
              </label>
            </div>
          </div>
        </template>
      </div>
    </div>

    <!-- ADD / REDUCE -->
    <div class="grid grid-cols-2 gap-4 mb-6">
      <div>
        <label class="text-sm">Add Stock</label>
        <input
          type="number"
          class="w-full border rounded-lg p-2"
          x-model.number="$store.stock.addValue"
          :disabled="!$store.stock.selectedSize"
        />
      </div>

      <div>
        <label class="text-sm">Reduce Stock</label>
        <input
          type="number"
          class="w-full border rounded-lg p-2"
          x-model.number="$store.stock.reduceValue"
          :disabled="!$store.stock.selectedSize"
        />
      </div>
    </div>

  </div>

  <!-- FOOTER (FIXED) -->
  <div class="px-6 py-4 border-t border-gray-200 dark:border-gray-800 flex gap-3">
    <button
      @click="$store.stock.updateOpen = false"
      class="w-full h-12 rounded-xl border"
    >
      Cancel
    </button>

    <button
      @click="$store.stock.saveStock()"
      class="w-full h-12 rounded-xl text-white bg-primary hover:bg-primary/90"
    >
      Save Changes
    </button>
  </div>

</div>
</div>


<!-- BULK STOCK UPDATE -->
<div 
  x-show="$store.stock.bulkOpen"
  x-cloak
  class="fixed inset-0 z-[200] flex justify-end bg-black/60 backdrop-blur-sm"
>
  <div
    class="w-full max-w-lg h-full bg-white dark:bg-gray-900 
           border-l border-gray-200 dark:border-gray-800 shadow-xl
           flex flex-col"
  >

    <!-- HEADER -->
    <div class="p-6 border-b flex justify-between items-center">
      <h2 class="text-xl font-bold">Bulk Stock Update</h2>
      <button @click="$store.stock.bulkOpen=false">
        <span class="material-symbols-outlined">close</span>
      </button>
    </div>

    <!-- BODY -->
    <div class="flex-1 overflow-y-auto p-6 space-y-6">

      <!-- QUALITY FILTER -->
      <div>
        <label class="text-sm font-semibold">Quality</label>
        <select class="w-full border p-2 rounded-lg"
          x-model="$store.stock.bulk.quality">
          <option value="all">All</option>
          <option value="normal">Normal</option>
          <option value="original">Original</option>
        </select>
      </div>

      <!-- SIZE FILTER -->
      <div>
        <label class="text-sm font-semibold">Bottle Size</label>
        <select class="w-full border p-2 rounded-lg"
          x-model="$store.stock.bulk.size">
          <option value="all">All Sizes</option>
          <option value="3">3 ml</option>
          <option value="6">6 ml</option>
          <option value="12">12 ml</option>
        </select>
      </div>

      <hr>

      <!-- ACTION -->
      <div class="space-y-3">
        <label class="flex gap-3">
          <input type="radio" value="increase" x-model="$store.stock.bulk.action">
          Increase Stock
        </label>

        <label class="flex gap-3">
          <input type="radio" value="decrease" x-model="$store.stock.bulk.action">
          Decrease Stock
        </label>
      </div>

      <div>
        <label class="text-sm font-semibold">Value</label>
        <input type="number"
          class="w-full border p-2 rounded-lg"
          x-model.number="$store.stock.bulk.value">
      </div>

    </div>

    <!-- FOOTER -->
    <div class="p-6 border-t flex justify-end gap-3">
      <button @click="$store.stock.bulkOpen=false"
        class="px-4 py-2 border rounded-lg">
        Cancel
      </button>
      <button
        @click="$store.stock.applyBulkUpdate()"
        class="px-4 py-2 bg-primary text-white rounded-lg">
        Apply
      </button>
    </div>

  </div>
</div>





















</div>
</div>


<div x-data="{ 
  editProductOpen: false,
  viewProductOpen: false,
  deleteProductOpen: false,
  selectedProduct: null
}"
x-init="
window.addEventListener('open-edit-product', e => {
  const product = window.selectedProduct;

  Alpine.store("productUI").selected = product;
  Alpine.store("productUI").original = JSON.parse(JSON.stringify(product));

  editProductOpen = true;
});"



>

<div aria-labelledby="slide-over-title" aria-modal="true" class="fixed inset-0 z-40 overflow-hidden" role="dialog" x-cloak="" x-show="addProductOpen">
<div class="absolute inset-0 overflow-hidden">
<div @click="addProductOpen = false" aria-hidden="true" class="absolute inset-0 bg-gray-900 bg-opacity-75 transition-opacity" x-show="addProductOpen" x-transition:enter="ease-in-out duration-500" x-transition:enter-end="opacity-100" x-transition:enter-start="opacity-0" x-transition:leave="ease-in-out duration-500" x-transition:leave-end="opacity-0" x-transition:leave-start="opacity-100"></div>
<div class="fixed inset-y-0 right-0 pl-10 max-w-full flex">
<div @click.outside="addProductOpen = false" class="w-screen max-w-2xl" x-show="addProductOpen" x-transition:enter="transform transition ease-in-out duration-500 sm:duration-700" x-transition:enter-end="translate-x-0" x-transition:enter-start="translate-x-full" x-transition:leave="transform transition ease-in-out duration-500 sm:duration-700" x-transition:leave-end="translate-x-full" x-transition:leave-start="translate-x-0">
<div class="h-full flex flex-col bg-light-bg dark:bg-dark-bg shadow-xl overflow-y-scroll">
<div class="p-6 bg-accent dark:bg-secondary backdrop-blur-sm sticky top-0 z-10 border-b border-bronze/10 dark:border-primary/10">
<div class="flex items-start justify-between">
<h2 class="text-2xl font-display font-bold text-light-text dark:text-dark-text" id="slide-over-title">Add New Product</h2>
<div class="ml-3 h-7 flex items-center">
<button @click="addProductOpen = false" class="bg-accent dark:bg-secondary rounded-md text-light-text/70 dark:text-dark-text/70 hover:text-light-text dark:hover:text-dark-text focus:outline-none focus:ring-2 focus:ring-primary" type="button">
<span class="sr-only">Close panel</span>
<span class="material-symbols-outlined">close</span>
</button>
</div>
</div>
<p class="mt-1 text-sm text-light-text/70 dark:text-dark-text/70">Fill in the details below to add a new product to the inventory.</p>
</div>
<div class="relative flex-1 p-6 space-y-6">
<div><label class="block text-sm font-medium" for="product-name">Product Name</label><input class="mt-1 block w-full bg-accent/50 dark:bg-secondary/50 border-bronze/20 dark:border-primary/20 rounded-md shadow-sm focus:ring-primary focus:border-primary sm:text-sm" id="product-name" name="product-name" placeholder="e.g., Oud Al-Amir" type="text"/></div>
<div><label class="block text-sm font-medium" for="quality">Quality</label><select class="mt-1 block w-full pl-3 pr-10 py-2 text-base bg-accent/50 dark:bg-secondary/50 border-bronze/20 dark:border-primary/20 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm rounded-md" id="quality" name="quality">
  <option value="normal">Normal</option>
  <option value="original">Original</option>
    </select></div>
<div><label class="block text-sm font-medium">Wholesale Prices</label><div class="mt-1 grid grid-cols-1 sm:grid-cols-2 gap-4"><div><label class="block text-xs text-light-text/70 dark:text-dark-text/70" for="price-tier-1">Tier 1 (LKR)</label><div class="relative mt-1"><span class="absolute inset-y-0 left-0 pl-3 flex items-center text-light-text/50 dark:text-dark-text/50">Rs</span><input class="pl-7 w-full bg-accent/50 dark:bg-secondary/50 border-bronze/20 dark:border-primary/20 rounded-md shadow-sm" id="price-tier-1" name="price-tier-1" placeholder="150.00" type="text"/></div></div>
</div></div>

<script>
async function submitProductForm(event) {
  event.preventDefault();

  const token = localStorage.getItem("token");

  const name = document.getElementById("product-name").value.trim();
  const quality = document.getElementById("quality").value;
  const description = document.getElementById("description").value.trim();
  const inventoryQty = Number(document.getElementById("inventory-qty").value);
  const base6mlPrice = Number(document.getElementById("price-tier-1").value);
  const variantsRaw = document.getElementById("fragrance-variants-input").value;
  if (!name || !quality || !description || !base6mlPrice || inventoryQty <= 0) {
    alert("Name, base price (6ml), and stock are required");
    return;
  }

  const formData = new FormData();

  formData.append("name", name);
  formData.append("quality", quality);
  formData.append("description", description);
  formData.append("inventoryQty", inventoryQty);
 

formData.append(
  "fragranceVariants",
  variantsRaw
);

formData.append(
  "notes",
  JSON.stringify({
    top: document.getElementById("top-notes").value.split(",").map(s => s.trim()).filter(Boolean),
    heart: document.getElementById("heart-notes").value.split(",").map(s => s.trim()).filter(Boolean),
    base: document.getElementById("base-notes").value.split(",").map(s => s.trim()).filter(Boolean)
  })
);
formData.append(
  "attributes",
  JSON.stringify({
    longLasting: document.getElementById("long-lasting").checked,
    alcoholFree: document.getElementById("alcohol-free").checked,
    pureAttar: document.getElementById("pure-attar").checked
  })
);

  /* ✅ NEW PRICE STRUCTURE */
  formData.append(
  "prices",
  JSON.stringify({
    base6ml: base6mlPrice,
    sizePercentages: {
      size3: -30,
      size12: 35
    },
    discountPercentages: {
      base: null,
      size3: null,
      size12: null
    }
  })
);


  const files = document.getElementById("file-upload").files;
  if (!files.length) {
    alert("Upload at least one image");
    return;
  }

  for (let f of files) {
    formData.append("images", f);
  }

  const res = await fetch("https://perfume-store-production.up.railway.app/api/admin/products", {
    method: "POST",
    headers: {
      Authorization: `Bearer ${token}`
    },
    body: formData
  });

  const data = await res.json();
  if (!res.ok) {
    alert(data.message || "Failed to add product");
    return;
  }

  alert("Product added successfully");
}
</script>


<script>
let selectedProductImages = [];

function previewProductImages(event) {
  const files = Array.from(event.target.files);
  if (!files.length) return;

  selectedProductImages = files;

  const previewEl = document.getElementById("productImagePreview");
  if (!previewEl || !window.Alpine) return;

  const alpineData = Alpine.$data(previewEl);
  alpineData.images = [];

  files.forEach(file => {
    const reader = new FileReader();
    reader.onload = e => {
      alpineData.images.push(e.target.result);
    };
    reader.readAsDataURL(file);
  });
}
</script>


<div><label class="block text-sm font-medium">Product Images</label><div class="mt-2 flex justify-center px-6 pt-5 pb-6 border-2 border-bronze/30 dark:border-primary/30 border-dashed rounded-md"><div class="space-y-1 text-center"><span class="material-symbols-outlined text-5xl text-light-text/30 dark:text-dark-text/30">upload_file</span><div class="flex text-sm text-light-text/60 dark:text-dark-text/60"><label class="relative cursor-pointer bg-transparent rounded-md font-medium text-bronze dark:text-primary hover:text-bronze/80 dark:hover:text-primary/80" for="file-upload"><span>Upload files</span><input
  class="sr-only"
  id="file-upload"
  multiple
  type="file"
  onchange="previewProductImages(event)"
/>
</label><p class="pl-1">or drag and drop</p></div><p class="text-xs text-light-text/50 dark:text-dark-text/50">PNG, JPG, GIF up to 10MB</p></div></div></div>
<div class="space-y-2" x-data="{ images: [] }" id="productImagePreview"><div class="text-sm font-medium">Image Preview</div><div class="relative"><div class="flex overflow-x-auto space-x-4 pb-2 carousel-snap"><template x-for="(image, index) in images"><div class="carousel-item flex-shrink-0 w-24 h-24 rounded-lg overflow-hidden relative group"><img :src="image" class="w-full h-full object-cover"/><div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center"><button class="p-1 rounded-full bg-danger/80 text-white"><span class="material-symbols-outlined text-base">delete</span></button></div></div></template></div></div></div>
<!-- ================= BOTTLE SIZES (ADD PRODUCT ) ================= -->
<div>
  <label class="block text-sm font-medium mb-2">Bottle Sizes</label>

  <div class="flex gap-6 text-sm text-light-text/80 dark:text-dark-text/80">
    <label class="flex items-center gap-2 cursor-not-allowed opacity-70">
      <input type="checkbox" checked disabled />
      <span>3 ml</span>
    </label>

    <label class="flex items-center gap-2 cursor-not-allowed opacity-70">
      <input type="checkbox" checked disabled />
      <span>6 ml</span>
    </label>

    <label class="flex items-center gap-2 cursor-not-allowed opacity-70">
      <input type="checkbox" checked disabled />
      <span>12 ml</span>
    </label>
  </div>

  <p class="mt-1 text-xs text-light-text/50 dark:text-dark-text/50">
    Bottle sizes are managed in Stock Control. All sizes are enabled by default.
  </p>
</div>
<!-- ================= END BOTTLE SIZES ================= -->



<!-- ================= FRAGRANCE VARIANTS (ADD PRODUCT) ================= -->
<div
  x-data="{
    primaryTag: '',
    variants: [],
    primaryTags: [],

    async init() {
      await this.loadPrimaryTags();
    },

    async loadPrimaryTags() {
      const token = localStorage.getItem('token');
      const res = await fetch(
        'https://perfume-store-production.up.railway.app/api/products/admin/primary-tags',
        { headers: { Authorization: `Bearer ${token}` } }
      );
      const data = await res.json();
      if (data.success) this.primaryTags = data.tags;
    },

    addVariant() {
      this.variants.push('');
    },

    removeVariant(i) {
      this.variants.splice(i, 1);
    }
  }"
>
  <label class="block text-sm font-medium mb-2">
    Fragrance Tags
  </label>

  <!-- PRIMARY TAG (DROPDOWN ONLY) -->
<!-- PRIMARY TAG -->
<div class="mb-3" x-data="{ open: false, adding: false, newTag: '' }">
  <label class="text-xs font-bold text-bronze dark:text-primary">
    Primary Tag (required)
  </label>

  <!-- SELECT BOX -->
  <div
    class="mt-1 w-full bg-accent/50 dark:bg-secondary/50 border rounded-md p-2 cursor-pointer relative"
    @click="open = !open"
  >
    <span x-text="primaryTag || 'Select primary tag'"></span>
    <span class="absolute right-3 top-1/2 -translate-y-1/2">▾</span>
  </div>

  <!-- DROPDOWN -->
  <div
    x-show="open"
    @click.outside="open = false"
    class="mt-1 bg-accent dark:bg-secondary border rounded-md shadow-lg max-h-48 overflow-y-auto z-50"
  >
    <!-- EXISTING TAGS -->
    <template x-for="tag in primaryTags" :key="tag">
      <div
        class="px-3 py-2 hover:bg-bronze/10 cursor-pointer"
        @click="
          primaryTag = tag;
          open = false;
          adding = false;
        "
        x-text="tag"
      ></div>
    </template>

    <!-- ADD NEW -->
    <div
      class="px-3 py-2 text-sm text-bronze dark:text-primary hover:bg-bronze/10 cursor-pointer"
      @click="adding = true"
    >
      + Add new tag
    </div>
  </div>

  <!-- ADD NEW INPUT -->
  <div x-show="adding" class="mt-2 flex gap-2">
    <input
      type="text"
      class="w-full bg-accent/50 dark:bg-secondary/50 border rounded-md p-2"
      placeholder="Enter new tag"
      x-model="newTag"
    />
    <button
      type="button"
      class="px-3 py-2 bg-bronze dark:bg-primary text-white rounded-md"
      @click="
        if (newTag.trim()) {
          primaryTag = newTag.trim();
          primaryTags.push(primaryTag);
          newTag = '';
          adding = false;
          open = false;
        }
      "
    >
      Add
    </button>
  </div>
</div>


  <!-- SECONDARY TAGS (FREE TEXT) -->
  <template x-for="(v, i) in variants" :key="i">
    <div class="flex items-center gap-2 mb-2">
      <input
        type="text"
        class="w-full bg-accent/50 dark:bg-secondary/50 border rounded-md p-2"
        placeholder="Secondary tag (optional)"
        x-model="variants[i]"
      />
      <button
        type="button"
        class="text-danger"
        @click="removeVariant(i)"
      >
        ✕
      </button>
    </div>
  </template>

  <button
    type="button"
    class="mt-2 text-sm text-bronze dark:text-primary"
    @click="addVariant"
  >
    + Add secondary tag
  </button>

  <!-- FINAL VALUE SENT TO BACKEND -->
  <input
    type="hidden"
    id="fragrance-variants-input"
    :value="JSON.stringify(
      primaryTag
        ? [primaryTag, ...variants.map(v => v.trim()).filter(Boolean)]
        : []
    )"
  />
</div>

<!-- ================= END FRAGRANCE VARIANTS ================= -->

<datalist id="primaryTags">
  <template x-for="tag in primaryTagSuggestions" :key="tag">
    <option :value="tag"></option>
  </template>
</datalist>


<!-- ================= FRAGRANCE NOTES ================= -->
<div>
  <label class="block text-sm font-medium mb-3">
    Fragrance Notes
  </label>

  <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
    <div>
      <label class="block text-xs opacity-70 mb-1">Top Notes</label>
      <input
        id="top-notes"
        class="w-full bg-accent/50 dark:bg-secondary/50 border rounded-md p-2"
        placeholder="Saffron, Nutmeg"
      />
    </div>

    <div>
      <label class="block text-xs opacity-70 mb-1">Heart Notes</label>
      <input
        id="heart-notes"
        class="w-full bg-accent/50 dark:bg-secondary/50 border rounded-md p-2"
        placeholder="Rose, Geranium"
      />
    </div>

    <div>
      <label class="block text-xs opacity-70 mb-1">Base Notes</label>
      <input
        id="base-notes"
        class="w-full bg-accent/50 dark:bg-secondary/50 border rounded-md p-2"
        placeholder="Agarwood, Musk"
      />
    </div>
  </div>

  <p class="mt-2 text-xs opacity-60">
    Separate multiple notes with commas
  </p>
</div>

<!-- ================= PRODUCT ATTRIBUTES ================= -->
<div>
  <label class="block text-sm font-medium mb-3">
    Product Attributes
  </label>

  <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">

    <label class="flex items-center gap-3 p-3 rounded-lg border bg-accent/40 dark:bg-secondary/40 cursor-pointer hover:border-bronze/50 transition">
      <input
        type="checkbox"
        id="long-lasting"
        class="accent-bronze dark:accent-primary"
      />
      <div>
        <p class="font-semibold text-sm">Long Lasting</p>
        <p class="text-xs opacity-60">12+ hours longevity</p>
      </div>
    </label>

    <label class="flex items-center gap-3 p-3 rounded-lg border bg-accent/40 dark:bg-secondary/40 cursor-pointer hover:border-bronze/50 transition">
      <input
        type="checkbox"
        id="alcohol-free"
        class="accent-bronze dark:accent-primary"
      />
      <div>
        <p class="font-semibold text-sm">Alcohol Free</p>
        <p class="text-xs opacity-60">No alcohol content</p>
      </div>
    </label>

    <label class="flex items-center gap-3 p-3 rounded-lg border bg-accent/40 dark:bg-secondary/40 cursor-pointer hover:border-bronze/50 transition">
      <input
        type="checkbox"
        id="pure-attar"
        class="accent-bronze dark:accent-primary"
      />
      <div>
        <p class="font-semibold text-sm">Pure Attar</p>
        <p class="text-xs opacity-60">100% oil-based</p>
      </div>
    </label>

  </div>
</div>
<!-- ================= END ATTRIBUTES ================= -->


<div><label class="block text-sm font-medium" for="description">Product Description</label><div class="mt-1"><textarea class="block w-full bg-accent/50 dark:bg-secondary/50 border-bronze/20 dark:border-primary/20 shadow-sm sm:text-sm rounded-md" id="description" name="description" placeholder="A rich, decadent fragrance..." rows="4"></textarea></div></div>
<div><label class="block text-sm font-medium" for="inventory-qty">Stock</label><input class="mt-1 block w-full bg-accent/50 dark:bg-secondary/50 border-bronze/20 dark:border-primary/20 rounded-md shadow-sm sm:text-sm" id="inventory-qty" name="inventory-qty" placeholder="250" type="number"/><p class="mt-1 text-xs text-danger flex items-center"><span class="material-symbols-outlined text-sm mr-1">error</span> This field is required.</p></div>
</div>
<div class="flex-shrink-0 px-6 py-4 border-t border-bronze/10 dark:border-primary/10 flex justify-between items-center bg-accent/80 dark:bg-secondary/80 backdrop-blur-sm sticky bottom-0">
<span class="text-sm text-light-text/60 dark:text-dark-text/60 italic flex items-center"><span class="material-symbols-outlined text-base mr-2">save</span> Auto-saved as draft</span>
<!-- MODAL ACTIONS -->
<div class="mt-6 space-y-3">

  <!-- PUBLISH PRODUCT (PRIMARY) -->
  <button
    type="button"
    onclick="submitProductForm(event)"
        class="w-full h-12 rounded-xl
           bg-primary text-secondary
           font-bold
           transition-all duration-300
           hover:opacity-90
           active:scale-[0.98]"
  >
    Publish Product
  </button>

  <!-- CANCEL (SECONDARY) -->
  <button
    type="button"
    onclick="closeAddProductModal()"
    class="w-full h-12 rounded-xl
           border border-bronze/30 dark:border-primary/30
           text-light-text dark:text-dark-text
           font-semibold
           hover:bg-bronze/10 dark:hover:bg-primary/10
           transition-all duration-300"
  >
    Cancel
  </button>

</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div aria-labelledby="edit-modal-title" aria-modal="true" class="fixed inset-0 z-50 flex items-center justify-center" role="dialog" x-cloak="" x-show="$store.productUI.editOpen"
>
<div   @click="$store.productUI.closeAll()"
= false" class="fixed inset-0 bg-gray-900 bg-opacity-75 transition-opacity"   x-show="$store.productUI.editOpen"
x-transition:enter="ease-out duration-300" x-transition:enter-end="opacity-100" x-transition:enter-start="opacity-0" x-transition:leave="ease-in duration-200" x-transition:leave-end="opacity-0" x-transition:leave-start="opacity-100"></div>
<div   @click.outside="$store.productUI.closeAll()"
= false" class="bg-light-bg dark:bg-dark-bg rounded-2xl shadow-xl transform transition-all sm:my-8 sm:max-w-2xl sm:w-full border border-bronze/10 dark:border-primary/10 overflow-hidden"   x-show="$store.productUI.editOpen"
x-transition:enter="ease-out duration-300" x-transition:enter-end="opacity-100 translate-y-0 sm:scale-100" x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95" x-transition:leave="ease-in duration-200" x-transition:leave-end="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95" x-transition:leave-start="opacity-100 translate-y-0 sm:scale-100">
<div class="p-6 bg-accent dark:bg-secondary border-b border-bronze/10 dark:border-primary/10">
<div class="flex items-start justify-between">
<h2 class="text-2xl font-display font-bold text-light-text dark:text-dark-text" id="edit-modal-title">Edit Product</h2>
<button   @click="$store.productUI.closeAll()"
= false" class="rounded-md text-light-text/70 dark:text-dark-text/70 hover:text-light-text dark:hover:text-dark-text focus:outline-none focus:ring-2 focus:ring-primary" type="button"><span class="material-symbols-outlined">close</span></button>
</div>
<p class="mt-1 text-sm text-light-text/70 dark:text-dark-text/70">Update the product details below.</p>
</div>
<div class="p-6 space-y-6 max-h-[60vh] overflow-y-auto">

  <div>
  <label class="block text-sm font-medium mb-2">Product Image</label>

  <div class="relative w-28 h-28 mx-auto">
    <img
    :src="$store.productUI.selected?.images?.[0] || '/placeholder.png'"

  class="w-full h-full rounded-full object-cover border"
/>


  <label
    class="absolute bottom-1 right-1 bg-bronze dark:bg-primary text-white rounded-full p-2 cursor-pointer shadow hover:opacity-90 transition"
  >
    <span class="material-symbols-outlined text-sm">photo_camera</span>
    <input
      type="file"
      class="hidden"
      onchange="uploadProductImage(event)"
      />
  </label>
</div>
<script>
async function uploadProductImage(event) {
  const file = event.target.files[0];
  if (!file || !window.selectedProduct) return;

  const token = localStorage.getItem("token");
  const formData = new FormData();
  formData.append("image", file);

  const res = await fetch(
    `https://perfume-store-production.up.railway.app/api/admin/products/${window.selectedProduct._id}/image`,
    {
      method: "POST",
      headers: {
        Authorization: `Bearer ${token}`
      },
      body: formData
    }
  );

  const data = await res.json();
  if (!res.ok) {
    alert(data.message || "Image upload failed");
    return;
  }

  // update preview immediately
  window.selectedProduct.images = data.images;
}
</script>

</div>


  <div><label class="block text-sm font-medium" for="edit-product-name">Product Name</label><input class="mt-1 block w-full bg-accent/50 dark:bg-secondary/50 border-bronze/20 dark:border-primary/20 rounded-md shadow-sm focus:ring-primary focus:border-primary sm:text-sm" id="edit-product-name" name="edit-product-name" type="text" x-model="$store.productUI.selected.name"/></div>
  <div>
  <label class="block text-sm font-medium">Quality</label>
  <select
    class="mt-1 block w-full pl-3 pr-10 py-2 text-base bg-accent/50 dark:bg-secondary/50 border-bronze/20 dark:border-primary/20 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm rounded-md"
    x-model="$store.productUI.selected.quality"
  >
    <option value="normal">Normal</option>
    <option value="original">Original</option>
  </select>
</div>
<!-- ================= EDIT PRICES ================= -->
<div>
  <label class="block text-sm font-medium mb-3">Pricing (Based on 6ml)</label>

  <!-- BASE PRICE -->
  <div class="mb-4">
    <label class="block text-xs opacity-70">Base Price — 6 ml (LKR)</label>
    <input
      type="number"
      step="0.01"
      class="mt-1 block w-full bg-accent/50 dark:bg-secondary/50 border rounded-md p-2"
      x-model.number="$store.productUI.selected.prices.base6ml"
    />
  </div>

  <!-- SIZE PERCENTAGES -->
  <div class="grid grid-cols-2 gap-4 mb-4">
    <div>
      <label class="block text-xs opacity-70">3 ml (%)</label>
      <input
        type="number"
        class="mt-1 block w-full bg-accent/50 dark:bg-secondary/50 border rounded-md p-2"
        x-model.number="$store.productUI.selected.prices.sizePercentages.size3"
      />
    </div>

    <div>
      <label class="block text-xs opacity-70">12 ml (%)</label>
      <input
        type="number"
        class="mt-1 block w-full bg-accent/50 dark:bg-secondary/50 border rounded-md p-2"
        x-model.number="$store.productUI.selected.prices.sizePercentages.size12"
      />
    </div>
  </div>

  <!-- DISCOUNT PERCENTAGES -->
  <div class="grid grid-cols-3 gap-4">
    <div>
      <label class="block text-xs opacity-70">6 ml Discount (%)</label>
      <input
        type="number"
        class="mt-1 block w-full bg-accent/50 dark:bg-secondary/50 border rounded-md p-2"
        x-model.number="$store.productUI.selected.prices.discountPercentages.base"
      />
    </div>

    <div>
      <label class="block text-xs opacity-70">3 ml Discount (%)</label>
      <input
        type="number"
        class="mt-1 block w-full bg-accent/50 dark:bg-secondary/50 border rounded-md p-2"
        x-model.number="$store.productUI.selected.prices.discountPercentages.size3"
      />
    </div>

    <div>
      <label class="block text-xs opacity-70">12 ml Discount (%)</label>
      <input
        type="number"
        class="mt-1 block w-full bg-accent/50 dark:bg-secondary/50 border rounded-md p-2"
        x-model.number="$store.productUI.selected.prices.discountPercentages.size12"
      />
    </div>
  </div>

  <p class="mt-2 text-xs opacity-60">
    Leave discount empty to show original price.
  </p>
</div>
<!-- ================= END EDIT PRICES ================= -->


<!-- ================= STOCK (READ ONLY) ================= -->
<div>
  <label class="block text-sm font-medium mb-2">Stock (Read Only)</label>

  <div class="grid grid-cols-3 gap-4 text-sm">
    <template
      x-for="size in $store.productUI.selected.bottleSizes"
      :key="size.sizeMl"
    >
      <div class="bg-accent/50 dark:bg-secondary/50 rounded-lg p-3 text-center">
        <div class="font-semibold" x-text="size.sizeMl + ' ml'"></div>
        <div class="text-lg font-bold">
          <span x-text="size.stock ?? '-'"></span>
        </div>
      </div>
    </template>
  </div>

  <p class="mt-2 text-xs opacity-60">
    Stock is managed in Stock Control and cannot be edited here.
  </p>
</div>
<!-- ================= END STOCK ================= -->

<!-- ================= BOTTLE SIZES (EDIT PRODUCT – READ ONLY) ================= -->
<div x-show="$store.productUI.selected && $store.productUI.selected.bottleSizes">
  <label class="block text-sm font-medium mb-2">Bottle Sizes</label>

  <div class="flex gap-6 text-sm text-light-text/80 dark:text-dark-text/80">
    <template
      x-for="size in $store.productUI.selected.bottleSizes"
      :key="size.sizeMl"
    >
      <label class="flex items-center gap-2 opacity-70 cursor-not-allowed">
        <input
          type="checkbox"
          :checked="size.enabled"
          disabled
        />
        <span x-text="size.sizeMl + ' ml'"></span>
      </label>
    </template>
  </div>

  <p class="mt-1 text-xs text-light-text/50 dark:text-dark-text/50">
    Bottle sizes are managed in Stock Control and cannot be edited here.
  </p>
</div>
<!-- ================= END BOTTLE SIZES ================= -->

<!-- ================= FRAGRANCE VARIANTS (EDIT PRODUCT) ================= -->
<div
  x-data="{
    max: 5,
    get variants() {
      return $store.productUI.selected.fragranceVariants;
    },
    add() {
      if (this.variants.length < this.max) {
        this.variants.push('');
      }
    },
    remove(index) {
      if (this.variants.length > 1) {
        this.variants.splice(index, 1);
      }
    }
  }"
  x-init="
    if (!Array.isArray($store.productUI.selected.fragranceVariants) ||
        !$store.productUI.selected.fragranceVariants.length) {
      $store.productUI.selected.fragranceVariants = [''];
    }
  "
>
  <label class="block text-sm font-medium mb-2">
    Fragrance Variants (max 5)
  </label>

  <template x-for="(v, i) in variants" :key="i">
    <div class="flex items-center gap-2 mb-2">
      <input
      type="text"
      class="w-full bg-accent/50 dark:bg-secondary/50 border rounded-md p-2"
      placeholder="e.g. Lacoste"
      x-model="variants[i]"
      :list="i === 0 ? 'primaryTags' : null"
    />
    
      <script>
        async function loadPrimaryTags() {
          try {
            const res = await fetch("/api/products/admin/primary-tags", {
              credentials: "include"
            });
            const data = await res.json();
        
            if (!data.success) return;
        
            const list = document.getElementById("primaryTagSuggestions");
            list.innerHTML = "";
        
            data.tags.forEach(tag => {
              const option = document.createElement("option");
              option.value = tag;
              list.appendChild(option);
            });
          } catch (e) {
            console.error("Failed to load tag suggestions");
          }
        }
        
        document.addEventListener("DOMContentLoaded", loadPrimaryTags);
        </script>
        
      <button
        type="button"
        class="text-danger"
        @click="remove(i)"
        x-show="variants.length > 1"
      >
        ✕
      </button>
    </div>
  </template>

  <button
    type="button"
    class="mt-2 text-sm text-bronze dark:text-primary"
    @click="add"
    x-show="variants.length < max"
  >
    + Add another variant
  </button>
</div>
<!-- ================= END FRAGRANCE VARIANTS ================= -->

<div>
  <label class="block text-sm font-medium mb-2">Fragrance Notes</label>

  <div class="space-y-4">
    <div>
      <label class="block text-xs opacity-70">Top Notes</label>
      <input
        type="text"
        placeholder="Saffron, Nutmeg"
        class="mt-1 w-full bg-accent/50 dark:bg-secondary/50 border rounded-md p-2"
        x-model="$store.productUI.selected.notes.top"
      />
    </div>

    <div>
      <label class="block text-xs opacity-70">Heart Notes</label>
      <input
        type="text"
        placeholder="Rose, Geranium"
        class="mt-1 w-full bg-accent/50 dark:bg-secondary/50 border rounded-md p-2"
        x-model="$store.productUI.selected.notes.heart"
      />
    </div>

    <div>
      <label class="block text-xs opacity-70">Base Notes</label>
      <input
        type="text"
        placeholder="Agarwood, Musk"
        class="mt-1 w-full bg-accent/50 dark:bg-secondary/50 border rounded-md p-2"
        x-model="$store.productUI.selected.notes.base"
      />
    </div>
  </div>

  <p class="mt-1 text-xs opacity-60">
    Separate values using commas.
  </p>
</div>
<!-- ================= PRODUCT ATTRIBUTES ================= -->
<!-- ================= PRODUCT ATTRIBUTES ================= -->
<div>
  <label class="block text-sm font-medium mb-3">
    Product Attributes
  </label>

  <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
    
    <label class="flex items-center gap-3 p-3 rounded-lg border bg-accent/40 dark:bg-secondary/40 cursor-pointer hover:border-bronze/50 transition">
      <input
        type="checkbox"
        class="accent-bronze dark:accent-primary"
        x-model="$store.productUI.selected.attributes.longLasting"
      />
      <div>
        <p class="font-semibold text-sm">Long Lasting</p>
        <p class="text-xs opacity-60">12+ hours longevity</p>
      </div>
    </label>

    <label class="flex items-center gap-3 p-3 rounded-lg border bg-accent/40 dark:bg-secondary/40 cursor-pointer hover:border-bronze/50 transition">
      <input
        type="checkbox"
        class="accent-bronze dark:accent-primary"
        x-model="$store.productUI.selected.attributes.alcoholFree"
      />
      <div>
        <p class="font-semibold text-sm">Alcohol Free</p>
        <p class="text-xs opacity-60">No alcohol content</p>
      </div>
    </label>

    <label class="flex items-center gap-3 p-3 rounded-lg border bg-accent/40 dark:bg-secondary/40 cursor-pointer hover:border-bronze/50 transition">
      <input
        type="checkbox"
        class="accent-bronze dark:accent-primary"
        x-model="$store.productUI.selected.attributes.pureAttar"
      />
      <div>
        <p class="font-semibold text-sm">Pure Attar</p>
        <p class="text-xs opacity-60">100% oil-based</p>
      </div>
    </label>

  </div>
</div>
<!-- ================= END ATTRIBUTES ================= -->





<div><label class="block text-sm font-medium" for="edit-description">Product Description</label><div class="mt-1"><textarea x-model="$store.productUI.selected.description" class="block w-full bg-accent/50 dark:bg-secondary/50 border-bronze/20 dark:border-primary/20 shadow-sm sm:text-sm rounded-md" id="edit-description" name="edit-description" rows="4">A rich, decadent fragrance fit for royalty. Notes of aged oud, saffron, and rose.</textarea></div></div>
</div>
<div class="px-6 py-4 border-t border-bronze/10 dark:border-primary/10 flex justify-end items-center bg-accent/80 dark:bg-secondary/80 backdrop-blur-sm">
<div class="space-x-3">
<button   @click="$store.productUI.closeAll()"
= false" class="px-4 py-2 text-sm font-semibold rounded-lg border border-bronze/50 dark:border-primary/50 hover:bg-bronze/10 dark:hover:bg-primary/10 transition" type="button">Cancel</button>
<button class="px-4 py-2 text-sm font-semibold rounded-lg bg-bronze dark:bg-primary text-white dark:text-secondary hover:opacity-90 transition shadow-md" type="button"     @click="$store.productUI.save()"

>Save Changes</button>
</div>
</div>
</div>
</div>
<!-- ================= PRODUCT VIEW POPUP ================= -->
<div
  x-show="$store.productUI.viewOpen"
  x-cloak
  class="fixed inset-0 z-50 flex items-center justify-center"
>
  <!-- Overlay -->
  <div
    class="absolute inset-0 bg-black/70 backdrop-blur-sm"
    @click="$store.productUI.closeAll()"
  ></div>

  <!-- Popup -->
  <div
    class="relative bg-light-bg dark:bg-dark-bg
           w-full max-w-3xl
           max-h-[85vh]
           rounded-2xl shadow-2xl
           border border-bronze/10
           flex flex-col overflow-hidden"
    @click.outside="$store.productUI.closeAll()"
  >
    <!-- Header -->
    <div class="px-6 py-4 border-b flex justify-between items-center bg-accent dark:bg-secondary">
      <div>
        <h2 class="text-xl font-display font-bold">
          Product Details
        </h2>
        <p class="text-xs opacity-60">
          Read-only preview for admin reference
        </p>
      </div>

      <button @click="$store.productUI.closeAll()">
        <span class="material-symbols-outlined">close</span>
      </button>
    </div>

    <!-- Content -->
    <div
      class="p-6 space-y-6 overflow-y-auto"
      x-show="$store.productUI.selected"
    >
      <!-- IMAGE -->
      <div class="w-full">
        <img
        class="w-full h-60 object-cover rounded-xl border"
        :src="$store.productUI.selected?.images?.[0] || '/placeholder.png'"
      />
      </div>

      <!-- BASIC INFO -->
      <div class="space-y-2">
        <h3 class="text-2xl font-display font-bold"
            x-text="$store.productUI.selected.name"></h3>

        <div class="flex flex-wrap gap-3 text-sm">
          <span class="px-3 py-1 rounded-full bg-bronze/10 text-bronze font-semibold">
            <span x-text="$store.productUI.selected.quality"></span>
          </span>

          <span
            class="px-3 py-1 rounded-full font-semibold"
            :class="$store.productUI.selected.active
              ? 'bg-green-100 text-green-700'
              : 'bg-gray-200 text-gray-600'"
            x-text="$store.productUI.selected.active ? 'Active' : 'Hidden'"
          ></span>
        </div>
      </div>

      <!-- PRICING -->
      <div>
        <h4 class="font-semibold mb-2">Pricing (LKR)</h4>

        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
          <template
            x-for="(p, size) in $store.productUI.selected.calculatedPrices"
            :key="size"
          >
            <div class="border rounded-xl p-4 text-center bg-accent/40 dark:bg-secondary/40">
              <div class="text-sm font-semibold mb-1" x-text="size + ' ml'"></div>

              <template x-if="p.discounted">
                <div>
                  <div class="line-through text-xs opacity-60">
                    LKR <span x-text="p.original"></span>
                  </div>
                  <div class="text-lg font-bold text-green-600">
                    LKR <span x-text="p.discounted"></span>
                  </div>
                </div>
              </template>

              <template x-if="!p.discounted">
                <div class="text-lg font-bold">
                  LKR <span x-text="p.original"></span>
                </div>
              </template>
            </div>
          </template>
        </div>
      </div>

      <!-- FRAGRANCE VARIANTS -->
      <div>
        <h4 class="font-semibold mb-2">Fragrance Variants</h4>

        <template x-if="$store.productUI.selected.fragranceVariants?.length">
          <div class="flex flex-wrap gap-2">
            <template
              x-for="v in $store.productUI.selected.fragranceVariants"
              :key="v"
            >
              <span class="px-3 py-1 text-sm rounded-full bg-primary/10 text-primary font-semibold">
                <span x-text="v"></span>
              </span>
            </template>
          </div>
        </template>

        <template x-if="!$store.productUI.selected.fragranceVariants?.length">
          <p class="text-sm opacity-50 italic">Information not available</p>
        </template>
      </div>

      <!-- NOTES -->
      <div>
        <h4 class="font-semibold mb-2">Fragrance Notes</h4>

        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
          <div class="border rounded-xl p-3">
            <p class="text-xs font-semibold opacity-60 mb-1">Top Notes</p>
            <p class="text-sm"
               x-text="$store.productUI.selected.notes?.top?.length
                 ? $store.productUI.selected.notes.top.join(', ')
                 : 'Information not available'"></p>
          </div>

          <div class="border rounded-xl p-3">
            <p class="text-xs font-semibold opacity-60 mb-1">Heart Notes</p>
            <p class="text-sm"
               x-text="$store.productUI.selected.notes?.heart?.length
                 ? $store.productUI.selected.notes.heart.join(', ')
                 : 'Information not available'"></p>
          </div>

          <div class="border rounded-xl p-3">
            <p class="text-xs font-semibold opacity-60 mb-1">Base Notes</p>
            <p class="text-sm"
               x-text="$store.productUI.selected.notes?.base?.length
                 ? $store.productUI.selected.notes.base.join(', ')
                 : 'Information not available'"></p>
          </div>
        </div>
      </div>

      <!-- ATTRIBUTES -->
      <div>
        <h4 class="font-semibold mb-2">Product Attributes</h4>

        <div class="flex flex-wrap gap-4 text-sm">
          <template x-if="$store.productUI.selected.attributes?.longLasting">
            <span class="flex items-center gap-1 px-3 py-1 rounded-full bg-green-100 text-green-700">
              <span class="material-symbols-outlined text-sm">schedule</span>
              Long Lasting
            </span>
          </template>

          <template x-if="$store.productUI.selected.attributes?.alcoholFree">
            <span class="flex items-center gap-1 px-3 py-1 rounded-full bg-blue-100 text-blue-700">
              <span class="material-symbols-outlined text-sm">water_drop</span>
              Alcohol Free
            </span>
          </template>

          <template x-if="$store.productUI.selected.attributes?.pureAttar">
            <span class="flex items-center gap-1 px-3 py-1 rounded-full bg-purple-100 text-purple-700">
              <span class="material-symbols-outlined text-sm">verified</span>
              Pure Attar
            </span>
          </template>

          <template
            x-if="!$store.productUI.selected.attributes
              || Object.values($store.productUI.selected.attributes).every(v => !v)"
          >
            <p class="text-sm opacity-50 italic">Information not available</p>
          </template>
        </div>
      </div>

      <!-- SIZES & STOCK -->
      <div>
        <h4 class="font-semibold mb-2">Available Sizes & Stock</h4>

        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
          <template
            x-for="size in $store.productUI.selected.bottleSizes"
            :key="size.sizeMl"
          >
            <div class="border rounded-xl p-3 text-center">
              <div class="text-sm font-semibold" x-text="size.sizeMl + ' ml'"></div>
              <div class="text-lg font-bold" x-text="size.stock ?? '-'"></div>
            </div>
          </template>
        </div>

        <p class="mt-1 text-xs opacity-60">
          Stock is managed via Stock Control
        </p>
      </div>

      <!-- DESCRIPTION -->
      <div>
        <h4 class="font-semibold mb-1">Description</h4>
        <p class="text-sm leading-relaxed"
           x-text="$store.productUI.selected.description || 'Information not available'"></p>
      </div>
    </div>

    <!-- Footer -->
    <div class="px-6 py-4 border-t flex justify-end bg-accent/70 dark:bg-secondary/70">
      <button
        class="px-4 py-2 rounded-lg border hover:bg-bronze/10 transition"
        @click="$store.productUI.closeAll()"
      >
        Close
      </button>
    </div>
  </div>
</div>
<!-- ================= END PRODUCT VIEW POPUP ================= -->


<!-- DELETE PRODUCT MODAL -->
<div
  x-show="$store.productUI.deleteOpen"
  x-cloak
  class="fixed inset-0 z-[9999] flex items-center justify-center"
>

  <!-- Overlay (NON-BLOCKING) -->
  <div
    class="absolute inset-0 bg-black/60"
    @click="$store.productUI.closeAll()"
  ></div>

  <!-- Modal Box -->
  <div
    class="relative bg-light-bg dark:bg-dark-bg rounded-2xl shadow-xl max-w-md w-full mx-4 p-6 z-[10000]"
    @click.stop
  >
    <div class="text-center">
      <div class="mx-auto flex items-center justify-center h-14 w-14 rounded-full bg-danger/10 text-danger">
        <span class="material-symbols-outlined text-3xl">delete_forever</span>
      </div>

      <h3 class="mt-4 text-xl font-bold">
        Delete Product?
      </h3>

      <p class="mt-2 text-sm opacity-70">
        This action is permanent and cannot be undone.
      </p>
    </div>

    <div class="mt-6 flex gap-3">
      <button
        @click="$store.productUI.closeAll()"
        class="w-full px-4 py-2 text-sm font-semibold rounded-lg border"
      >
        Cancel
      </button>

      <!-- THIS BUTTON WILL NOW RECEIVE CLICKS -->
      <button
      @click="hardDeleteProduct($store.productUI.selected._id)"
      class="w-full px-4 py-2 text-sm font-semibold rounded-lg bg-danger text-white"
      >
        Yes, Delete
      </button>
    </div>
  </div>
</div>

<!-- ================= END DELETE PRODUCT CONFIRM ================= -->
<script>
async function hardDeleteProduct(productId) {
  if (!productId) {
    alert("Invalid product");
    return;
  }

  const token = localStorage.getItem("token");

  try {
    const res = await fetch(
      `https://perfume-store-production.up.railway.app/api/admin/products/${productId}`,
      {
        method: "DELETE",
        headers: {
          Authorization: `Bearer ${token}`,
          "Cache-Control": "no-cache"
        },
        cache: "no-store"
      }
    );

    if (!res.ok) {
      const data = await res.json().catch(() => ({}));
      alert(data.message || "Failed to delete product");
      return;
    }

    alert("Product deleted successfully");

    // Close modal
    Alpine.store("productUI").closeAll();

const adminComp = document.querySelector('[x-data="adminProducts()"]');
if (adminComp && adminComp.__x) {
  adminComp.__x.$data.products =
    adminComp.__x.$data.products.filter(p => p._id !== productId);
}

  } catch (err) {
    console.error("DELETE ERROR:", err);
    alert("Delete request failed");
  }
}
</script>



</div>
<script>
async function uploadProductImage(event) {
  const file = event.target.files[0];
  if (!file) return;

  const product = Alpine.store("productUI").selected;
  if (!product) return;

  const token = localStorage.getItem("token");
  const formData = new FormData();
  formData.append("image", file);

  const res = await fetch(
    `https://perfume-store-production.up.railway.app/api/admin/products/${product._id}/image`,
    {
      method: "POST",
      headers: {
        Authorization: `Bearer ${token}`
      },
      body: formData
    }
  );

  const data = await res.json();

  if (!res.ok) {
    alert(data.message || "Image upload failed");
    return;
  }

  // ✅ update preview immediately
  Alpine.store("productUI").selected.images = data.images;
}
</script>

<div class="lg:hidden" x-cloak="" x-show="mobileMenuOpen">
<div @click="mobileMenuOpen = false" class="fixed inset-0 bg-black/50 z-40" x-transition:enter="transition-opacity ease-linear duration-300" x-transition:enter-end="opacity-100" x-transition:enter-start="opacity-0" x-transition:leave="transition-opacity ease-linear duration-300" x-transition:leave-end="opacity-0" x-transition:leave-start="opacity-100"></div>
<aside class="fixed inset-y-0 right-0 w-64 bg-accent dark:bg-secondary z-50 overscroll-contain animate-slide-in-right">
<div class="flex flex-col h-full">
<div class="flex items-center justify-between h-20 px-6 border-b border-bronze/10 dark:border-primary/10">
<a class="flex items-center gap-3" href="index.html">
<div class="h-8 w-8 text-bronze dark:text-primary">
  <img
  src="assets/images/logo.png"
  alt="Attar Store Logo"
  class="h-8 w-8 object-cover rounded-full"
  /></div>
<span class="text-xl font-bold font-display text-light-text dark:text-accent">Hirah Attar</span>
</a>
<button @click="mobileMenuOpen = false"><span class="material-symbols-outlined">close</span></button>
</div>
<nav class="flex-grow pt-6 px-4 space-y-2 overflow-y-auto">
<!-- Dashboard -->
<a 
    :class="{'bg-bronze/10 dark:bg-primary/10 text-bronze dark:text-primary': activeView === 'dashboard'}"
    @click.prevent="activeView = 'dashboard'; mobileMenuOpen = false"
    class="flex items-center p-3 rounded-lg hover:bg-bronze/5 dark:hover:bg-primary/5 transition"
    href="#"
>
    <span class="material-symbols-outlined">dashboard</span>
    <span class="ml-4 font-semibold">Dashboard</span>
</a>

<!-- Products -->
<a 
    :class="{'bg-bronze/10 dark:bg-primary/10 text-bronze dark:text-primary': activeView === 'products'}"
    @click.prevent="activeView = 'products'; mobileMenuOpen = false"
    class="flex items-center p-3 rounded-lg hover:bg-bronze/5 dark:hover:bg-primary/5 transition"
    href="#"
>
    <span class="material-symbols-outlined">inventory_2</span>
    <span class="ml-4 font-semibold">Products</span>
</a>






<!-- Orders (FIXED) -->
<a 
    :class="{'bg-bronze/10 dark:bg-primary/10 text-bronze dark:text-primary': activeView === 'orders'}"
    @click.prevent="activeView = 'orders'; mobileMenuOpen = false"
    class="flex items-center p-3 rounded-lg hover:bg-bronze/5 dark:hover:bg-primary/5 transition"
    href="#"
>
    <span class="material-symbols-outlined">receipt_long</span>
    <span class="ml-4 font-semibold">Orders</span>
</a>

<!-- Users (FIXED) -->
<a 
    :class="{'bg-bronze/10 dark:bg-primary/10 text-bronze dark:text-primary': activeView === 'users'}"
    @click.prevent="activeView = 'users'; mobileMenuOpen = false"
    class="flex items-center p-3 rounded-lg hover:bg-bronze/5 dark:hover:bg-primary/5 transition"
    href="#"
>
    <span class="material-symbols-outlined">person</span>
    <span class="ml-4 font-semibold">Users</span>
</a>
<button
  @click="activeView = 'reviews'; mobileMenuOpen = false"
  class="w-full flex items-center gap-3 px-4 py-3 text-left hover:bg-bronze/5 dark:hover:bg-primary/5"
>
  <span class="material-symbols-outlined">rate_review</span>
  <span class="font-medium">Reviews</span>
</button>

<!-- Stock Control (FIXED) -->
<a 
    :class="{'bg-bronze/10 dark:bg-primary/10 text-bronze dark:text-primary': activeView === 'stock'}"
    @click.prevent="activeView = 'stock'; mobileMenuOpen = false"
    class="flex items-center p-3 rounded-lg hover:bg-bronze/5 dark:hover:bg-primary/5 transition"
    href="#"
>
    <span class="material-symbols-outlined">inventory</span>
    <span class="ml-4 font-semibold">Stock Control</span>
</a>


<button
  @click="activeView = 'messages'; mobileMenuOpen = false"
  class="w-full flex items-center gap-3 px-4 py-3 text-left hover:bg-bronze/5 dark:hover:bg-primary/5"
>
  <span class="material-symbols-outlined">forum</span>
  <span class="font-medium">Messages</span>
</button>


<button
  @click="activeView = 'blog'; mobileMenuOpen = false"
  class="w-full flex items-center gap-3 px-4 py-3 text-left hover:bg-bronze/5 dark:hover:bg-primary/5"
>
  <span class="material-symbols-outlined">article</span>
  <span class="font-medium">Blog & Articles</span>
</button>



<!-- Analytics (FIXED) -->
<a 
    :class="{'bg-bronze/10 dark:bg-primary/10 text-bronze dark:text-primary': activeView === 'analytics'}"
    @click.prevent="activeView = 'analytics'; mobileMenuOpen = false"
    class="flex items-center p-3 rounded-lg hover:bg-bronze/5 dark:hover:bg-primary/5 transition"
    href="#"
>
    <span class="material-symbols-outlined">analytics</span>
    <span class="ml-4 font-semibold">Analytics</span>
</a>

</nav>

<div class="p-4 border-t border-bronze/10 dark:border-primary/10">

  <!-- SETTINGS -->
  <a
    :class="{'bg-bronze/10 dark:bg-primary/10 text-bronze dark:text-primary': activeView === 'settings'}"
    @click.prevent="activeView = 'settings'; mobileMenuOpen = false"
    class="flex items-center p-3 rounded-lg hover:bg-bronze/5 dark:hover:bg-primary/5 transition"
    href="#"
  >
    <span class="material-symbols-outlined">settings</span>
    <span class="ml-4 font-semibold">Settings</span>
  </a>

  <!-- LOGOUT -->
<!-- LOGOUT -->
<button
  onclick="adminLogout(); mobileMenuOpen = false"
  class="w-full flex items-center p-3 rounded-lg text-red-600
         hover:bg-red-500/10 transition"
>
  <span class="material-symbols-outlined">logout</span>
  <span class="ml-4 font-semibold">Logout</span>
</button>

<script>
  function adminLogout() {
    // Clear auth data
    localStorage.removeItem("token");
    localStorage.removeItem("user");
    sessionStorage.clear();

    // Always redirect to site root index
    window.location.replace("/index.html");
  }
</script>
</div>
</div>
</aside>
</div>








<!-- GLOBAL MODAL -->
<div
  x-data="globalModal()"
  x-show="open"
  x-cloak
  @modal.window="show($event.detail)"
  class="fixed inset-0 z-[9999] flex items-center justify-center bg-black/50"
>
  <div
    class="w-full max-w-sm rounded-xl bg-white dark:bg-secondary p-6 shadow-lg"
    @click.outside="close()"
  >
    <h3
      class="text-lg font-bold mb-2"
      :class="type === 'error' ? 'text-danger' : 'text-primary'"
      x-text="title"
    ></h3>

    <p
      class="text-sm text-gray-600 dark:text-gray-300"
      x-text="message"
    ></p>

    <div class="mt-5 text-right">
      <button
        @click="close()"
        class="px-4 py-2 rounded-lg bg-primary text-white text-sm"
      >
        OK
      </button>
    </div>
  </div>
</div>

<script>
function globalModal() {
  return {
    open: false,
    title: "",
    message: "",
    type: "info",

    show({ title, message, type = "info" }) {
      this.title = title;
      this.message = message;
      this.type = type;
      this.open = true;
    },

    close() {
      this.open = false;
    }
  };
}
</script>






<script>
(function () {
  const root = document.documentElement;

  // restore theme
  const savedTheme = localStorage.getItem("theme");
  if (savedTheme === "dark") {
    root.classList.add("dark");
  } else {
    root.classList.remove("dark");
  }

  // global toggle
  window.toggleTheme = function () {
    const isDark = root.classList.toggle("dark");
    localStorage.setItem("theme", isDark ? "dark" : "light");
  };
})();
</script>
<datalist id="primaryTagSuggestions"></datalist>
<!-- 🔔 ADMIN NOTIFICATIONS MODAL (GLOBAL) -->
<div
  id="adminNotificationModal"
  class="fixed inset-0 z-[9999] hidden items-center justify-center bg-black/60"
>
  <div class="bg-accent dark:bg-secondary w-full max-w-lg rounded-xl shadow-xl">
    <!-- Header -->
    <div class="flex justify-between items-center p-4 border-b border-bronze/10 dark:border-primary/10">
      <h3 class="font-semibold text-lg">All Notifications</h3>
      <button
        onclick="closeAdminNotificationModal()"
        class="text-xl hover:text-danger"
      >
        ✕
      </button>
    </div>

    <!-- Body (SCROLLABLE) -->
    <div
      id="adminNotificationModalBody"
      class="max-h-[60vh] overflow-y-auto divide-y divide-bronze/10 dark:divide-primary/10"
    >
      <!-- injected by JS -->
    </div>
  </div>
</div>
</body></html>