<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8">
  <title>Set New Password - Hirah Attar</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/assets/js/font.js"></script>
</head>

<body class="bg-white dark:bg-[#0f0e0b] text-black dark:text-white min-h-screen flex items-center justify-center">

  <div class="w-full max-w-[420px] bg-white dark:bg-[#181611] 
              border border-gray-200 dark:border-border-dark
              rounded-2xl shadow-2xl p-8">

    <h2 class="text-3xl font-extrabold text-center mb-2">
      Set New Password
    </h2>

    <p class="text-center text-sm text-gray-500 dark:text-text-muted mb-6">
      Enter your new password below
    </p>

    <form onsubmit="resetPassword(event)" class="space-y-4">

      <input id="newPassword" type="password" required
        class="w-full h-12 rounded-xl px-4 bg-gray-100 dark:bg-[#27241b]"
        placeholder="New password">

      <input id="confirmPassword" type="password" required
        class="w-full h-12 rounded-xl px-4 bg-gray-100 dark:bg-[#27241b]"
        placeholder="Confirm password">

      <button type="submit"
        class="w-full h-12 bg-primary text-black rounded-xl font-bold">
        Update Password
      </button>
    </form>

  </div>

<script>
function getTokenFromURL() {
  const params = new URLSearchParams(window.location.search);
  return params.get("token");
}

async function resetPassword(e) {
  e.preventDefault();

  const token = getTokenFromURL();
  const newPassword = document.getElementById("newPassword").value.trim();
  const confirmPassword = document.getElementById("confirmPassword").value.trim();

  if (!token) {
    alert("Invalid or missing reset token.");
    return;
  }

  if (newPassword !== confirmPassword) {
    alert("Passwords do not match.");
    return;
  }

  const res = await fetch("https://perfume-store-production.up.railway.app/api/auth/reset-password", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ token, newPassword })
  });

  const data = await res.json();
  alert(data.message);

  if (res.ok) {
    window.location.href = "index.html";
  }
}
</script>

</body>
</html>
